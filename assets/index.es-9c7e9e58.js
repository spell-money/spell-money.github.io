import{i as Cm,e as Am,f as Tm,h as Rm,j as Nm,k as $m,m as Fm,o as Dm,p as Lm,q as qm,s as jm,r as Um,t as Mm,u as zm,v as km,w as Cc,x as sf,y as ne,z as nf,A as Oo,H as Hm,B as of,C as Km,D as Vm,E as Ki,F as Bi,G as Bm,I as Wr,J as Gm,K as af,L as Wm,M as Ac,_ as Jm}from"./index-657e2633.js";import{d as Qm,s as Tc,i as Bh,c as Ym,a as Zm,b as cf,f as Rc,p as Xm,J as hi,e as Nc,g as $c,h as Fc,j as Ii,k as ui,l as en,m as e1,n as t1,H as Oi}from"./http-ad8081bd.js";function Dc(a){return globalThis.Buffer!=null?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function uf(a=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Dc(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}function mc(a,i){i||(i=a.reduce((o,h)=>o+h.length,0));const r=uf(i);let s=0;for(const o of a)r.set(o,s),s+=o.length;return Dc(r)}const Gh={...Cm,...Am,...Tm,...Rm,...Nm,...$m,...Fm,...Dm,...Lm,...qm};function hf(a,i,r,s){return{name:a,prefix:i,encoder:{name:a,prefix:i,encode:r},decoder:{decode:s}}}const Wh=hf("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),tc=hf("ascii","a",a=>{let i="a";for(let r=0;r<a.length;r++)i+=String.fromCharCode(a[r]);return i},a=>{a=a.substring(1);const i=uf(a.length);for(let r=0;r<a.length;r++)i[r]=a.charCodeAt(r);return i}),lf={utf8:Wh,"utf-8":Wh,hex:Gh.base16,latin1:tc,ascii:tc,binary:tc,...Gh};function pr(a,i="utf8"){const r=lf[i];if(!r)throw new Error(`Unsupported encoding "${i}"`);return(i==="utf8"||i==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Dc(globalThis.Buffer.from(a,"utf-8")):r.decoder.decode(`${r.prefix}${a}`)}function sr(a,i="utf8"){const r=lf[i];if(!r)throw new Error(`Unsupported encoding "${i}"`);return(i==="utf8"||i==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(a.buffer,a.byteOffset,a.byteLength).toString("utf8"):r.encoder.encode(a).substring(1)}const r1={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}};var tn={};(function(a){const i=Mm,r=zm,s=jm,o=Um,h=O=>O==null,d=Symbol("encodeFragmentIdentifier");function y(O){switch(O.arrayFormat){case"index":return N=>(L,D)=>{const _=L.length;return D===void 0||O.skipNull&&D===null||O.skipEmptyString&&D===""?L:D===null?[...L,[C(N,O),"[",_,"]"].join("")]:[...L,[C(N,O),"[",C(_,O),"]=",C(D,O)].join("")]};case"bracket":return N=>(L,D)=>D===void 0||O.skipNull&&D===null||O.skipEmptyString&&D===""?L:D===null?[...L,[C(N,O),"[]"].join("")]:[...L,[C(N,O),"[]=",C(D,O)].join("")];case"colon-list-separator":return N=>(L,D)=>D===void 0||O.skipNull&&D===null||O.skipEmptyString&&D===""?L:D===null?[...L,[C(N,O),":list="].join("")]:[...L,[C(N,O),":list=",C(D,O)].join("")];case"comma":case"separator":case"bracket-separator":{const N=O.arrayFormat==="bracket-separator"?"[]=":"=";return L=>(D,_)=>_===void 0||O.skipNull&&_===null||O.skipEmptyString&&_===""?D:(_=_===null?"":_,D.length===0?[[C(L,O),N,C(_,O)].join("")]:[[D,C(_,O)].join(O.arrayFormatSeparator)])}default:return N=>(L,D)=>D===void 0||O.skipNull&&D===null||O.skipEmptyString&&D===""?L:D===null?[...L,C(N,O)]:[...L,[C(N,O),"=",C(D,O)].join("")]}}function m(O){let N;switch(O.arrayFormat){case"index":return(L,D,_)=>{if(N=/\[(\d*)\]$/.exec(L),L=L.replace(/\[\d*\]$/,""),!N){_[L]=D;return}_[L]===void 0&&(_[L]={}),_[L][N[1]]=D};case"bracket":return(L,D,_)=>{if(N=/(\[\])$/.exec(L),L=L.replace(/\[\]$/,""),!N){_[L]=D;return}if(_[L]===void 0){_[L]=[D];return}_[L]=[].concat(_[L],D)};case"colon-list-separator":return(L,D,_)=>{if(N=/(:list)$/.exec(L),L=L.replace(/:list$/,""),!N){_[L]=D;return}if(_[L]===void 0){_[L]=[D];return}_[L]=[].concat(_[L],D)};case"comma":case"separator":return(L,D,_)=>{const $=typeof D=="string"&&D.includes(O.arrayFormatSeparator),z=typeof D=="string"&&!$&&j(D,O).includes(O.arrayFormatSeparator);D=z?j(D,O):D;const ae=$||z?D.split(O.arrayFormatSeparator).map(oe=>j(oe,O)):D===null?D:j(D,O);_[L]=ae};case"bracket-separator":return(L,D,_)=>{const $=/(\[\])$/.test(L);if(L=L.replace(/\[\]$/,""),!$){_[L]=D&&j(D,O);return}const z=D===null?[]:D.split(O.arrayFormatSeparator).map(ae=>j(ae,O));if(_[L]===void 0){_[L]=z;return}_[L]=[].concat(_[L],z)};default:return(L,D,_)=>{if(_[L]===void 0){_[L]=D;return}_[L]=[].concat(_[L],D)}}}function S(O){if(typeof O!="string"||O.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function C(O,N){return N.encode?N.strict?i(O):encodeURIComponent(O):O}function j(O,N){return N.decode?r(O):O}function B(O){return Array.isArray(O)?O.sort():typeof O=="object"?B(Object.keys(O)).sort((N,L)=>Number(N)-Number(L)).map(N=>O[N]):O}function W(O){const N=O.indexOf("#");return N!==-1&&(O=O.slice(0,N)),O}function G(O){let N="";const L=O.indexOf("#");return L!==-1&&(N=O.slice(L)),N}function J(O){O=W(O);const N=O.indexOf("?");return N===-1?"":O.slice(N+1)}function ce(O,N){return N.parseNumbers&&!Number.isNaN(Number(O))&&typeof O=="string"&&O.trim()!==""?O=Number(O):N.parseBooleans&&O!==null&&(O.toLowerCase()==="true"||O.toLowerCase()==="false")&&(O=O.toLowerCase()==="true"),O}function ve(O,N){N=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},N),S(N.arrayFormatSeparator);const L=m(N),D=Object.create(null);if(typeof O!="string"||(O=O.trim().replace(/^[?#&]/,""),!O))return D;for(const _ of O.split("&")){if(_==="")continue;let[$,z]=s(N.decode?_.replace(/\+/g," "):_,"=");z=z===void 0?null:["comma","separator","bracket-separator"].includes(N.arrayFormat)?z:j(z,N),L(j($,N),z,D)}for(const _ of Object.keys(D)){const $=D[_];if(typeof $=="object"&&$!==null)for(const z of Object.keys($))$[z]=ce($[z],N);else D[_]=ce($,N)}return N.sort===!1?D:(N.sort===!0?Object.keys(D).sort():Object.keys(D).sort(N.sort)).reduce((_,$)=>{const z=D[$];return z&&typeof z=="object"&&!Array.isArray(z)?_[$]=B(z):_[$]=z,_},Object.create(null))}a.extract=J,a.parse=ve,a.stringify=(O,N)=>{if(!O)return"";N=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},N),S(N.arrayFormatSeparator);const L=z=>N.skipNull&&h(O[z])||N.skipEmptyString&&O[z]==="",D=y(N),_={};for(const z of Object.keys(O))L(z)||(_[z]=O[z]);const $=Object.keys(_);return N.sort!==!1&&$.sort(N.sort),$.map(z=>{const ae=O[z];return ae===void 0?"":ae===null?C(z,N):Array.isArray(ae)?ae.length===0&&N.arrayFormat==="bracket-separator"?C(z,N)+"[]":ae.reduce(D(z),[]).join("&"):C(z,N)+"="+C(ae,N)}).filter(z=>z.length>0).join("&")},a.parseUrl=(O,N)=>{N=Object.assign({decode:!0},N);const[L,D]=s(O,"#");return Object.assign({url:L.split("?")[0]||"",query:ve(J(O),N)},N&&N.parseFragmentIdentifier&&D?{fragmentIdentifier:j(D,N)}:{})},a.stringifyUrl=(O,N)=>{N=Object.assign({encode:!0,strict:!0,[d]:!0},N);const L=W(O.url).split("?")[0]||"",D=a.extract(O.url),_=a.parse(D,{sort:!1}),$=Object.assign(_,O.query);let z=a.stringify($,N);z&&(z=`?${z}`);let ae=G(O.url);return O.fragmentIdentifier&&(ae=`#${N[d]?C(O.fragmentIdentifier,N):O.fragmentIdentifier}`),`${L}${z}${ae}`},a.pick=(O,N,L)=>{L=Object.assign({parseFragmentIdentifier:!0,[d]:!1},L);const{url:D,query:_,fragmentIdentifier:$}=a.parseUrl(O,L);return a.stringifyUrl({url:D,query:o(_,N),fragmentIdentifier:$},L)},a.exclude=(O,N,L)=>{const D=Array.isArray(N)?_=>!N.includes(_):(_,$)=>!N(_,$);return a.pick(O,D,L)}})(tn);const i1=":";function s1(a){const[i,r]=a.split(i1);return{namespace:i,reference:r}}function n1(a,i=[]){const r=[];return Object.keys(a).forEach(s=>{if(i.length&&!i.includes(s))return;const o=a[s];r.push(...o.accounts)}),r}function ff(a,i){return a.includes(":")?[a]:i.chains||[]}const pf="base10",ir="base16",bc="base64pad",Lc="utf8",df=0,Gi=1,o1=0,Jh=1,wc=12,qc=32;function a1(){const a=nf.generateKeyPair();return{privateKey:sr(a.secretKey,ir),publicKey:sr(a.publicKey,ir)}}function _c(){const a=Oo.randomBytes(qc);return sr(a,ir)}function c1(a,i){const r=nf.sharedKey(pr(a,ir),pr(i,ir),!0),s=new Hm(Cc.SHA256,r).expand(qc);return sr(s,ir)}function u1(a){const i=Cc.hash(pr(a,ir));return sr(i,ir)}function ms(a){const i=Cc.hash(pr(a,Lc));return sr(i,ir)}function h1(a){return pr(`${a}`,pf)}function sn(a){return Number(sr(a,pf))}function l1(a){const i=h1(typeof a.type<"u"?a.type:df);if(sn(i)===Gi&&typeof a.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof a.senderPublicKey<"u"?pr(a.senderPublicKey,ir):void 0,s=typeof a.iv<"u"?pr(a.iv,ir):Oo.randomBytes(wc),o=new of.ChaCha20Poly1305(pr(a.symKey,ir)).seal(s,pr(a.message,Lc));return p1({type:i,sealed:o,iv:s,senderPublicKey:r})}function f1(a){const i=new of.ChaCha20Poly1305(pr(a.symKey,ir)),{sealed:r,iv:s}=Eo(a.encoded),o=i.open(s,r);if(o===null)throw new Error("Failed to decrypt");return sr(o,Lc)}function p1(a){if(sn(a.type)===Gi){if(typeof a.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return sr(mc([a.type,a.senderPublicKey,a.iv,a.sealed]),bc)}return sr(mc([a.type,a.iv,a.sealed]),bc)}function Eo(a){const i=pr(a,bc),r=i.slice(o1,Jh),s=Jh;if(sn(r)===Gi){const y=s+qc,m=y+wc,S=i.slice(s,y),C=i.slice(y,m),j=i.slice(m);return{type:r,sealed:j,iv:C,senderPublicKey:S}}const o=s+wc,h=i.slice(s,o),d=i.slice(o);return{type:r,sealed:d,iv:h}}function d1(a,i){const r=Eo(a);return gf({type:sn(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?sr(r.senderPublicKey,ir):void 0,receiverPublicKey:i?.receiverPublicKey})}function gf(a){const i=a?.type||df;if(i===Gi){if(typeof a?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof a?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:i,senderPublicKey:a?.senderPublicKey,receiverPublicKey:a?.receiverPublicKey}}function Qh(a){return a.type===Gi&&typeof a.senderPublicKey=="string"&&typeof a.receiverPublicKey=="string"}var g1=Object.defineProperty,Yh=Object.getOwnPropertySymbols,y1=Object.prototype.hasOwnProperty,v1=Object.prototype.propertyIsEnumerable,Zh=(a,i,r)=>i in a?g1(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,Xh=(a,i)=>{for(var r in i||(i={}))y1.call(i,r)&&Zh(a,r,i[r]);if(Yh)for(var r of Yh(i))v1.call(i,r)&&Zh(a,r,i[r]);return a};const m1="ReactNative",wr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},b1="js";function jc(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function nn(){return!Km()&&!!sf()&&navigator.product===m1}function on(){return!jc()&&!!sf()}function an(){return nn()?wr.reactNative:jc()?wr.node:on()?wr.browser:wr.unknown}function w1(a,i){let r=tn.parse(a);return r=Xh(Xh({},r),i),a=tn.stringify(r),a}function _1(){return km()||{name:"",description:"",url:"",icons:[""]}}function E1(){if(an()===wr.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:s}=global.Platform;return[r,s].join("-")}const a=Qm();if(a===null)return"unknown";const i=a.os?a.os.replace(" ","").toLowerCase():"unknown";return a.type==="browser"?[i,a.name,a.version].join("-"):[i,a.version].join("-")}function I1(){var a;const i=an();return i===wr.browser?[i,((a=Vm())==null?void 0:a.host)||"unknown"].join(":"):i}function x1(a,i,r){const s=E1(),o=I1();return[[a,i].join("-"),[b1,r].join("-"),s,o].join("/")}function S1({protocol:a,version:i,relayUrl:r,sdkVersion:s,auth:o,projectId:h,useOnCloseEvent:d}){const y=r.split("?"),m=x1(a,i,s),S={auth:o,ua:m,projectId:h,useOnCloseEvent:d||void 0},C=w1(y[1]||"",S);return y[0]+"?"+C}function Vi(a,i){return a.filter(r=>i.includes(r)).length===a.length}function yf(a){return Object.fromEntries(a.entries())}function vf(a){return new Map(Object.entries(a))}function ys(a=ne.FIVE_MINUTES,i){const r=ne.toMiliseconds(a||ne.FIVE_MINUTES);let s,o,h;return{resolve:d=>{h&&s&&(clearTimeout(h),s(d))},reject:d=>{h&&o&&(clearTimeout(h),o(d))},done:()=>new Promise((d,y)=>{h=setTimeout(()=>{y(new Error(i))},r),s=d,o=y})}}function rn(a,i,r){return new Promise(async(s,o)=>{const h=setTimeout(()=>o(new Error(r)),i);try{const d=await a;s(d)}catch(d){o(d)}clearTimeout(h)})}function mf(a,i){if(typeof i=="string"&&i.startsWith(`${a}:`))return i;if(a.toLowerCase()==="topic"){if(typeof i!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${i}`}else if(a.toLowerCase()==="id"){if(typeof i!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${i}`}throw new Error(`Unknown expirer target type: ${a}`)}function P1(a){return mf("topic",a)}function O1(a){return mf("id",a)}function bf(a){const[i,r]=a.split(":"),s={id:void 0,topic:void 0};if(i==="topic"&&typeof r=="string")s.topic=r;else if(i==="id"&&Number.isInteger(Number(r)))s.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${i}:${r}`);return s}function jr(a,i){return ne.fromMiliseconds((i||Date.now())+ne.toMiliseconds(a))}function xi(a){return Date.now()>=ne.toMiliseconds(a)}function Ft(a,i){return`${a}${i?`:${i}`:""}`}function rc(a=[],i=[]){return[...new Set([...a,...i])]}async function C1({id:a,topic:i,wcDeepLink:r}){try{if(!r)return;let o=(typeof r=="string"?JSON.parse(r):r)?.href;if(typeof o!="string")return;o.endsWith("/")&&(o=o.slice(0,-1));const h=`${o}/wc?requestId=${a}&sessionTopic=${i}`,d=an();d===wr.browser?h.startsWith("https://")?window.open(h,"_blank","noreferrer noopener"):window.open(h,"_self","noreferrer noopener"):d===wr.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(h)}catch(s){console.error(s)}}const A1="irn";function Ec(a){return a?.relay||{protocol:A1}}function bo(a){const i=r1[a];if(typeof i>"u")throw new Error(`Relay Protocol not supported: ${a}`);return i}var T1=Object.defineProperty,el=Object.getOwnPropertySymbols,R1=Object.prototype.hasOwnProperty,N1=Object.prototype.propertyIsEnumerable,tl=(a,i,r)=>i in a?T1(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,$1=(a,i)=>{for(var r in i||(i={}))R1.call(i,r)&&tl(a,r,i[r]);if(el)for(var r of el(i))N1.call(i,r)&&tl(a,r,i[r]);return a};function F1(a,i="-"){const r={},s="relay"+i;return Object.keys(a).forEach(o=>{if(o.startsWith(s)){const h=o.replace(s,""),d=a[o];r[h]=d}}),r}function D1(a){const i=a.indexOf(":"),r=a.indexOf("?")!==-1?a.indexOf("?"):void 0,s=a.substring(0,i),o=a.substring(i+1,r).split("@"),h=typeof r<"u"?a.substring(r):"",d=tn.parse(h);return{protocol:s,topic:L1(o[0]),version:parseInt(o[1],10),symKey:d.symKey,relay:F1(d)}}function L1(a){return a.startsWith("//")?a.substring(2):a}function q1(a,i="-"){const r="relay",s={};return Object.keys(a).forEach(o=>{const h=r+i+o;a[o]&&(s[h]=a[o])}),s}function j1(a){return`${a.protocol}:${a.topic}@${a.version}?`+tn.stringify($1({symKey:a.symKey},q1(a.relay)))}function ws(a){const i=[];return a.forEach(r=>{const[s,o]=r.split(":");i.push(`${s}:${o}`)}),i}function U1(a){const i=[];return Object.values(a).forEach(r=>{i.push(...ws(r.accounts))}),i}function M1(a,i){const r=[];return Object.values(a).forEach(s=>{ws(s.accounts).includes(i)&&r.push(...s.methods)}),r}function z1(a,i){const r=[];return Object.values(a).forEach(s=>{ws(s.accounts).includes(i)&&r.push(...s.events)}),r}function k1(a,i){const r=wo(a,i);if(r)throw new Error(r.message);const s={};for(const[o,h]of Object.entries(a))s[o]={methods:h.methods,events:h.events,chains:h.accounts.map(d=>`${d.split(":")[0]}:${d.split(":")[1]}`)};return s}function Uc(a){return a.includes(":")}function Ys(a){return Uc(a)?a.split(":")[0]:a}const H1={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},K1={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function X(a,i){const{message:r,code:s}=K1[a];return{message:i?`${r} ${i}`:r,code:s}}function It(a,i){const{message:r,code:s}=H1[a];return{message:i?`${r} ${i}`:r,code:s}}function Gr(a,i){return Array.isArray(a)?typeof i<"u"&&a.length?a.every(i):!0:!1}function bs(a){return Object.getPrototypeOf(a)===Object.prototype&&Object.keys(a).length}function rr(a){return typeof a>"u"}function zt(a,i){return i&&rr(a)?!0:typeof a=="string"&&!!a.trim().length}function Mc(a,i){return i&&rr(a)?!0:typeof a=="number"&&!isNaN(a)}function V1(a,i){const{requiredNamespaces:r}=i,s=Object.keys(a.namespaces),o=Object.keys(r);let h=!0;return Vi(o,s)?(s.forEach(d=>{const{accounts:y,methods:m,events:S}=a.namespaces[d],C=ws(y),j=r[d];(!Vi(ff(d,j),C)||!Vi(j.methods,m)||!Vi(j.events,S))&&(h=!1)}),h):!1}function Io(a){return zt(a,!1)&&a.includes(":")?a.split(":").length===2:!1}function B1(a){if(zt(a,!1)&&a.includes(":")){const i=a.split(":");if(i.length===3){const r=i[0]+":"+i[1];return!!i[2]&&Io(r)}}return!1}function G1(a){if(zt(a,!1))try{return typeof new URL(a)<"u"}catch{return!1}return!1}function W1(a){var i;return(i=a?.proposer)==null?void 0:i.publicKey}function J1(a){return a?.topic}function Q1(a,i){let r=null;return zt(a?.publicKey,!1)||(r=X("MISSING_OR_INVALID",`${i} controller public key should be a string`)),r}function rl(a){let i=!0;return Gr(a)?a.length&&(i=a.every(r=>zt(r,!1))):i=!1,i}function Y1(a,i,r){let s=null;return Gr(i)&&i.length?i.forEach(o=>{s||Io(o)||(s=It("UNSUPPORTED_CHAINS",`${r}, chain ${o} should be a string and conform to "namespace:chainId" format`))}):Io(a)||(s=It("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function Z1(a,i,r){let s=null;return Object.entries(a).forEach(([o,h])=>{if(s)return;const d=Y1(o,ff(o,h),`${i} ${r}`);d&&(s=d)}),s}function X1(a,i){let r=null;return Gr(a)?a.forEach(s=>{r||B1(s)||(r=It("UNSUPPORTED_ACCOUNTS",`${i}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):r=It("UNSUPPORTED_ACCOUNTS",`${i}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function eb(a,i){let r=null;return Object.values(a).forEach(s=>{if(r)return;const o=X1(s?.accounts,`${i} namespace`);o&&(r=o)}),r}function tb(a,i){let r=null;return rl(a?.methods)?rl(a?.events)||(r=It("UNSUPPORTED_EVENTS",`${i}, events should be an array of strings or empty array for no events`)):r=It("UNSUPPORTED_METHODS",`${i}, methods should be an array of strings or empty array for no methods`),r}function wf(a,i){let r=null;return Object.values(a).forEach(s=>{if(r)return;const o=tb(s,`${i}, namespace`);o&&(r=o)}),r}function rb(a,i,r){let s=null;if(a&&bs(a)){const o=wf(a,i);o&&(s=o);const h=Z1(a,i,r);h&&(s=h)}else s=X("MISSING_OR_INVALID",`${i}, ${r} should be an object with data`);return s}function wo(a,i){let r=null;if(a&&bs(a)){const s=wf(a,i);s&&(r=s);const o=eb(a,i);o&&(r=o)}else r=X("MISSING_OR_INVALID",`${i}, namespaces should be an object with data`);return r}function _f(a){return zt(a.protocol,!0)}function ib(a,i){let r=!1;return i&&!a?r=!0:a&&Gr(a)&&a.length&&a.forEach(s=>{r=_f(s)}),r}function sb(a){return typeof a=="number"}function fr(a){return typeof a<"u"&&typeof a!==null}function nb(a){return!(!a||typeof a!="object"||!a.code||!Mc(a.code,!1)||!a.message||!zt(a.message,!1))}function ob(a){return!(rr(a)||!zt(a.method,!1))}function ab(a){return!(rr(a)||rr(a.result)&&rr(a.error)||!Mc(a.id,!1)||!zt(a.jsonrpc,!1))}function cb(a){return!(rr(a)||!zt(a.name,!1))}function il(a,i){return!(!Io(i)||!U1(a).includes(i))}function ub(a,i,r){return zt(r,!1)?M1(a,i).includes(r):!1}function hb(a,i,r){return zt(r,!1)?z1(a,i).includes(r):!1}function sl(a,i,r){let s=null;const o=lb(a),h=fb(i),d=Object.keys(o),y=Object.keys(h),m=nl(Object.keys(a)),S=nl(Object.keys(i)),C=m.filter(j=>!S.includes(j));return C.length&&(s=X("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${C.toString()}
      Received: ${Object.keys(i).toString()}`)),Vi(d,y)||(s=X("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${d.toString()}
      Approved: ${y.toString()}`)),Object.keys(i).forEach(j=>{if(!j.includes(":")||s)return;const B=ws(i[j].accounts);B.includes(j)||(s=X("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${j}
        Required: ${j}
        Approved: ${B.toString()}`))}),d.forEach(j=>{s||(Vi(o[j].methods,h[j].methods)?Vi(o[j].events,h[j].events)||(s=X("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${j}`)):s=X("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${j}`))}),s}function lb(a){const i={};return Object.keys(a).forEach(r=>{var s;r.includes(":")?i[r]=a[r]:(s=a[r].chains)==null||s.forEach(o=>{i[o]={methods:a[r].methods,events:a[r].events}})}),i}function nl(a){return[...new Set(a.map(i=>i.includes(":")?i.split(":")[0]:i))]}function fb(a){const i={};return Object.keys(a).forEach(r=>{r.includes(":")?i[r]=a[r]:ws(a[r].accounts)?.forEach(o=>{i[o]={accounts:a[r].accounts.filter(h=>h.includes(`${o}:`)),methods:a[r].methods,events:a[r].events}})}),i}function pb(a,i){return Mc(a,!1)&&a<=i.max&&a>=i.min}function ol(){const a=an();return new Promise(i=>{switch(a){case wr.browser:i(db());break;case wr.reactNative:i(gb());break;case wr.node:i(yb());break;default:i(!0)}})}function db(){return on()&&navigator?.onLine}async function gb(){return nn()&&typeof global<"u"&&global!=null&&global.NetInfo?(await(global==null?void 0:global.NetInfo.fetch()))?.isConnected:!0}function yb(){return!0}function vb(a){switch(an()){case wr.browser:mb(a);break;case wr.reactNative:bb(a);break}}function mb(a){!nn()&&on()&&(window.addEventListener("online",()=>a(!0)),window.addEventListener("offline",()=>a(!1)))}function bb(a){nn()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(i=>a(i?.isConnected))}const ic={};let go=class{static get(i){return ic[i]}static set(i,r){ic[i]=r}static delete(i){delete ic[i]}};var Co={},cn={};Object.defineProperty(cn,"__esModule",{value:!0});function wb(a){if(typeof a!="string")throw new Error(`Cannot safe json parse value of type ${typeof a}`);try{return JSON.parse(a)}catch{return a}}cn.safeJsonParse=wb;function _b(a){return typeof a=="string"?a:JSON.stringify(a,(i,r)=>typeof r>"u"?null:r)}cn.safeJsonStringify=_b;var zs={exports:{}},al;function Eb(){return al||(al=1,function(){let a;function i(){}a=i,a.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},a.prototype.setItem=function(r,s){this[r]=String(s)},a.prototype.removeItem=function(r){delete this[r]},a.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(s){r[s]=void 0,delete r[s]})},a.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},a.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Ki<"u"&&Ki.localStorage?zs.exports=Ki.localStorage:typeof window<"u"&&window.localStorage?zs.exports=window.localStorage:zs.exports=new i}()),zs.exports}var sc={},ks={},cl;function Ib(){if(cl)return ks;cl=1,Object.defineProperty(ks,"__esModule",{value:!0}),ks.IKeyValueStorage=void 0;class a{}return ks.IKeyValueStorage=a,ks}var Hs={},ul;function xb(){if(ul)return Hs;ul=1,Object.defineProperty(Hs,"__esModule",{value:!0}),Hs.parseEntry=void 0;const a=cn;function i(r){var s;return[r[0],a.safeJsonParse((s=r[1])!==null&&s!==void 0?s:"")]}return Hs.parseEntry=i,Hs}var hl;function Sb(){return hl||(hl=1,function(a){Object.defineProperty(a,"__esModule",{value:!0});const i=Bi;i.__exportStar(Ib(),a),i.__exportStar(xb(),a)}(sc)),sc}Object.defineProperty(Co,"__esModule",{value:!0});Co.KeyValueStorage=void 0;const vs=Bi,ll=cn,Pb=vs.__importDefault(Eb()),Ob=Sb();class Ef{constructor(){this.localStorage=Pb.default}getKeys(){return vs.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return vs.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(Ob.parseEntry)})}getItem(i){return vs.__awaiter(this,void 0,void 0,function*(){const r=this.localStorage.getItem(i);if(r!==null)return ll.safeJsonParse(r)})}setItem(i,r){return vs.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(i,ll.safeJsonStringify(r))})}removeItem(i){return vs.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(i)})}}Co.KeyValueStorage=Ef;var Cb=Co.default=Ef,_s={},Ks={},nc={},Vs={};class Wi{}const Ab=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Wi},Symbol.toStringTag,{value:"Module"})),Tb=Bm(Ab);var fl;function Rb(){if(fl)return Vs;fl=1,Object.defineProperty(Vs,"__esModule",{value:!0}),Vs.IHeartBeat=void 0;const a=Tb;class i extends a.IEvents{constructor(s){super()}}return Vs.IHeartBeat=i,Vs}var pl;function If(){return pl||(pl=1,function(a){Object.defineProperty(a,"__esModule",{value:!0}),Bi.__exportStar(Rb(),a)}(nc)),nc}var oc={},ki={},dl;function Nb(){if(dl)return ki;dl=1,Object.defineProperty(ki,"__esModule",{value:!0}),ki.HEARTBEAT_EVENTS=ki.HEARTBEAT_INTERVAL=void 0;const a=ne;return ki.HEARTBEAT_INTERVAL=a.FIVE_SECONDS,ki.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},ki}var gl;function xf(){return gl||(gl=1,function(a){Object.defineProperty(a,"__esModule",{value:!0}),Bi.__exportStar(Nb(),a)}(oc)),oc}var yl;function $b(){if(yl)return Ks;yl=1,Object.defineProperty(Ks,"__esModule",{value:!0}),Ks.HeartBeat=void 0;const a=Bi,i=Wr,r=ne,s=If(),o=xf();class h extends s.IHeartBeat{constructor(y){super(y),this.events=new i.EventEmitter,this.interval=o.HEARTBEAT_INTERVAL,this.interval=y?.interval||o.HEARTBEAT_INTERVAL}static init(y){return a.__awaiter(this,void 0,void 0,function*(){const m=new h(y);return yield m.init(),m})}init(){return a.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(y,m){this.events.on(y,m)}once(y,m){this.events.once(y,m)}off(y,m){this.events.off(y,m)}removeListener(y,m){this.events.removeListener(y,m)}initialize(){return a.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(o.HEARTBEAT_EVENTS.pulse)}}return Ks.HeartBeat=h,Ks}(function(a){Object.defineProperty(a,"__esModule",{value:!0});const i=Bi;i.__exportStar($b(),a),i.__exportStar(If(),a),i.__exportStar(xf(),a)})(_s);var Ce={},ac,vl;function Fb(){if(vl)return ac;vl=1;function a(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}ac=i;function i(r,s,o){var h=o&&o.stringify||a,d=1;if(typeof r=="object"&&r!==null){var y=s.length+d;if(y===1)return r;var m=new Array(y);m[0]=h(r);for(var S=1;S<y;S++)m[S]=h(s[S]);return m.join(" ")}if(typeof r!="string")return r;var C=s.length;if(C===0)return r;for(var j="",B=1-d,W=-1,G=r&&r.length||0,J=0;J<G;){if(r.charCodeAt(J)===37&&J+1<G){switch(W=W>-1?W:0,r.charCodeAt(J+1)){case 100:case 102:if(B>=C||s[B]==null)break;W<J&&(j+=r.slice(W,J)),j+=Number(s[B]),W=J+2,J++;break;case 105:if(B>=C||s[B]==null)break;W<J&&(j+=r.slice(W,J)),j+=Math.floor(Number(s[B])),W=J+2,J++;break;case 79:case 111:case 106:if(B>=C||s[B]===void 0)break;W<J&&(j+=r.slice(W,J));var ce=typeof s[B];if(ce==="string"){j+="'"+s[B]+"'",W=J+2,J++;break}if(ce==="function"){j+=s[B].name||"<anonymous>",W=J+2,J++;break}j+=h(s[B]),W=J+2,J++;break;case 115:if(B>=C)break;W<J&&(j+=r.slice(W,J)),j+=String(s[B]),W=J+2,J++;break;case 37:W<J&&(j+=r.slice(W,J)),j+="%",W=J+2,J++,B--;break}++B}++J}return W===-1?r:(W<G&&(j+=r.slice(W)),j)}return ac}var cc,ml;function Db(){if(ml)return cc;ml=1;const a=Fb();cc=o;const i=D().console||{},r={mapHttpRequest:G,mapHttpResponse:G,wrapRequestSerializer:J,wrapResponseSerializer:J,wrapErrorSerializer:J,req:G,res:G,err:B};function s(_,$){return Array.isArray(_)?_.filter(function(ae){return ae!=="!stdSerializers.err"}):_===!0?Object.keys($):!1}function o(_){_=_||{},_.browser=_.browser||{};const $=_.browser.transmit;if($&&typeof $.send!="function")throw Error("pino: transmit option must have a send function");const z=_.browser.write||i;_.browser.write&&(_.browser.asObject=!0);const ae=_.serializers||{},oe=s(_.browser.serialize,ae);let Ee=_.browser.serialize;Array.isArray(_.browser.serialize)&&_.browser.serialize.indexOf("!stdSerializers.err")>-1&&(Ee=!1);const Ae=["error","fatal","warn","info","debug","trace"];typeof z=="function"&&(z.error=z.fatal=z.warn=z.info=z.debug=z.trace=z),_.enabled===!1&&(_.level="silent");const et=_.level||"info",T=Object.create(z);T.log||(T.log=ce),Object.defineProperty(T,"levelVal",{get:Ue}),Object.defineProperty(T,"level",{get:Te,set:ee});const k={transmit:$,serialize:oe,asObject:_.browser.asObject,levels:Ae,timestamp:W(_)};T.levels=o.levels,T.level=et,T.setMaxListeners=T.getMaxListeners=T.emit=T.addListener=T.on=T.prependListener=T.once=T.prependOnceListener=T.removeListener=T.removeAllListeners=T.listeners=T.listenerCount=T.eventNames=T.write=T.flush=ce,T.serializers=ae,T._serialize=oe,T._stdErrSerialize=Ee,T.child=Q,$&&(T._logEvent=j());function Ue(){return this.level==="silent"?1/0:this.levels.values[this.level]}function Te(){return this._level}function ee(V){if(V!=="silent"&&!this.levels.values[V])throw Error("unknown level "+V);this._level=V,h(k,T,"error","log"),h(k,T,"fatal","error"),h(k,T,"warn","error"),h(k,T,"info","log"),h(k,T,"debug","log"),h(k,T,"trace","log")}function Q(V,Y){if(!V)throw new Error("missing bindings for child Pino");Y=Y||{},oe&&V.serializers&&(Y.serializers=V.serializers);const ut=Y.serializers;if(oe&&ut){var ke=Object.assign({},ae,ut),Ur=_.browser.serialize===!0?Object.keys(ke):oe;delete V.serializers,m([V],Ur,ke,this._stdErrSerialize)}function we(xt){this._childLevel=(xt._childLevel|0)+1,this.error=S(xt,V,"error"),this.fatal=S(xt,V,"fatal"),this.warn=S(xt,V,"warn"),this.info=S(xt,V,"info"),this.debug=S(xt,V,"debug"),this.trace=S(xt,V,"trace"),ke&&(this.serializers=ke,this._serialize=Ur),$&&(this._logEvent=j([].concat(xt._logEvent.bindings,V)))}return we.prototype=this,new we(this)}return T}o.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},o.stdSerializers=r,o.stdTimeFunctions=Object.assign({},{nullTime:ve,epochTime:O,unixTime:N,isoTime:L});function h(_,$,z,ae){const oe=Object.getPrototypeOf($);$[z]=$.levelVal>$.levels.values[z]?ce:oe[z]?oe[z]:i[z]||i[ae]||ce,d(_,$,z)}function d(_,$,z){!_.transmit&&$[z]===ce||($[z]=function(ae){return function(){const Ee=_.timestamp(),Ae=new Array(arguments.length),et=Object.getPrototypeOf&&Object.getPrototypeOf(this)===i?i:this;for(var T=0;T<Ae.length;T++)Ae[T]=arguments[T];if(_.serialize&&!_.asObject&&m(Ae,this._serialize,this.serializers,this._stdErrSerialize),_.asObject?ae.call(et,y(this,z,Ae,Ee)):ae.apply(et,Ae),_.transmit){const k=_.transmit.level||$.level,Ue=o.levels.values[k],Te=o.levels.values[z];if(Te<Ue)return;C(this,{ts:Ee,methodLevel:z,methodValue:Te,transmitLevel:k,transmitValue:o.levels.values[_.transmit.level||$.level],send:_.transmit.send,val:$.levelVal},Ae)}}}($[z]))}function y(_,$,z,ae){_._serialize&&m(z,_._serialize,_.serializers,_._stdErrSerialize);const oe=z.slice();let Ee=oe[0];const Ae={};ae&&(Ae.time=ae),Ae.level=o.levels.values[$];let et=(_._childLevel|0)+1;if(et<1&&(et=1),Ee!==null&&typeof Ee=="object"){for(;et--&&typeof oe[0]=="object";)Object.assign(Ae,oe.shift());Ee=oe.length?a(oe.shift(),oe):void 0}else typeof Ee=="string"&&(Ee=a(oe.shift(),oe));return Ee!==void 0&&(Ae.msg=Ee),Ae}function m(_,$,z,ae){for(const oe in _)if(ae&&_[oe]instanceof Error)_[oe]=o.stdSerializers.err(_[oe]);else if(typeof _[oe]=="object"&&!Array.isArray(_[oe]))for(const Ee in _[oe])$&&$.indexOf(Ee)>-1&&Ee in z&&(_[oe][Ee]=z[Ee](_[oe][Ee]))}function S(_,$,z){return function(){const ae=new Array(1+arguments.length);ae[0]=$;for(var oe=1;oe<ae.length;oe++)ae[oe]=arguments[oe-1];return _[z].apply(this,ae)}}function C(_,$,z){const ae=$.send,oe=$.ts,Ee=$.methodLevel,Ae=$.methodValue,et=$.val,T=_._logEvent.bindings;m(z,_._serialize||Object.keys(_.serializers),_.serializers,_._stdErrSerialize===void 0?!0:_._stdErrSerialize),_._logEvent.ts=oe,_._logEvent.messages=z.filter(function(k){return T.indexOf(k)===-1}),_._logEvent.level.label=Ee,_._logEvent.level.value=Ae,ae(Ee,_._logEvent,et),_._logEvent=j(T)}function j(_){return{ts:0,messages:[],bindings:_||[],level:{label:"",value:0}}}function B(_){const $={type:_.constructor.name,msg:_.message,stack:_.stack};for(const z in _)$[z]===void 0&&($[z]=_[z]);return $}function W(_){return typeof _.timestamp=="function"?_.timestamp:_.timestamp===!1?ve:O}function G(){return{}}function J(_){return _}function ce(){}function ve(){return!1}function O(){return Date.now()}function N(){return Math.round(Date.now()/1e3)}function L(){return new Date(Date.now()).toISOString()}function D(){function _($){return typeof $<"u"&&$}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return _(self)||_(window)||_(this)||{}}}return cc}var Hi={},bl;function Sf(){return bl||(bl=1,Object.defineProperty(Hi,"__esModule",{value:!0}),Hi.PINO_CUSTOM_CONTEXT_KEY=Hi.PINO_LOGGER_DEFAULTS=void 0,Hi.PINO_LOGGER_DEFAULTS={level:"info"},Hi.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Hi}var tr={},wl;function Lb(){if(wl)return tr;wl=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.generateChildLogger=tr.formatChildLoggerContext=tr.getLoggerContext=tr.setBrowserLoggerContext=tr.getBrowserLoggerContext=tr.getDefaultLoggerOptions=void 0;const a=Sf();function i(y){return Object.assign(Object.assign({},y),{level:y?.level||a.PINO_LOGGER_DEFAULTS.level})}tr.getDefaultLoggerOptions=i;function r(y,m=a.PINO_CUSTOM_CONTEXT_KEY){return y[m]||""}tr.getBrowserLoggerContext=r;function s(y,m,S=a.PINO_CUSTOM_CONTEXT_KEY){return y[S]=m,y}tr.setBrowserLoggerContext=s;function o(y,m=a.PINO_CUSTOM_CONTEXT_KEY){let S="";return typeof y.bindings>"u"?S=r(y,m):S=y.bindings().context||"",S}tr.getLoggerContext=o;function h(y,m,S=a.PINO_CUSTOM_CONTEXT_KEY){const C=o(y,S);return C.trim()?`${C}/${m}`:m}tr.formatChildLoggerContext=h;function d(y,m,S=a.PINO_CUSTOM_CONTEXT_KEY){const C=h(y,m,S),j=y.child({context:C});return s(j,C,S)}return tr.generateChildLogger=d,tr}(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.pino=void 0;const i=Bi,r=i.__importDefault(Db());Object.defineProperty(a,"pino",{enumerable:!0,get:function(){return r.default}}),i.__exportStar(Sf(),a),i.__exportStar(Lb(),a)})(Ce);class qb extends Wi{constructor(i){super(),this.opts=i,this.protocol="wc",this.version=2}}class jb extends Wi{constructor(i,r){super(),this.core=i,this.logger=r,this.records=new Map}}class Ub{constructor(i,r){this.logger=i,this.core=r}}let Mb=class extends Wi{constructor(i,r){super(),this.relayer=i,this.logger=r}},zb=class extends Wi{constructor(i){super()}},kb=class{constructor(i,r,s,o){this.core=i,this.logger=r,this.name=s}};class Hb extends Wi{constructor(i,r){super(),this.relayer=i,this.logger=r}}let Kb=class extends Wi{constructor(i,r){super(),this.core=i,this.logger=r}},Vb=class{constructor(i,r){this.projectId=i,this.logger=r}},Bb=class{constructor(i){this.opts=i,this.protocol="wc",this.version=2}},Gb=class{constructor(i){this.client=i}};var zc={},Pf={};(function(a){Object.defineProperty(a,"__esModule",{value:!0});var i=Gm,r=af;a.DIGEST_LENGTH=64,a.BLOCK_SIZE=128;var s=function(){function y(){this.digestLength=a.DIGEST_LENGTH,this.blockSize=a.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return y.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},y.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},y.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},y.prototype.update=function(m,S){if(S===void 0&&(S=m.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var C=0;if(this._bytesHashed+=S,this._bufferLength>0){for(;this._bufferLength<a.BLOCK_SIZE&&S>0;)this._buffer[this._bufferLength++]=m[C++],S--;this._bufferLength===this.blockSize&&(h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(S>=this.blockSize&&(C=h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,m,C,S),S%=this.blockSize);S>0;)this._buffer[this._bufferLength++]=m[C++],S--;return this},y.prototype.finish=function(m){if(!this._finished){var S=this._bytesHashed,C=this._bufferLength,j=S/536870912|0,B=S<<3,W=S%128<112?128:256;this._buffer[C]=128;for(var G=C+1;G<W-8;G++)this._buffer[G]=0;i.writeUint32BE(j,this._buffer,W-8),i.writeUint32BE(B,this._buffer,W-4),h(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,W),this._finished=!0}for(var G=0;G<this.digestLength/8;G++)i.writeUint32BE(this._stateHi[G],m,G*8),i.writeUint32BE(this._stateLo[G],m,G*8+4);return this},y.prototype.digest=function(){var m=new Uint8Array(this.digestLength);return this.finish(m),m},y.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},y.prototype.restoreState=function(m){return this._stateHi.set(m.stateHi),this._stateLo.set(m.stateLo),this._bufferLength=m.bufferLength,m.buffer&&this._buffer.set(m.buffer),this._bytesHashed=m.bytesHashed,this._finished=!1,this},y.prototype.cleanSavedState=function(m){r.wipe(m.stateHi),r.wipe(m.stateLo),m.buffer&&r.wipe(m.buffer),m.bufferLength=0,m.bytesHashed=0},y}();a.SHA512=s;var o=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function h(y,m,S,C,j,B,W){for(var G=S[0],J=S[1],ce=S[2],ve=S[3],O=S[4],N=S[5],L=S[6],D=S[7],_=C[0],$=C[1],z=C[2],ae=C[3],oe=C[4],Ee=C[5],Ae=C[6],et=C[7],T,k,Ue,Te,ee,Q,V,Y;W>=128;){for(var ut=0;ut<16;ut++){var ke=8*ut+B;y[ut]=i.readUint32BE(j,ke),m[ut]=i.readUint32BE(j,ke+4)}for(var ut=0;ut<80;ut++){var Ur=G,we=J,xt=ce,F=ve,R=O,P=N,u=L,w=D,ie=_,fe=$,me=z,Re=ae,$e=oe,xe=Ee,St=Ae,mt=et;if(T=D,k=et,ee=k&65535,Q=k>>>16,V=T&65535,Y=T>>>16,T=(O>>>14|oe<<32-14)^(O>>>18|oe<<32-18)^(oe>>>41-32|O<<32-(41-32)),k=(oe>>>14|O<<32-14)^(oe>>>18|O<<32-18)^(O>>>41-32|oe<<32-(41-32)),ee+=k&65535,Q+=k>>>16,V+=T&65535,Y+=T>>>16,T=O&N^~O&L,k=oe&Ee^~oe&Ae,ee+=k&65535,Q+=k>>>16,V+=T&65535,Y+=T>>>16,T=o[ut*2],k=o[ut*2+1],ee+=k&65535,Q+=k>>>16,V+=T&65535,Y+=T>>>16,T=y[ut%16],k=m[ut%16],ee+=k&65535,Q+=k>>>16,V+=T&65535,Y+=T>>>16,Q+=ee>>>16,V+=Q>>>16,Y+=V>>>16,Ue=V&65535|Y<<16,Te=ee&65535|Q<<16,T=Ue,k=Te,ee=k&65535,Q=k>>>16,V=T&65535,Y=T>>>16,T=(G>>>28|_<<32-28)^(_>>>34-32|G<<32-(34-32))^(_>>>39-32|G<<32-(39-32)),k=(_>>>28|G<<32-28)^(G>>>34-32|_<<32-(34-32))^(G>>>39-32|_<<32-(39-32)),ee+=k&65535,Q+=k>>>16,V+=T&65535,Y+=T>>>16,T=G&J^G&ce^J&ce,k=_&$^_&z^$&z,ee+=k&65535,Q+=k>>>16,V+=T&65535,Y+=T>>>16,Q+=ee>>>16,V+=Q>>>16,Y+=V>>>16,w=V&65535|Y<<16,mt=ee&65535|Q<<16,T=F,k=Re,ee=k&65535,Q=k>>>16,V=T&65535,Y=T>>>16,T=Ue,k=Te,ee+=k&65535,Q+=k>>>16,V+=T&65535,Y+=T>>>16,Q+=ee>>>16,V+=Q>>>16,Y+=V>>>16,F=V&65535|Y<<16,Re=ee&65535|Q<<16,J=Ur,ce=we,ve=xt,O=F,N=R,L=P,D=u,G=w,$=ie,z=fe,ae=me,oe=Re,Ee=$e,Ae=xe,et=St,_=mt,ut%16===15)for(var ke=0;ke<16;ke++)T=y[ke],k=m[ke],ee=k&65535,Q=k>>>16,V=T&65535,Y=T>>>16,T=y[(ke+9)%16],k=m[(ke+9)%16],ee+=k&65535,Q+=k>>>16,V+=T&65535,Y+=T>>>16,Ue=y[(ke+1)%16],Te=m[(ke+1)%16],T=(Ue>>>1|Te<<32-1)^(Ue>>>8|Te<<32-8)^Ue>>>7,k=(Te>>>1|Ue<<32-1)^(Te>>>8|Ue<<32-8)^(Te>>>7|Ue<<32-7),ee+=k&65535,Q+=k>>>16,V+=T&65535,Y+=T>>>16,Ue=y[(ke+14)%16],Te=m[(ke+14)%16],T=(Ue>>>19|Te<<32-19)^(Te>>>61-32|Ue<<32-(61-32))^Ue>>>6,k=(Te>>>19|Ue<<32-19)^(Ue>>>61-32|Te<<32-(61-32))^(Te>>>6|Ue<<32-6),ee+=k&65535,Q+=k>>>16,V+=T&65535,Y+=T>>>16,Q+=ee>>>16,V+=Q>>>16,Y+=V>>>16,y[ke]=V&65535|Y<<16,m[ke]=ee&65535|Q<<16}T=G,k=_,ee=k&65535,Q=k>>>16,V=T&65535,Y=T>>>16,T=S[0],k=C[0],ee+=k&65535,Q+=k>>>16,V+=T&65535,Y+=T>>>16,Q+=ee>>>16,V+=Q>>>16,Y+=V>>>16,S[0]=G=V&65535|Y<<16,C[0]=_=ee&65535|Q<<16,T=J,k=$,ee=k&65535,Q=k>>>16,V=T&65535,Y=T>>>16,T=S[1],k=C[1],ee+=k&65535,Q+=k>>>16,V+=T&65535,Y+=T>>>16,Q+=ee>>>16,V+=Q>>>16,Y+=V>>>16,S[1]=J=V&65535|Y<<16,C[1]=$=ee&65535|Q<<16,T=ce,k=z,ee=k&65535,Q=k>>>16,V=T&65535,Y=T>>>16,T=S[2],k=C[2],ee+=k&65535,Q+=k>>>16,V+=T&65535,Y+=T>>>16,Q+=ee>>>16,V+=Q>>>16,Y+=V>>>16,S[2]=ce=V&65535|Y<<16,C[2]=z=ee&65535|Q<<16,T=ve,k=ae,ee=k&65535,Q=k>>>16,V=T&65535,Y=T>>>16,T=S[3],k=C[3],ee+=k&65535,Q+=k>>>16,V+=T&65535,Y+=T>>>16,Q+=ee>>>16,V+=Q>>>16,Y+=V>>>16,S[3]=ve=V&65535|Y<<16,C[3]=ae=ee&65535|Q<<16,T=O,k=oe,ee=k&65535,Q=k>>>16,V=T&65535,Y=T>>>16,T=S[4],k=C[4],ee+=k&65535,Q+=k>>>16,V+=T&65535,Y+=T>>>16,Q+=ee>>>16,V+=Q>>>16,Y+=V>>>16,S[4]=O=V&65535|Y<<16,C[4]=oe=ee&65535|Q<<16,T=N,k=Ee,ee=k&65535,Q=k>>>16,V=T&65535,Y=T>>>16,T=S[5],k=C[5],ee+=k&65535,Q+=k>>>16,V+=T&65535,Y+=T>>>16,Q+=ee>>>16,V+=Q>>>16,Y+=V>>>16,S[5]=N=V&65535|Y<<16,C[5]=Ee=ee&65535|Q<<16,T=L,k=Ae,ee=k&65535,Q=k>>>16,V=T&65535,Y=T>>>16,T=S[6],k=C[6],ee+=k&65535,Q+=k>>>16,V+=T&65535,Y+=T>>>16,Q+=ee>>>16,V+=Q>>>16,Y+=V>>>16,S[6]=L=V&65535|Y<<16,C[6]=Ae=ee&65535|Q<<16,T=D,k=et,ee=k&65535,Q=k>>>16,V=T&65535,Y=T>>>16,T=S[7],k=C[7],ee+=k&65535,Q+=k>>>16,V+=T&65535,Y+=T>>>16,Q+=ee>>>16,V+=Q>>>16,Y+=V>>>16,S[7]=D=V&65535|Y<<16,C[7]=et=ee&65535|Q<<16,B+=128,W-=128}return B}function d(y){var m=new s;m.update(y);var S=m.digest();return m.clean(),S}a.hash=d})(Pf);(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.convertSecretKeyToX25519=a.convertPublicKeyToX25519=a.verify=a.sign=a.extractPublicKeyFromSecretKey=a.generateKeyPair=a.generateKeyPairFromSeed=a.SEED_LENGTH=a.SECRET_KEY_LENGTH=a.PUBLIC_KEY_LENGTH=a.SIGNATURE_LENGTH=void 0;const i=Oo,r=Pf,s=af;a.SIGNATURE_LENGTH=64,a.PUBLIC_KEY_LENGTH=32,a.SECRET_KEY_LENGTH=64,a.SEED_LENGTH=32;function o(F){const R=new Float64Array(16);if(F)for(let P=0;P<F.length;P++)R[P]=F[P];return R}const h=new Uint8Array(32);h[0]=9;const d=o(),y=o([1]),m=o([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),S=o([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),C=o([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),j=o([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),B=o([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function W(F,R){for(let P=0;P<16;P++)F[P]=R[P]|0}function G(F){let R=1;for(let P=0;P<16;P++){let u=F[P]+R+65535;R=Math.floor(u/65536),F[P]=u-R*65536}F[0]+=R-1+37*(R-1)}function J(F,R,P){const u=~(P-1);for(let w=0;w<16;w++){const ie=u&(F[w]^R[w]);F[w]^=ie,R[w]^=ie}}function ce(F,R){const P=o(),u=o();for(let w=0;w<16;w++)u[w]=R[w];G(u),G(u),G(u);for(let w=0;w<2;w++){P[0]=u[0]-65517;for(let fe=1;fe<15;fe++)P[fe]=u[fe]-65535-(P[fe-1]>>16&1),P[fe-1]&=65535;P[15]=u[15]-32767-(P[14]>>16&1);const ie=P[15]>>16&1;P[14]&=65535,J(u,P,1-ie)}for(let w=0;w<16;w++)F[2*w]=u[w]&255,F[2*w+1]=u[w]>>8}function ve(F,R){let P=0;for(let u=0;u<32;u++)P|=F[u]^R[u];return(1&P-1>>>8)-1}function O(F,R){const P=new Uint8Array(32),u=new Uint8Array(32);return ce(P,F),ce(u,R),ve(P,u)}function N(F){const R=new Uint8Array(32);return ce(R,F),R[0]&1}function L(F,R){for(let P=0;P<16;P++)F[P]=R[2*P]+(R[2*P+1]<<8);F[15]&=32767}function D(F,R,P){for(let u=0;u<16;u++)F[u]=R[u]+P[u]}function _(F,R,P){for(let u=0;u<16;u++)F[u]=R[u]-P[u]}function $(F,R,P){let u,w,ie=0,fe=0,me=0,Re=0,$e=0,xe=0,St=0,mt=0,nt=0,De=0,Je=0,Qe=0,ot=0,Me=0,Ye=0,Ne=0,He=0,ht=0,qe=0,Pt=0,Dt=0,kt=0,Ht=0,jt=0,Jt=0,nr=0,Mr=0,Qt=0,Jr=0,fi=0,Ci=0,lt=P[0],tt=P[1],ft=P[2],pt=P[3],at=P[4],rt=P[5],Ot=P[6],Ct=P[7],dt=P[8],At=P[9],gt=P[10],bt=P[11],yt=P[12],We=P[13],Tt=P[14],Rt=P[15];u=R[0],ie+=u*lt,fe+=u*tt,me+=u*ft,Re+=u*pt,$e+=u*at,xe+=u*rt,St+=u*Ot,mt+=u*Ct,nt+=u*dt,De+=u*At,Je+=u*gt,Qe+=u*bt,ot+=u*yt,Me+=u*We,Ye+=u*Tt,Ne+=u*Rt,u=R[1],fe+=u*lt,me+=u*tt,Re+=u*ft,$e+=u*pt,xe+=u*at,St+=u*rt,mt+=u*Ot,nt+=u*Ct,De+=u*dt,Je+=u*At,Qe+=u*gt,ot+=u*bt,Me+=u*yt,Ye+=u*We,Ne+=u*Tt,He+=u*Rt,u=R[2],me+=u*lt,Re+=u*tt,$e+=u*ft,xe+=u*pt,St+=u*at,mt+=u*rt,nt+=u*Ot,De+=u*Ct,Je+=u*dt,Qe+=u*At,ot+=u*gt,Me+=u*bt,Ye+=u*yt,Ne+=u*We,He+=u*Tt,ht+=u*Rt,u=R[3],Re+=u*lt,$e+=u*tt,xe+=u*ft,St+=u*pt,mt+=u*at,nt+=u*rt,De+=u*Ot,Je+=u*Ct,Qe+=u*dt,ot+=u*At,Me+=u*gt,Ye+=u*bt,Ne+=u*yt,He+=u*We,ht+=u*Tt,qe+=u*Rt,u=R[4],$e+=u*lt,xe+=u*tt,St+=u*ft,mt+=u*pt,nt+=u*at,De+=u*rt,Je+=u*Ot,Qe+=u*Ct,ot+=u*dt,Me+=u*At,Ye+=u*gt,Ne+=u*bt,He+=u*yt,ht+=u*We,qe+=u*Tt,Pt+=u*Rt,u=R[5],xe+=u*lt,St+=u*tt,mt+=u*ft,nt+=u*pt,De+=u*at,Je+=u*rt,Qe+=u*Ot,ot+=u*Ct,Me+=u*dt,Ye+=u*At,Ne+=u*gt,He+=u*bt,ht+=u*yt,qe+=u*We,Pt+=u*Tt,Dt+=u*Rt,u=R[6],St+=u*lt,mt+=u*tt,nt+=u*ft,De+=u*pt,Je+=u*at,Qe+=u*rt,ot+=u*Ot,Me+=u*Ct,Ye+=u*dt,Ne+=u*At,He+=u*gt,ht+=u*bt,qe+=u*yt,Pt+=u*We,Dt+=u*Tt,kt+=u*Rt,u=R[7],mt+=u*lt,nt+=u*tt,De+=u*ft,Je+=u*pt,Qe+=u*at,ot+=u*rt,Me+=u*Ot,Ye+=u*Ct,Ne+=u*dt,He+=u*At,ht+=u*gt,qe+=u*bt,Pt+=u*yt,Dt+=u*We,kt+=u*Tt,Ht+=u*Rt,u=R[8],nt+=u*lt,De+=u*tt,Je+=u*ft,Qe+=u*pt,ot+=u*at,Me+=u*rt,Ye+=u*Ot,Ne+=u*Ct,He+=u*dt,ht+=u*At,qe+=u*gt,Pt+=u*bt,Dt+=u*yt,kt+=u*We,Ht+=u*Tt,jt+=u*Rt,u=R[9],De+=u*lt,Je+=u*tt,Qe+=u*ft,ot+=u*pt,Me+=u*at,Ye+=u*rt,Ne+=u*Ot,He+=u*Ct,ht+=u*dt,qe+=u*At,Pt+=u*gt,Dt+=u*bt,kt+=u*yt,Ht+=u*We,jt+=u*Tt,Jt+=u*Rt,u=R[10],Je+=u*lt,Qe+=u*tt,ot+=u*ft,Me+=u*pt,Ye+=u*at,Ne+=u*rt,He+=u*Ot,ht+=u*Ct,qe+=u*dt,Pt+=u*At,Dt+=u*gt,kt+=u*bt,Ht+=u*yt,jt+=u*We,Jt+=u*Tt,nr+=u*Rt,u=R[11],Qe+=u*lt,ot+=u*tt,Me+=u*ft,Ye+=u*pt,Ne+=u*at,He+=u*rt,ht+=u*Ot,qe+=u*Ct,Pt+=u*dt,Dt+=u*At,kt+=u*gt,Ht+=u*bt,jt+=u*yt,Jt+=u*We,nr+=u*Tt,Mr+=u*Rt,u=R[12],ot+=u*lt,Me+=u*tt,Ye+=u*ft,Ne+=u*pt,He+=u*at,ht+=u*rt,qe+=u*Ot,Pt+=u*Ct,Dt+=u*dt,kt+=u*At,Ht+=u*gt,jt+=u*bt,Jt+=u*yt,nr+=u*We,Mr+=u*Tt,Qt+=u*Rt,u=R[13],Me+=u*lt,Ye+=u*tt,Ne+=u*ft,He+=u*pt,ht+=u*at,qe+=u*rt,Pt+=u*Ot,Dt+=u*Ct,kt+=u*dt,Ht+=u*At,jt+=u*gt,Jt+=u*bt,nr+=u*yt,Mr+=u*We,Qt+=u*Tt,Jr+=u*Rt,u=R[14],Ye+=u*lt,Ne+=u*tt,He+=u*ft,ht+=u*pt,qe+=u*at,Pt+=u*rt,Dt+=u*Ot,kt+=u*Ct,Ht+=u*dt,jt+=u*At,Jt+=u*gt,nr+=u*bt,Mr+=u*yt,Qt+=u*We,Jr+=u*Tt,fi+=u*Rt,u=R[15],Ne+=u*lt,He+=u*tt,ht+=u*ft,qe+=u*pt,Pt+=u*at,Dt+=u*rt,kt+=u*Ot,Ht+=u*Ct,jt+=u*dt,Jt+=u*At,nr+=u*gt,Mr+=u*bt,Qt+=u*yt,Jr+=u*We,fi+=u*Tt,Ci+=u*Rt,ie+=38*He,fe+=38*ht,me+=38*qe,Re+=38*Pt,$e+=38*Dt,xe+=38*kt,St+=38*Ht,mt+=38*jt,nt+=38*Jt,De+=38*nr,Je+=38*Mr,Qe+=38*Qt,ot+=38*Jr,Me+=38*fi,Ye+=38*Ci,w=1,u=ie+w+65535,w=Math.floor(u/65536),ie=u-w*65536,u=fe+w+65535,w=Math.floor(u/65536),fe=u-w*65536,u=me+w+65535,w=Math.floor(u/65536),me=u-w*65536,u=Re+w+65535,w=Math.floor(u/65536),Re=u-w*65536,u=$e+w+65535,w=Math.floor(u/65536),$e=u-w*65536,u=xe+w+65535,w=Math.floor(u/65536),xe=u-w*65536,u=St+w+65535,w=Math.floor(u/65536),St=u-w*65536,u=mt+w+65535,w=Math.floor(u/65536),mt=u-w*65536,u=nt+w+65535,w=Math.floor(u/65536),nt=u-w*65536,u=De+w+65535,w=Math.floor(u/65536),De=u-w*65536,u=Je+w+65535,w=Math.floor(u/65536),Je=u-w*65536,u=Qe+w+65535,w=Math.floor(u/65536),Qe=u-w*65536,u=ot+w+65535,w=Math.floor(u/65536),ot=u-w*65536,u=Me+w+65535,w=Math.floor(u/65536),Me=u-w*65536,u=Ye+w+65535,w=Math.floor(u/65536),Ye=u-w*65536,u=Ne+w+65535,w=Math.floor(u/65536),Ne=u-w*65536,ie+=w-1+37*(w-1),w=1,u=ie+w+65535,w=Math.floor(u/65536),ie=u-w*65536,u=fe+w+65535,w=Math.floor(u/65536),fe=u-w*65536,u=me+w+65535,w=Math.floor(u/65536),me=u-w*65536,u=Re+w+65535,w=Math.floor(u/65536),Re=u-w*65536,u=$e+w+65535,w=Math.floor(u/65536),$e=u-w*65536,u=xe+w+65535,w=Math.floor(u/65536),xe=u-w*65536,u=St+w+65535,w=Math.floor(u/65536),St=u-w*65536,u=mt+w+65535,w=Math.floor(u/65536),mt=u-w*65536,u=nt+w+65535,w=Math.floor(u/65536),nt=u-w*65536,u=De+w+65535,w=Math.floor(u/65536),De=u-w*65536,u=Je+w+65535,w=Math.floor(u/65536),Je=u-w*65536,u=Qe+w+65535,w=Math.floor(u/65536),Qe=u-w*65536,u=ot+w+65535,w=Math.floor(u/65536),ot=u-w*65536,u=Me+w+65535,w=Math.floor(u/65536),Me=u-w*65536,u=Ye+w+65535,w=Math.floor(u/65536),Ye=u-w*65536,u=Ne+w+65535,w=Math.floor(u/65536),Ne=u-w*65536,ie+=w-1+37*(w-1),F[0]=ie,F[1]=fe,F[2]=me,F[3]=Re,F[4]=$e,F[5]=xe,F[6]=St,F[7]=mt,F[8]=nt,F[9]=De,F[10]=Je,F[11]=Qe,F[12]=ot,F[13]=Me,F[14]=Ye,F[15]=Ne}function z(F,R){$(F,R,R)}function ae(F,R){const P=o();let u;for(u=0;u<16;u++)P[u]=R[u];for(u=253;u>=0;u--)z(P,P),u!==2&&u!==4&&$(P,P,R);for(u=0;u<16;u++)F[u]=P[u]}function oe(F,R){const P=o();let u;for(u=0;u<16;u++)P[u]=R[u];for(u=250;u>=0;u--)z(P,P),u!==1&&$(P,P,R);for(u=0;u<16;u++)F[u]=P[u]}function Ee(F,R){const P=o(),u=o(),w=o(),ie=o(),fe=o(),me=o(),Re=o(),$e=o(),xe=o();_(P,F[1],F[0]),_(xe,R[1],R[0]),$(P,P,xe),D(u,F[0],F[1]),D(xe,R[0],R[1]),$(u,u,xe),$(w,F[3],R[3]),$(w,w,S),$(ie,F[2],R[2]),D(ie,ie,ie),_(fe,u,P),_(me,ie,w),D(Re,ie,w),D($e,u,P),$(F[0],fe,me),$(F[1],$e,Re),$(F[2],Re,me),$(F[3],fe,$e)}function Ae(F,R,P){for(let u=0;u<4;u++)J(F[u],R[u],P)}function et(F,R){const P=o(),u=o(),w=o();ae(w,R[2]),$(P,R[0],w),$(u,R[1],w),ce(F,u),F[31]^=N(P)<<7}function T(F,R,P){W(F[0],d),W(F[1],y),W(F[2],y),W(F[3],d);for(let u=255;u>=0;--u){const w=P[u/8|0]>>(u&7)&1;Ae(F,R,w),Ee(R,F),Ee(F,F),Ae(F,R,w)}}function k(F,R){const P=[o(),o(),o(),o()];W(P[0],C),W(P[1],j),W(P[2],y),$(P[3],C,j),T(F,P,R)}function Ue(F){if(F.length!==a.SEED_LENGTH)throw new Error(`ed25519: seed must be ${a.SEED_LENGTH} bytes`);const R=(0,r.hash)(F);R[0]&=248,R[31]&=127,R[31]|=64;const P=new Uint8Array(32),u=[o(),o(),o(),o()];k(u,R),et(P,u);const w=new Uint8Array(64);return w.set(F),w.set(P,32),{publicKey:P,secretKey:w}}a.generateKeyPairFromSeed=Ue;function Te(F){const R=(0,i.randomBytes)(32,F),P=Ue(R);return(0,s.wipe)(R),P}a.generateKeyPair=Te;function ee(F){if(F.length!==a.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${a.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(F.subarray(32))}a.extractPublicKeyFromSecretKey=ee;const Q=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function V(F,R){let P,u,w,ie;for(u=63;u>=32;--u){for(P=0,w=u-32,ie=u-12;w<ie;++w)R[w]+=P-16*R[u]*Q[w-(u-32)],P=Math.floor((R[w]+128)/256),R[w]-=P*256;R[w]+=P,R[u]=0}for(P=0,w=0;w<32;w++)R[w]+=P-(R[31]>>4)*Q[w],P=R[w]>>8,R[w]&=255;for(w=0;w<32;w++)R[w]-=P*Q[w];for(u=0;u<32;u++)R[u+1]+=R[u]>>8,F[u]=R[u]&255}function Y(F){const R=new Float64Array(64);for(let P=0;P<64;P++)R[P]=F[P];for(let P=0;P<64;P++)F[P]=0;V(F,R)}function ut(F,R){const P=new Float64Array(64),u=[o(),o(),o(),o()],w=(0,r.hash)(F.subarray(0,32));w[0]&=248,w[31]&=127,w[31]|=64;const ie=new Uint8Array(64);ie.set(w.subarray(32),32);const fe=new r.SHA512;fe.update(ie.subarray(32)),fe.update(R);const me=fe.digest();fe.clean(),Y(me),k(u,me),et(ie,u),fe.reset(),fe.update(ie.subarray(0,32)),fe.update(F.subarray(32)),fe.update(R);const Re=fe.digest();Y(Re);for(let $e=0;$e<32;$e++)P[$e]=me[$e];for(let $e=0;$e<32;$e++)for(let xe=0;xe<32;xe++)P[$e+xe]+=Re[$e]*w[xe];return V(ie.subarray(32),P),ie}a.sign=ut;function ke(F,R){const P=o(),u=o(),w=o(),ie=o(),fe=o(),me=o(),Re=o();return W(F[2],y),L(F[1],R),z(w,F[1]),$(ie,w,m),_(w,w,F[2]),D(ie,F[2],ie),z(fe,ie),z(me,fe),$(Re,me,fe),$(P,Re,w),$(P,P,ie),oe(P,P),$(P,P,w),$(P,P,ie),$(P,P,ie),$(F[0],P,ie),z(u,F[0]),$(u,u,ie),O(u,w)&&$(F[0],F[0],B),z(u,F[0]),$(u,u,ie),O(u,w)?-1:(N(F[0])===R[31]>>7&&_(F[0],d,F[0]),$(F[3],F[0],F[1]),0)}function Ur(F,R,P){const u=new Uint8Array(32),w=[o(),o(),o(),o()],ie=[o(),o(),o(),o()];if(P.length!==a.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${a.SIGNATURE_LENGTH} bytes`);if(ke(ie,F))return!1;const fe=new r.SHA512;fe.update(P.subarray(0,32)),fe.update(F),fe.update(R);const me=fe.digest();return Y(me),T(w,ie,me),k(ie,P.subarray(32)),Ee(w,ie),et(u,w),!ve(P,u)}a.verify=Ur;function we(F){let R=[o(),o(),o(),o()];if(ke(R,F))throw new Error("Ed25519: invalid public key");let P=o(),u=o(),w=R[1];D(P,y,w),_(u,y,w),ae(u,u),$(P,P,u);let ie=new Uint8Array(32);return ce(ie,P),ie}a.convertPublicKeyToX25519=we;function xt(F){const R=(0,r.hash)(F.subarray(0,32));R[0]&=248,R[31]&=127,R[31]|=64;const P=new Uint8Array(R.subarray(0,32));return(0,s.wipe)(R),P}a.convertSecretKeyToX25519=xt})(zc);const Wb="EdDSA",Jb="JWT",Of=".",Cf="base64url",Qb="utf8",Yb="utf8",Zb=":",Xb="did",ew="key",_l="base58btc",tw="z",rw="K36",iw=32;function xo(a){return sr(pr(Tc(a),Qb),Cf)}function Af(a){const i=pr(rw,_l),r=tw+sr(mc([i,a]),_l);return[Xb,ew,r].join(Zb)}function sw(a){return sr(a,Cf)}function nw(a){return pr([xo(a.header),xo(a.payload)].join(Of),Yb)}function ow(a){return[xo(a.header),xo(a.payload),sw(a.signature)].join(Of)}function El(a=Oo.randomBytes(iw)){return zc.generateKeyPairFromSeed(a)}async function aw(a,i,r,s,o=ne.fromMiliseconds(Date.now())){const h={alg:Wb,typ:Jb},d=Af(s.publicKey),y=o+r,m={iss:d,sub:a,aud:i,iat:o,exp:y},S=nw({header:h,payload:m}),C=zc.sign(s.secretKey,S);return ow({header:h,payload:m,signature:C})}const cw=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),uw=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Il=a=>a.split("?")[0],xl=10,hw=cw();class lw{constructor(i){if(this.url=i,this.events=new Wr.EventEmitter,this.registering=!1,!Bh(i))throw new Error(`Provided URL is not compatible with WebSocket connection: ${i}`);this.url=i}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}off(i,r){this.events.off(i,r)}removeListener(i,r){this.events.removeListener(i,r)}async open(i=this.url){await this.register(i)}async close(){return new Promise((i,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),i()},this.socket.close()})}async send(i,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Tc(i))}catch(s){this.onError(i.id,s)}}register(i=this.url){if(!Bh(i))throw new Error(`Provided URL is not compatible with WebSocket connection: ${i}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,o)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),o(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return o(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=i,this.registering=!0,new Promise((r,s)=>{const o=Ym.isReactNative()?void 0:{rejectUnauthorized:!Zm(i)},h=new hw(i,[],o);uw()?h.onerror=d=>{const y=d;s(this.emitError(y.error))}:h.on("error",d=>{s(this.emitError(d))}),h.onopen=()=>{this.onOpen(h),r(h)}})}onOpen(i){i.onmessage=r=>this.onPayload(r),i.onclose=r=>this.onClose(r),this.socket=i,this.registering=!1,this.events.emit("open")}onClose(i){this.socket=void 0,this.registering=!1,this.events.emit("close",i)}onPayload(i){if(typeof i.data>"u")return;const r=typeof i.data=="string"?cf(i.data):i.data;this.events.emit("payload",r)}onError(i,r){const s=this.parseError(r),o=s.message||s.toString(),h=Rc(i,o);this.events.emit("payload",h)}parseError(i,r=this.url){return Xm(i,Il(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>xl&&this.events.setMaxListeners(xl)}emitError(i){const r=this.parseError(new Error(i?.message||`WebSocket connection failed for host: ${Il(this.url)}`));return this.events.emit("register_error",r),r}}var So={exports:{}};So.exports;(function(a,i){var r=200,s="__lodash_hash_undefined__",o=1,h=2,d=9007199254740991,y="[object Arguments]",m="[object Array]",S="[object AsyncFunction]",C="[object Boolean]",j="[object Date]",B="[object Error]",W="[object Function]",G="[object GeneratorFunction]",J="[object Map]",ce="[object Number]",ve="[object Null]",O="[object Object]",N="[object Promise]",L="[object Proxy]",D="[object RegExp]",_="[object Set]",$="[object String]",z="[object Symbol]",ae="[object Undefined]",oe="[object WeakMap]",Ee="[object ArrayBuffer]",Ae="[object DataView]",et="[object Float32Array]",T="[object Float64Array]",k="[object Int8Array]",Ue="[object Int16Array]",Te="[object Int32Array]",ee="[object Uint8Array]",Q="[object Uint8ClampedArray]",V="[object Uint16Array]",Y="[object Uint32Array]",ut=/[\\^$.*+?()[\]{}|]/g,ke=/^\[object .+?Constructor\]$/,Ur=/^(?:0|[1-9]\d*)$/,we={};we[et]=we[T]=we[k]=we[Ue]=we[Te]=we[ee]=we[Q]=we[V]=we[Y]=!0,we[y]=we[m]=we[Ee]=we[C]=we[Ae]=we[j]=we[B]=we[W]=we[J]=we[ce]=we[O]=we[D]=we[_]=we[$]=we[oe]=!1;var xt=typeof Ki=="object"&&Ki&&Ki.Object===Object&&Ki,F=typeof self=="object"&&self&&self.Object===Object&&self,R=xt||F||Function("return this")(),P=i&&!i.nodeType&&i,u=P&&!0&&a&&!a.nodeType&&a,w=u&&u.exports===P,ie=w&&xt.process,fe=function(){try{return ie&&ie.binding&&ie.binding("util")}catch{}}(),me=fe&&fe.isTypedArray;function Re(g,E){for(var H=-1,te=g==null?0:g.length,Ve=0,de=[];++H<te;){var Ze=g[H];E(Ze,H,g)&&(de[Ve++]=Ze)}return de}function $e(g,E){for(var H=-1,te=E.length,Ve=g.length;++H<te;)g[Ve+H]=E[H];return g}function xe(g,E){for(var H=-1,te=g==null?0:g.length;++H<te;)if(E(g[H],H,g))return!0;return!1}function St(g,E){for(var H=-1,te=Array(g);++H<g;)te[H]=E(H);return te}function mt(g){return function(E){return g(E)}}function nt(g,E){return g.has(E)}function De(g,E){return g?.[E]}function Je(g){var E=-1,H=Array(g.size);return g.forEach(function(te,Ve){H[++E]=[Ve,te]}),H}function Qe(g,E){return function(H){return g(E(H))}}function ot(g){var E=-1,H=Array(g.size);return g.forEach(function(te){H[++E]=te}),H}var Me=Array.prototype,Ye=Function.prototype,Ne=Object.prototype,He=R["__core-js_shared__"],ht=Ye.toString,qe=Ne.hasOwnProperty,Pt=function(){var g=/[^.]+$/.exec(He&&He.keys&&He.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),Dt=Ne.toString,kt=RegExp("^"+ht.call(qe).replace(ut,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ht=w?R.Buffer:void 0,jt=R.Symbol,Jt=R.Uint8Array,nr=Ne.propertyIsEnumerable,Mr=Me.splice,Qt=jt?jt.toStringTag:void 0,Jr=Object.getOwnPropertySymbols,fi=Ht?Ht.isBuffer:void 0,Ci=Qe(Object.keys,Object),lt=dr(R,"DataView"),tt=dr(R,"Map"),ft=dr(R,"Promise"),pt=dr(R,"Set"),at=dr(R,"WeakMap"),rt=dr(Object,"create"),Ot=Yr(lt),Ct=Yr(tt),dt=Yr(ft),At=Yr(pt),gt=Yr(at),bt=jt?jt.prototype:void 0,yt=bt?bt.valueOf:void 0;function We(g){var E=-1,H=g==null?0:g.length;for(this.clear();++E<H;){var te=g[E];this.set(te[0],te[1])}}function Tt(){this.__data__=rt?rt(null):{},this.size=0}function Rt(g){var E=this.has(g)&&delete this.__data__[g];return this.size-=E?1:0,E}function Ro(g){var E=this.__data__;if(rt){var H=E[g];return H===s?void 0:H}return qe.call(E,g)?E[g]:void 0}function No(g){var E=this.__data__;return rt?E[g]!==void 0:qe.call(E,g)}function $o(g,E){var H=this.__data__;return this.size+=this.has(g)?0:1,H[g]=rt&&E===void 0?s:E,this}We.prototype.clear=Tt,We.prototype.delete=Rt,We.prototype.get=Ro,We.prototype.has=No,We.prototype.set=$o;function _r(g){var E=-1,H=g==null?0:g.length;for(this.clear();++E<H;){var te=g[E];this.set(te[0],te[1])}}function Fo(){this.__data__=[],this.size=0}function Do(g){var E=this.__data__,H=Ai(E,g);if(H<0)return!1;var te=E.length-1;return H==te?E.pop():Mr.call(E,H,1),--this.size,!0}function Lo(g){var E=this.__data__,H=Ai(E,g);return H<0?void 0:E[H][1]}function qo(g){return Ai(this.__data__,g)>-1}function jo(g,E){var H=this.__data__,te=Ai(H,g);return te<0?(++this.size,H.push([g,E])):H[te][1]=E,this}_r.prototype.clear=Fo,_r.prototype.delete=Do,_r.prototype.get=Lo,_r.prototype.has=qo,_r.prototype.set=jo;function Qr(g){var E=-1,H=g==null?0:g.length;for(this.clear();++E<H;){var te=g[E];this.set(te[0],te[1])}}function Qi(){this.size=0,this.__data__={hash:new We,map:new(tt||_r),string:new We}}function Uo(g){var E=pi(this,g).delete(g);return this.size-=E?1:0,E}function Yi(g){return pi(this,g).get(g)}function Mo(g){return pi(this,g).has(g)}function zo(g,E){var H=pi(this,g),te=H.size;return H.set(g,E),this.size+=H.size==te?0:1,this}Qr.prototype.clear=Qi,Qr.prototype.delete=Uo,Qr.prototype.get=Yi,Qr.prototype.has=Mo,Qr.prototype.set=zo;function Zi(g){var E=-1,H=g==null?0:g.length;for(this.__data__=new Qr;++E<H;)this.add(g[E])}function hn(g){return this.__data__.set(g,s),this}function ln(g){return this.__data__.has(g)}Zi.prototype.add=Zi.prototype.push=hn,Zi.prototype.has=ln;function Rr(g){var E=this.__data__=new _r(g);this.size=E.size}function ko(){this.__data__=new _r,this.size=0}function Ho(g){var E=this.__data__,H=E.delete(g);return this.size=E.size,H}function Ko(g){return this.__data__.get(g)}function Vo(g){return this.__data__.has(g)}function fn(g,E){var H=this.__data__;if(H instanceof _r){var te=H.__data__;if(!tt||te.length<r-1)return te.push([g,E]),this.size=++H.size,this;H=this.__data__=new Qr(te)}return H.set(g,E),this.size=H.size,this}Rr.prototype.clear=ko,Rr.prototype.delete=Ho,Rr.prototype.get=Ko,Rr.prototype.has=Vo,Rr.prototype.set=fn;function pn(g,E){var H=ts(g),te=!H&&Sn(g),Ve=!H&&!te&&xs(g),de=!H&&!te&&!Ve&&Cn(g),Ze=H||te||Ve||de,Nt=Ze?St(g.length,String):[],Pe=Nt.length;for(var Be in g)(E||qe.call(g,Be))&&!(Ze&&(Be=="length"||Ve&&(Be=="offset"||Be=="parent")||de&&(Be=="buffer"||Be=="byteLength"||Be=="byteOffset")||wn(Be,Pe)))&&Nt.push(Be);return Nt}function Ai(g,E){for(var H=g.length;H--;)if(xn(g[H][0],E))return H;return-1}function Es(g,E,H){var te=E(g);return ts(g)?te:$e(te,H(g))}function Ti(g){return g==null?g===void 0?ae:ve:Qt&&Qt in Object(g)?mn(g):Wo(g)}function Is(g){return Ni(g)&&Ti(g)==y}function Ri(g,E,H,te,Ve){return g===E?!0:g==null||E==null||!Ni(g)&&!Ni(E)?g!==g&&E!==E:dn(g,E,H,te,Ri,Ve)}function dn(g,E,H,te,Ve,de){var Ze=ts(g),Nt=ts(E),Pe=Ze?m:zr(g),Be=Nt?m:zr(E);Pe=Pe==y?O:Pe,Be=Be==y?O:Be;var wt=Pe==O,or=Be==O,$t=Pe==Be;if($t&&xs(g)){if(!xs(E))return!1;Ze=!0,wt=!1}if($t&&!wt)return de||(de=new Rr),Ze||Cn(g)?Xi(g,E,H,te,Ve,de):Go(g,E,Pe,H,te,Ve,de);if(!(H&o)){var Xe=wt&&qe.call(g,"__wrapped__"),Yt=or&&qe.call(E,"__wrapped__");if(Xe||Yt){var Nr=Xe?g.value():g,Er=Yt?E.value():E;return de||(de=new Rr),Ve(Nr,Er,H,te,de)}}return $t?(de||(de=new Rr),vn(g,E,H,te,Ve,de)):!1}function Bo(g){if(!On(g)||En(g))return!1;var E=rs(g)?kt:ke;return E.test(Yr(g))}function gn(g){return Ni(g)&&Pn(g.length)&&!!we[Ti(g)]}function yn(g){if(!In(g))return Ci(g);var E=[];for(var H in Object(g))qe.call(g,H)&&H!="constructor"&&E.push(H);return E}function Xi(g,E,H,te,Ve,de){var Ze=H&o,Nt=g.length,Pe=E.length;if(Nt!=Pe&&!(Ze&&Pe>Nt))return!1;var Be=de.get(g);if(Be&&de.get(E))return Be==E;var wt=-1,or=!0,$t=H&h?new Zi:void 0;for(de.set(g,E),de.set(E,g);++wt<Nt;){var Xe=g[wt],Yt=E[wt];if(te)var Nr=Ze?te(Yt,Xe,wt,E,g,de):te(Xe,Yt,wt,g,E,de);if(Nr!==void 0){if(Nr)continue;or=!1;break}if($t){if(!xe(E,function(Er,kr){if(!nt($t,kr)&&(Xe===Er||Ve(Xe,Er,H,te,de)))return $t.push(kr)})){or=!1;break}}else if(!(Xe===Yt||Ve(Xe,Yt,H,te,de))){or=!1;break}}return de.delete(g),de.delete(E),or}function Go(g,E,H,te,Ve,de,Ze){switch(H){case Ae:if(g.byteLength!=E.byteLength||g.byteOffset!=E.byteOffset)return!1;g=g.buffer,E=E.buffer;case Ee:return!(g.byteLength!=E.byteLength||!de(new Jt(g),new Jt(E)));case C:case j:case ce:return xn(+g,+E);case B:return g.name==E.name&&g.message==E.message;case D:case $:return g==E+"";case J:var Nt=Je;case _:var Pe=te&o;if(Nt||(Nt=ot),g.size!=E.size&&!Pe)return!1;var Be=Ze.get(g);if(Be)return Be==E;te|=h,Ze.set(g,E);var wt=Xi(Nt(g),Nt(E),te,Ve,de,Ze);return Ze.delete(g),wt;case z:if(yt)return yt.call(g)==yt.call(E)}return!1}function vn(g,E,H,te,Ve,de){var Ze=H&o,Nt=es(g),Pe=Nt.length,Be=es(E),wt=Be.length;if(Pe!=wt&&!Ze)return!1;for(var or=Pe;or--;){var $t=Nt[or];if(!(Ze?$t in E:qe.call(E,$t)))return!1}var Xe=de.get(g);if(Xe&&de.get(E))return Xe==E;var Yt=!0;de.set(g,E),de.set(E,g);for(var Nr=Ze;++or<Pe;){$t=Nt[or];var Er=g[$t],kr=E[$t];if(te)var Ss=Ze?te(kr,Er,$t,E,g,de):te(Er,kr,$t,g,E,de);if(!(Ss===void 0?Er===kr||Ve(Er,kr,H,te,de):Ss)){Yt=!1;break}Nr||(Nr=$t=="constructor")}if(Yt&&!Nr){var $i=g.constructor,Ut=E.constructor;$i!=Ut&&"constructor"in g&&"constructor"in E&&!(typeof $i=="function"&&$i instanceof $i&&typeof Ut=="function"&&Ut instanceof Ut)&&(Yt=!1)}return de.delete(g),de.delete(E),Yt}function es(g){return Es(g,Yo,bn)}function pi(g,E){var H=g.__data__;return _n(E)?H[typeof E=="string"?"string":"hash"]:H.map}function dr(g,E){var H=De(g,E);return Bo(H)?H:void 0}function mn(g){var E=qe.call(g,Qt),H=g[Qt];try{g[Qt]=void 0;var te=!0}catch{}var Ve=Dt.call(g);return te&&(E?g[Qt]=H:delete g[Qt]),Ve}var bn=Jr?function(g){return g==null?[]:(g=Object(g),Re(Jr(g),function(E){return nr.call(g,E)}))}:Ke,zr=Ti;(lt&&zr(new lt(new ArrayBuffer(1)))!=Ae||tt&&zr(new tt)!=J||ft&&zr(ft.resolve())!=N||pt&&zr(new pt)!=_||at&&zr(new at)!=oe)&&(zr=function(g){var E=Ti(g),H=E==O?g.constructor:void 0,te=H?Yr(H):"";if(te)switch(te){case Ot:return Ae;case Ct:return J;case dt:return N;case At:return _;case gt:return oe}return E});function wn(g,E){return E=E??d,!!E&&(typeof g=="number"||Ur.test(g))&&g>-1&&g%1==0&&g<E}function _n(g){var E=typeof g;return E=="string"||E=="number"||E=="symbol"||E=="boolean"?g!=="__proto__":g===null}function En(g){return!!Pt&&Pt in g}function In(g){var E=g&&g.constructor,H=typeof E=="function"&&E.prototype||Ne;return g===H}function Wo(g){return Dt.call(g)}function Yr(g){if(g!=null){try{return ht.call(g)}catch{}try{return g+""}catch{}}return""}function xn(g,E){return g===E||g!==g&&E!==E}var Sn=Is(function(){return arguments}())?Is:function(g){return Ni(g)&&qe.call(g,"callee")&&!nr.call(g,"callee")},ts=Array.isArray;function Jo(g){return g!=null&&Pn(g.length)&&!rs(g)}var xs=fi||ze;function Qo(g,E){return Ri(g,E)}function rs(g){if(!On(g))return!1;var E=Ti(g);return E==W||E==G||E==S||E==L}function Pn(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=d}function On(g){var E=typeof g;return g!=null&&(E=="object"||E=="function")}function Ni(g){return g!=null&&typeof g=="object"}var Cn=me?mt(me):gn;function Yo(g){return Jo(g)?pn(g):yn(g)}function Ke(){return[]}function ze(){return!1}a.exports=Qo})(So,So.exports);var fw=So.exports;const pw=Wm(fw);function dw(a,i){if(a.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var o=0;o<a.length;o++){var h=a.charAt(o),d=h.charCodeAt(0);if(r[d]!==255)throw new TypeError(h+" is ambiguous");r[d]=o}var y=a.length,m=a.charAt(0),S=Math.log(y)/Math.log(256),C=Math.log(256)/Math.log(y);function j(G){if(G instanceof Uint8Array||(ArrayBuffer.isView(G)?G=new Uint8Array(G.buffer,G.byteOffset,G.byteLength):Array.isArray(G)&&(G=Uint8Array.from(G))),!(G instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(G.length===0)return"";for(var J=0,ce=0,ve=0,O=G.length;ve!==O&&G[ve]===0;)ve++,J++;for(var N=(O-ve)*C+1>>>0,L=new Uint8Array(N);ve!==O;){for(var D=G[ve],_=0,$=N-1;(D!==0||_<ce)&&$!==-1;$--,_++)D+=256*L[$]>>>0,L[$]=D%y>>>0,D=D/y>>>0;if(D!==0)throw new Error("Non-zero carry");ce=_,ve++}for(var z=N-ce;z!==N&&L[z]===0;)z++;for(var ae=m.repeat(J);z<N;++z)ae+=a.charAt(L[z]);return ae}function B(G){if(typeof G!="string")throw new TypeError("Expected String");if(G.length===0)return new Uint8Array;var J=0;if(G[J]!==" "){for(var ce=0,ve=0;G[J]===m;)ce++,J++;for(var O=(G.length-J)*S+1>>>0,N=new Uint8Array(O);G[J];){var L=r[G.charCodeAt(J)];if(L===255)return;for(var D=0,_=O-1;(L!==0||D<ve)&&_!==-1;_--,D++)L+=y*N[_]>>>0,N[_]=L%256>>>0,L=L/256>>>0;if(L!==0)throw new Error("Non-zero carry");ve=D,J++}if(G[J]!==" "){for(var $=O-ve;$!==O&&N[$]===0;)$++;for(var z=new Uint8Array(ce+(O-$)),ae=ce;$!==O;)z[ae++]=N[$++];return z}}}function W(G){var J=B(G);if(J)return J;throw new Error(`Non-${i} character`)}return{encode:j,decodeUnsafe:B,decode:W}}var gw=dw,yw=gw;const Tf=a=>{if(a instanceof Uint8Array&&a.constructor.name==="Uint8Array")return a;if(a instanceof ArrayBuffer)return new Uint8Array(a);if(ArrayBuffer.isView(a))return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);throw new Error("Unknown type, must be binary type")},vw=a=>new TextEncoder().encode(a),mw=a=>new TextDecoder().decode(a);class bw{constructor(i,r,s){this.name=i,this.prefix=r,this.baseEncode=s}encode(i){if(i instanceof Uint8Array)return`${this.prefix}${this.baseEncode(i)}`;throw Error("Unknown type, must be binary type")}}class ww{constructor(i,r,s){if(this.name=i,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(i){if(typeof i=="string"){if(i.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(i)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(i.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(i){return Rf(this,i)}}class _w{constructor(i){this.decoders=i}or(i){return Rf(this,i)}decode(i){const r=i[0],s=this.decoders[r];if(s)return s.decode(i);throw RangeError(`Unable to decode multibase string ${JSON.stringify(i)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Rf=(a,i)=>new _w({...a.decoders||{[a.prefix]:a},...i.decoders||{[i.prefix]:i}});class Ew{constructor(i,r,s,o){this.name=i,this.prefix=r,this.baseEncode=s,this.baseDecode=o,this.encoder=new bw(i,r,s),this.decoder=new ww(i,r,o)}encode(i){return this.encoder.encode(i)}decode(i){return this.decoder.decode(i)}}const Ao=({name:a,prefix:i,encode:r,decode:s})=>new Ew(a,i,r,s),un=({prefix:a,name:i,alphabet:r})=>{const{encode:s,decode:o}=yw(r,i);return Ao({prefix:a,name:i,encode:s,decode:h=>Tf(o(h))})},Iw=(a,i,r,s)=>{const o={};for(let C=0;C<i.length;++C)o[i[C]]=C;let h=a.length;for(;a[h-1]==="=";)--h;const d=new Uint8Array(h*r/8|0);let y=0,m=0,S=0;for(let C=0;C<h;++C){const j=o[a[C]];if(j===void 0)throw new SyntaxError(`Non-${s} character`);m=m<<r|j,y+=r,y>=8&&(y-=8,d[S++]=255&m>>y)}if(y>=r||255&m<<8-y)throw new SyntaxError("Unexpected end of data");return d},xw=(a,i,r)=>{const s=i[i.length-1]==="=",o=(1<<r)-1;let h="",d=0,y=0;for(let m=0;m<a.length;++m)for(y=y<<8|a[m],d+=8;d>r;)d-=r,h+=i[o&y>>d];if(d&&(h+=i[o&y<<r-d]),s)for(;h.length*r&7;)h+="=";return h},Vt=({name:a,prefix:i,bitsPerChar:r,alphabet:s})=>Ao({prefix:i,name:a,encode(o){return xw(o,s,r)},decode(o){return Iw(o,s,r,a)}}),Sw=Ao({prefix:"\0",name:"identity",encode:a=>mw(a),decode:a=>vw(a)});var Pw=Object.freeze({__proto__:null,identity:Sw});const Ow=Vt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Cw=Object.freeze({__proto__:null,base2:Ow});const Aw=Vt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Tw=Object.freeze({__proto__:null,base8:Aw});const Rw=un({prefix:"9",name:"base10",alphabet:"0123456789"});var Nw=Object.freeze({__proto__:null,base10:Rw});const $w=Vt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Fw=Vt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Dw=Object.freeze({__proto__:null,base16:$w,base16upper:Fw});const Lw=Vt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),qw=Vt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),jw=Vt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Uw=Vt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Mw=Vt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),zw=Vt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),kw=Vt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Hw=Vt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Kw=Vt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Vw=Object.freeze({__proto__:null,base32:Lw,base32upper:qw,base32pad:jw,base32padupper:Uw,base32hex:Mw,base32hexupper:zw,base32hexpad:kw,base32hexpadupper:Hw,base32z:Kw});const Bw=un({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Gw=un({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Ww=Object.freeze({__proto__:null,base36:Bw,base36upper:Gw});const Jw=un({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Qw=un({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Yw=Object.freeze({__proto__:null,base58btc:Jw,base58flickr:Qw});const Zw=Vt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Xw=Vt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),e_=Vt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),t_=Vt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var r_=Object.freeze({__proto__:null,base64:Zw,base64pad:Xw,base64url:e_,base64urlpad:t_});const Nf=Array.from(""),i_=Nf.reduce((a,i,r)=>(a[r]=i,a),[]),s_=Nf.reduce((a,i,r)=>(a[i.codePointAt(0)]=r,a),[]);function n_(a){return a.reduce((i,r)=>(i+=i_[r],i),"")}function o_(a){const i=[];for(const r of a){const s=s_[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);i.push(s)}return new Uint8Array(i)}const a_=Ao({prefix:"",name:"base256emoji",encode:n_,decode:o_});var c_=Object.freeze({__proto__:null,base256emoji:a_}),u_=$f,Sl=128,h_=127,l_=~h_,f_=Math.pow(2,31);function $f(a,i,r){i=i||[],r=r||0;for(var s=r;a>=f_;)i[r++]=a&255|Sl,a/=128;for(;a&l_;)i[r++]=a&255|Sl,a>>>=7;return i[r]=a|0,$f.bytes=r-s+1,i}var p_=Ic,d_=128,Pl=127;function Ic(a,s){var r=0,s=s||0,o=0,h=s,d,y=a.length;do{if(h>=y)throw Ic.bytes=0,new RangeError("Could not decode varint");d=a[h++],r+=o<28?(d&Pl)<<o:(d&Pl)*Math.pow(2,o),o+=7}while(d>=d_);return Ic.bytes=h-s,r}var g_=Math.pow(2,7),y_=Math.pow(2,14),v_=Math.pow(2,21),m_=Math.pow(2,28),b_=Math.pow(2,35),w_=Math.pow(2,42),__=Math.pow(2,49),E_=Math.pow(2,56),I_=Math.pow(2,63),x_=function(a){return a<g_?1:a<y_?2:a<v_?3:a<m_?4:a<b_?5:a<w_?6:a<__?7:a<E_?8:a<I_?9:10},S_={encode:u_,decode:p_,encodingLength:x_},Ff=S_;const Ol=(a,i,r=0)=>(Ff.encode(a,i,r),i),Cl=a=>Ff.encodingLength(a),xc=(a,i)=>{const r=i.byteLength,s=Cl(a),o=s+Cl(r),h=new Uint8Array(o+r);return Ol(a,h,0),Ol(r,h,s),h.set(i,o),new P_(a,r,i,h)};class P_{constructor(i,r,s,o){this.code=i,this.size=r,this.digest=s,this.bytes=o}}const Df=({name:a,code:i,encode:r})=>new O_(a,i,r);class O_{constructor(i,r,s){this.name=i,this.code=r,this.encode=s}digest(i){if(i instanceof Uint8Array){const r=this.encode(i);return r instanceof Uint8Array?xc(this.code,r):r.then(s=>xc(this.code,s))}else throw Error("Unknown type, must be binary type")}}const Lf=a=>async i=>new Uint8Array(await crypto.subtle.digest(a,i)),C_=Df({name:"sha2-256",code:18,encode:Lf("SHA-256")}),A_=Df({name:"sha2-512",code:19,encode:Lf("SHA-512")});var T_=Object.freeze({__proto__:null,sha256:C_,sha512:A_});const qf=0,R_="identity",jf=Tf,N_=a=>xc(qf,jf(a)),$_={code:qf,name:R_,encode:jf,digest:N_};var F_=Object.freeze({__proto__:null,identity:$_});new TextEncoder,new TextDecoder;const Al={...Pw,...Cw,...Tw,...Nw,...Dw,...Vw,...Ww,...Yw,...r_,...c_};({...T_,...F_});function Uf(a){return globalThis.Buffer!=null?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):a}function D_(a=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Uf(globalThis.Buffer.allocUnsafe(a)):new Uint8Array(a)}function Mf(a,i,r,s){return{name:a,prefix:i,encoder:{name:a,prefix:i,encode:r},decoder:{decode:s}}}const Tl=Mf("utf8","u",a=>"u"+new TextDecoder("utf8").decode(a),a=>new TextEncoder().encode(a.substring(1))),uc=Mf("ascii","a",a=>{let i="a";for(let r=0;r<a.length;r++)i+=String.fromCharCode(a[r]);return i},a=>{a=a.substring(1);const i=D_(a.length);for(let r=0;r<a.length;r++)i[r]=a.charCodeAt(r);return i}),L_={utf8:Tl,"utf-8":Tl,hex:Al.base16,latin1:uc,ascii:uc,binary:uc,...Al};function q_(a,i="utf8"){const r=L_[i];if(!r)throw new Error(`Unsupported encoding "${i}"`);return(i==="utf8"||i==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Uf(globalThis.Buffer.from(a,"utf-8")):r.decoder.decode(`${r.prefix}${a}`)}const zf="wc",j_=2,kc="core",Si=`${zf}@2:${kc}:`,U_={name:kc,logger:"error"},M_={database:":memory:"},z_="crypto",Rl="client_ed25519_seed",k_=ne.ONE_DAY,H_="keychain",K_="0.3",V_="messages",B_="0.3",G_=ne.SIX_HOURS,W_="publisher",kf="irn",J_="error",Hf="wss://relay.walletconnect.com",Nl="wss://relay.walletconnect.org",Q_="relayer",Wt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Y_="_subscription",ai={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Z_=ne.ONE_SECOND,X_="2.10.2",eE=1e4,tE="0.3",rE="WALLETCONNECT_CLIENT_ID",qr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},iE="subscription",sE="0.3",nE=ne.FIVE_SECONDS*1e3,oE="pairing",aE="0.3",Bs={wc_pairingDelete:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:0},res:{ttl:ne.ONE_DAY,prompt:!1,tag:0}}},Zs={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Br={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},cE="history",uE="0.3",hE="expirer",Tr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},lE="0.3",hc="verify-api",_o="https://verify.walletconnect.com",$l="https://verify.walletconnect.org";class fE{constructor(i,r){this.core=i,this.logger=r,this.keychain=new Map,this.name=H_,this.version=K_,this.initialized=!1,this.storagePrefix=Si,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,o)=>{this.isInitialized(),this.keychain.set(s,o),await this.persist()},this.get=s=>{this.isInitialized();const o=this.keychain.get(s);if(typeof o>"u"){const{message:h}=X("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(h)}return o},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=i,this.logger=Ce.generateChildLogger(r,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(i){await this.core.storage.setItem(this.storageKey,yf(i))}async getKeyChain(){const i=await this.core.storage.getItem(this.storageKey);return typeof i<"u"?vf(i):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class pE{constructor(i,r,s){this.core=i,this.logger=r,this.name=z_,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=o=>(this.isInitialized(),this.keychain.has(o)),this.getClientId=async()=>{this.isInitialized();const o=await this.getClientSeed(),h=El(o);return Af(h.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const o=a1();return this.setPrivateKey(o.publicKey,o.privateKey)},this.signJWT=async o=>{this.isInitialized();const h=await this.getClientSeed(),d=El(h),y=_c();return await aw(y,o,k_,d)},this.generateSharedKey=(o,h,d)=>{this.isInitialized();const y=this.getPrivateKey(o),m=c1(y,h);return this.setSymKey(m,d)},this.setSymKey=async(o,h)=>{this.isInitialized();const d=h||u1(o);return await this.keychain.set(d,o),d},this.deleteKeyPair=async o=>{this.isInitialized(),await this.keychain.del(o)},this.deleteSymKey=async o=>{this.isInitialized(),await this.keychain.del(o)},this.encode=async(o,h,d)=>{this.isInitialized();const y=gf(d),m=Tc(h);if(Qh(y)){const B=y.senderPublicKey,W=y.receiverPublicKey;o=await this.generateSharedKey(B,W)}const S=this.getSymKey(o),{type:C,senderPublicKey:j}=y;return l1({type:C,symKey:S,message:m,senderPublicKey:j})},this.decode=async(o,h,d)=>{this.isInitialized();const y=d1(h,d);if(Qh(y)){const m=y.receiverPublicKey,S=y.senderPublicKey;o=await this.generateSharedKey(m,S)}try{const m=this.getSymKey(o),S=f1({symKey:m,encoded:h});return cf(S)}catch(m){this.logger.error(`Failed to decode message from topic: '${o}', clientId: '${await this.getClientId()}'`),this.logger.error(m)}},this.getPayloadType=o=>{const h=Eo(o);return sn(h.type)},this.getPayloadSenderPublicKey=o=>{const h=Eo(o);return h.senderPublicKey?sr(h.senderPublicKey,ir):void 0},this.core=i,this.logger=Ce.generateChildLogger(r,this.name),this.keychain=s||new fE(this.core,this.logger)}get context(){return Ce.getLoggerContext(this.logger)}async setPrivateKey(i,r){return await this.keychain.set(i,r),i}getPrivateKey(i){return this.keychain.get(i)}async getClientSeed(){let i="";try{i=this.keychain.get(Rl)}catch{i=_c(),await this.keychain.set(Rl,i)}return q_(i,"base16")}getSymKey(i){return this.keychain.get(i)}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class dE extends Ub{constructor(i,r){super(i,r),this.logger=i,this.core=r,this.messages=new Map,this.name=V_,this.version=B_,this.initialized=!1,this.storagePrefix=Si,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,o)=>{this.isInitialized();const h=ms(o);let d=this.messages.get(s);return typeof d>"u"&&(d={}),typeof d[h]<"u"||(d[h]=o,this.messages.set(s,d),await this.persist()),h},this.get=s=>{this.isInitialized();let o=this.messages.get(s);return typeof o>"u"&&(o={}),o},this.has=(s,o)=>{this.isInitialized();const h=this.get(s),d=ms(o);return typeof h[d]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=Ce.generateChildLogger(i,this.name),this.core=r}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(i){await this.core.storage.setItem(this.storageKey,yf(i))}async getRelayerMessages(){const i=await this.core.storage.getItem(this.storageKey);return typeof i<"u"?vf(i):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class gE extends Mb{constructor(i,r){super(i,r),this.relayer=i,this.logger=r,this.events=new Wr.EventEmitter,this.name=W_,this.queue=new Map,this.publishTimeout=ne.toMiliseconds(ne.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,o,h)=>{var d;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:o,opts:h}});try{const y=h?.ttl||G_,m=Ec(h),S=h?.prompt||!1,C=h?.tag||0,j=h?.id||e1().toString(),B={topic:s,message:o,opts:{ttl:y,relay:m,prompt:S,tag:C,id:j}},W=setTimeout(()=>this.queue.set(j,B),this.publishTimeout);try{await await rn(this.rpcPublish(s,o,y,m,S,C,j),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(j),this.relayer.events.emit(Wt.publish,B)}catch(G){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(d=h?.internal)!=null&&d.throwOnFailedPublish)throw this.removeRequestFromQueue(j),G;return}finally{clearTimeout(W)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:o,opts:h}})}catch(y){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(y),y}},this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.relayer=i,this.logger=Ce.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Ce.getLoggerContext(this.logger)}rpcPublish(i,r,s,o,h,d,y){var m,S,C,j;const B={method:bo(o.protocol).publish,params:{topic:i,message:r,ttl:s,prompt:h,tag:d},id:y};return rr((m=B.params)==null?void 0:m.prompt)&&((S=B.params)==null||delete S.prompt),rr((C=B.params)==null?void 0:C.tag)&&((j=B.params)==null||delete j.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:B}),this.relayer.request(B)}removeRequestFromQueue(i){this.queue.delete(i)}checkQueue(){this.queue.forEach(async i=>{const{topic:r,message:s,opts:o}=i;await this.publish(r,s,o)})}registerEventListeners(){this.relayer.core.heartbeat.on(_s.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Wt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Wt.message_ack,i=>{this.removeRequestFromQueue(i.id.toString())})}}class yE{constructor(){this.map=new Map,this.set=(i,r)=>{const s=this.get(i);this.exists(i,r)||this.map.set(i,[...s,r])},this.get=i=>this.map.get(i)||[],this.exists=(i,r)=>this.get(i).includes(r),this.delete=(i,r)=>{if(typeof r>"u"){this.map.delete(i);return}if(!this.map.has(i))return;const s=this.get(i);if(!this.exists(i,r))return;const o=s.filter(h=>h!==r);if(!o.length){this.map.delete(i);return}this.map.set(i,o)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var vE=Object.defineProperty,mE=Object.defineProperties,bE=Object.getOwnPropertyDescriptors,Fl=Object.getOwnPropertySymbols,wE=Object.prototype.hasOwnProperty,_E=Object.prototype.propertyIsEnumerable,Dl=(a,i,r)=>i in a?vE(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,Gs=(a,i)=>{for(var r in i||(i={}))wE.call(i,r)&&Dl(a,r,i[r]);if(Fl)for(var r of Fl(i))_E.call(i,r)&&Dl(a,r,i[r]);return a},lc=(a,i)=>mE(a,bE(i));class EE extends Hb{constructor(i,r){super(i,r),this.relayer=i,this.logger=r,this.subscriptions=new Map,this.topicMap=new yE,this.events=new Wr.EventEmitter,this.name=iE,this.version=sE,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Si,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,o)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:o}});try{const h=Ec(o),d={topic:s,relay:h};this.pending.set(s,d);const y=await this.rpcSubscribe(s,h);return this.onSubscribe(y,d),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:o}}),y}catch(h){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(h),h}},this.unsubscribe=async(s,o)=>{await this.restartToComplete(),this.isInitialized(),typeof o?.id<"u"?await this.unsubscribeById(s,o.id,o):await this.unsubscribeByTopic(s,o)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((o,h)=>{const d=new ne.Watch;d.start(this.pendingSubscriptionWatchLabel);const y=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(y),d.stop(this.pendingSubscriptionWatchLabel),o(!0)),d.elapsed(this.pendingSubscriptionWatchLabel)>=nE&&(clearInterval(y),d.stop(this.pendingSubscriptionWatchLabel),h(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=i,this.logger=Ce.generateChildLogger(r,this.name),this.clientId=""}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(i,r){let s=!1;try{s=this.getSubscription(i).topic===r}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(i,r){const s=this.topicMap.get(i);await Promise.all(s.map(async o=>await this.unsubscribeById(i,o,r)))}async unsubscribeById(i,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:i,id:r,opts:s}});try{const o=Ec(s);await this.rpcUnsubscribe(i,r,o);const h=It("USER_DISCONNECTED",`${this.name}, ${i}`);await this.onUnsubscribe(i,r,h),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:i,id:r,opts:s}})}catch(o){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(o),o}}async rpcSubscribe(i,r){const s={method:bo(r.protocol).subscribe,params:{topic:i}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await rn(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Wt.connection_stalled)}return ms(i+this.clientId)}async rpcBatchSubscribe(i){if(!i.length)return;const r=i[0].relay,s={method:bo(r.protocol).batchSubscribe,params:{topics:i.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await rn(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Wt.connection_stalled)}}rpcUnsubscribe(i,r,s){const o={method:bo(s.protocol).unsubscribe,params:{topic:i,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o}),this.relayer.request(o)}onSubscribe(i,r){this.setSubscription(i,lc(Gs({},r),{id:i})),this.pending.delete(r.topic)}onBatchSubscribe(i){i.length&&i.forEach(r=>{this.setSubscription(r.id,Gs({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(i,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,i)&&this.deleteSubscription(r,s),await this.relayer.messages.del(i)}async setRelayerSubscriptions(i){await this.relayer.core.storage.setItem(this.storageKey,i)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(i,r){this.subscriptions.has(i)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:i,subscription:r}),this.addSubscription(i,r))}addSubscription(i,r){this.subscriptions.set(i,Gs({},r)),this.topicMap.set(r.topic,i),this.events.emit(qr.created,r)}getSubscription(i){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:i});const r=this.subscriptions.get(i);if(!r){const{message:s}=X("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(s)}return r}deleteSubscription(i,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:i,reason:r});const s=this.getSubscription(i);this.subscriptions.delete(i),this.topicMap.delete(s.topic,i),this.events.emit(qr.deleted,lc(Gs({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(qr.sync)}async reset(){if(this.cached.length){const i=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<i;r++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(qr.resubscribed)}async restore(){try{const i=await this.getRelayerSubscriptions();if(typeof i>"u"||!i.length)return;if(this.subscriptions.size){const{message:r}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(i){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(i)}}async batchSubscribe(i){if(!i.length)return;const r=await this.rpcBatchSubscribe(i);Gr(r)&&this.onBatchSubscribe(r.map((s,o)=>lc(Gs({},i[o]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const i=[];this.pending.forEach(r=>{i.push(r)}),await this.batchSubscribe(i)}registerEventListeners(){this.relayer.core.heartbeat.on(_s.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Wt.connect,async()=>{await this.onConnect()}),this.relayer.on(Wt.disconnect,()=>{this.onDisconnect()}),this.events.on(qr.created,async i=>{const r=qr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),await this.persist()}),this.events.on(qr.deleted,async i=>{const r=qr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}async restartToComplete(){this.restartInProgress&&await new Promise(i=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),i())},this.pollingInterval)})}}var IE=Object.defineProperty,Ll=Object.getOwnPropertySymbols,xE=Object.prototype.hasOwnProperty,SE=Object.prototype.propertyIsEnumerable,ql=(a,i,r)=>i in a?IE(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,PE=(a,i)=>{for(var r in i||(i={}))xE.call(i,r)&&ql(a,r,i[r]);if(Ll)for(var r of Ll(i))SE.call(i,r)&&ql(a,r,i[r]);return a};class OE extends zb{constructor(i){super(i),this.protocol="wc",this.version=2,this.events=new Wr.EventEmitter,this.name=Q_,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Wt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Wt.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ai.payload,this.onPayloadHandler),this.provider.on(ai.connect,this.onConnectHandler),this.provider.on(ai.disconnect,this.onDisconnectHandler),this.provider.on(ai.error,this.onProviderErrorHandler)},this.core=i.core,this.logger=typeof i.logger<"u"&&typeof i.logger!="string"?Ce.generateChildLogger(i.logger,this.name):Ce.pino(Ce.getDefaultLoggerOptions({level:i.logger||J_})),this.messages=new dE(this.logger,i.core),this.subscriber=new EE(this,this.logger),this.publisher=new gE(this,this.logger),this.relayUrl=i?.relayUrl||Hf,this.projectId=i.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Nl}...`),await this.restartTransport(Nl)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},eE)}get context(){return Ce.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(i,r,s){this.isInitialized(),await this.publisher.publish(i,r,s),await this.recordMessageEvent({topic:i,message:r,publishedAt:Date.now()})}async subscribe(i,r){var s;this.isInitialized();let o=((s=this.subscriber.topicMap.get(i))==null?void 0:s[0])||"";if(o)return o;let h;const d=y=>{y.topic===i&&(this.subscriber.off(qr.created,d),h())};return await Promise.all([new Promise(y=>{h=y,this.subscriber.on(qr.created,d)}),new Promise(async y=>{o=await this.subscriber.subscribe(i,r),y()})]),o}async unsubscribe(i,r){this.isInitialized(),await this.subscriber.unsubscribe(i,r)}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}off(i,r){this.events.off(i,r)}removeListener(i,r){this.events.removeListener(i,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await rn(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(i){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){i&&i!==this.relayUrl&&(this.relayUrl=i,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(qr.resubscribed,()=>{r()})}),new Promise(async(r,s)=>{try{await rn(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(o){s(o);return}r()})])}catch(r){this.logger.error(r);const s=r;if(!this.isConnectionStalled(s.message))throw r;this.provider.events.emit(ai.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(i){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=i||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await ol())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(i){return this.staleConnectionErrors.some(r=>i.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const i=await this.core.crypto.signJWT(this.relayUrl);this.provider=new hi(new lw(S1({sdkVersion:X_,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:i,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(i){const{topic:r,message:s}=i;await this.messages.set(r,s)}async shouldIgnoreMessageEvent(i){const{topic:r,message:s}=i;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const o=this.messages.has(r,s);return o&&this.logger.debug(`Ignoring duplicate message: ${s}`),o}async onProviderPayload(i){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:i}),Nc(i)){if(!i.method.endsWith(Y_))return;const r=i.params,{topic:s,message:o,publishedAt:h}=r.data,d={topic:s,message:o,publishedAt:h};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(PE({type:"event",event:r.id},d)),this.events.emit(r.id,d),await this.acknowledgePayload(i),await this.onMessageEvent(d)}else $c(i)&&this.events.emit(Wt.message_ack,i)}async onMessageEvent(i){await this.shouldIgnoreMessageEvent(i)||(this.events.emit(Wt.message,i),await this.recordMessageEvent(i))}async acknowledgePayload(i){const r=Fc(i.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ai.payload,this.onPayloadHandler),this.provider.off(ai.connect,this.onConnectHandler),this.provider.off(ai.disconnect,this.onDisconnectHandler),this.provider.off(ai.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Wt.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let i=await ol();vb(async r=>{this.initialized&&i!==r&&(i=r,r?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(Wt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(i=>this.logger.error(i))},ne.toMiliseconds(Z_)))}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(i=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),i())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var CE=Object.defineProperty,jl=Object.getOwnPropertySymbols,AE=Object.prototype.hasOwnProperty,TE=Object.prototype.propertyIsEnumerable,Ul=(a,i,r)=>i in a?CE(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,Ml=(a,i)=>{for(var r in i||(i={}))AE.call(i,r)&&Ul(a,r,i[r]);if(jl)for(var r of jl(i))TE.call(i,r)&&Ul(a,r,i[r]);return a};class To extends kb{constructor(i,r,s,o=Si,h=void 0){super(i,r,s,o),this.core=i,this.logger=r,this.name=s,this.map=new Map,this.version=tE,this.cached=[],this.initialized=!1,this.storagePrefix=Si,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(d=>{this.getKey&&d!==null&&!rr(d)?this.map.set(this.getKey(d),d):W1(d)?this.map.set(d.id,d):J1(d)&&this.map.set(d.topic,d)}),this.cached=[],this.initialized=!0)},this.set=async(d,y)=>{this.isInitialized(),this.map.has(d)?await this.update(d,y):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:d,value:y}),this.map.set(d,y),await this.persist())},this.get=d=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:d}),this.getData(d)),this.getAll=d=>(this.isInitialized(),d?this.values.filter(y=>Object.keys(d).every(m=>pw(y[m],d[m]))):this.values),this.update=async(d,y)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:d,update:y});const m=Ml(Ml({},this.getData(d)),y);this.map.set(d,m),await this.persist()},this.delete=async(d,y)=>{this.isInitialized(),this.map.has(d)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:d,reason:y}),this.map.delete(d),await this.persist())},this.logger=Ce.generateChildLogger(r,this.name),this.storagePrefix=o,this.getKey=h}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(i){await this.core.storage.setItem(this.storageKey,i)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(i){const r=this.map.get(i);if(!r){const{message:s}=X("NO_MATCHING_KEY",`${this.name}: ${i}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const i=await this.getDataStore();if(typeof i>"u"||!i.length)return;if(this.map.size){const{message:r}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(i){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(i)}}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class RE{constructor(i,r){this.core=i,this.logger=r,this.name=oE,this.version=aE,this.events=new Ac,this.initialized=!1,this.storagePrefix=Si,this.ignoredPayloadTypes=[Gi],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=_c(),o=await this.core.crypto.setSymKey(s),h=jr(ne.FIVE_MINUTES),d={protocol:kf},y={topic:o,expiry:h,relay:d,active:!1},m=j1({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:s,relay:d});return await this.pairings.set(o,y),await this.core.relayer.subscribe(o),this.core.expirer.set(o,h),{topic:o,uri:m}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:o,symKey:h,relay:d}=D1(s.uri);let y;if(this.pairings.keys.includes(o)&&(y=this.pairings.get(o),y.active))throw new Error(`Pairing already exists: ${o}. Please try again with a new connection URI.`);this.core.crypto.keychain.has(o)||(await this.core.crypto.setSymKey(h,o),await this.core.relayer.subscribe(o,{relay:d}));const m=jr(ne.FIVE_MINUTES),S={topic:o,relay:d,expiry:m,active:!1};return await this.pairings.set(o,S),this.core.expirer.set(o,m),s.activatePairing&&await this.activate({topic:o}),this.events.emit(Zs.create,S),S},this.activate=async({topic:s})=>{this.isInitialized();const o=jr(ne.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:o}),this.core.expirer.set(s,o)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:o}=s;if(this.pairings.keys.includes(o)){const h=await this.sendRequest(o,"wc_pairingPing",{}),{done:d,resolve:y,reject:m}=ys();this.events.once(Ft("pairing_ping",h),({error:S})=>{S?m(S):y()}),await d()}},this.updateExpiry=async({topic:s,expiry:o})=>{this.isInitialized(),await this.pairings.update(s,{expiry:o})},this.updateMetadata=async({topic:s,metadata:o})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:o})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:o}=s;this.pairings.keys.includes(o)&&(await this.sendRequest(o,"wc_pairingDelete",It("USER_DISCONNECTED")),await this.deletePairing(o))},this.sendRequest=async(s,o,h)=>{const d=en(o,h),y=await this.core.crypto.encode(s,d),m=Bs[o].req;return this.core.history.set(s,d),this.core.relayer.publish(s,y,m),d.id},this.sendResult=async(s,o,h)=>{const d=Fc(s,h),y=await this.core.crypto.encode(o,d),m=await this.core.history.get(o,s),S=Bs[m.request.method].res;await this.core.relayer.publish(o,y,S),await this.core.history.resolve(d)},this.sendError=async(s,o,h)=>{const d=Rc(s,h),y=await this.core.crypto.encode(o,d),m=await this.core.history.get(o,s),S=Bs[m.request.method]?Bs[m.request.method].res:Bs.unregistered_method.res;await this.core.relayer.publish(o,y,S),await this.core.history.resolve(d)},this.deletePairing=async(s,o)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,It("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),o?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(o=>xi(o.expiry));await Promise.all(s.map(o=>this.deletePairing(o.topic)))},this.onRelayEventRequest=s=>{const{topic:o,payload:h}=s;switch(h.method){case"wc_pairingPing":return this.onPairingPingRequest(o,h);case"wc_pairingDelete":return this.onPairingDeleteRequest(o,h);default:return this.onUnknownRpcMethodRequest(o,h)}},this.onRelayEventResponse=async s=>{const{topic:o,payload:h}=s,d=(await this.core.history.get(o,h.id)).request.method;switch(d){case"wc_pairingPing":return this.onPairingPingResponse(o,h);default:return this.onUnknownRpcMethodResponse(d)}},this.onPairingPingRequest=async(s,o)=>{const{id:h}=o;try{this.isValidPing({topic:s}),await this.sendResult(h,s,!0),this.events.emit(Zs.ping,{id:h,topic:s})}catch(d){await this.sendError(h,s,d),this.logger.error(d)}},this.onPairingPingResponse=(s,o)=>{const{id:h}=o;setTimeout(()=>{Ii(o)?this.events.emit(Ft("pairing_ping",h),{}):ui(o)&&this.events.emit(Ft("pairing_ping",h),{error:o.error})},500)},this.onPairingDeleteRequest=async(s,o)=>{const{id:h}=o;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(Zs.delete,{id:h,topic:s})}catch(d){await this.sendError(h,s,d),this.logger.error(d)}},this.onUnknownRpcMethodRequest=async(s,o)=>{const{id:h,method:d}=o;try{if(this.registeredMethods.includes(d))return;const y=It("WC_METHOD_UNSUPPORTED",d);await this.sendError(h,s,y),this.logger.error(y)}catch(y){await this.sendError(h,s,y),this.logger.error(y)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(It("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{if(!fr(s)){const{message:o}=X("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(o)}if(!G1(s.uri)){const{message:o}=X("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(o)}},this.isValidPing=async s=>{if(!fr(s)){const{message:h}=X("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(h)}const{topic:o}=s;await this.isValidPairingTopic(o)},this.isValidDisconnect=async s=>{if(!fr(s)){const{message:h}=X("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(h)}const{topic:o}=s;await this.isValidPairingTopic(o)},this.isValidPairingTopic=async s=>{if(!zt(s,!1)){const{message:o}=X("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(o)}if(!this.pairings.keys.includes(s)){const{message:o}=X("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(o)}if(xi(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:o}=X("EXPIRED",`pairing topic: ${s}`);throw new Error(o)}},this.core=i,this.logger=Ce.generateChildLogger(r,this.name),this.pairings=new To(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ce.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}registerRelayerEvents(){this.core.relayer.on(Wt.message,async i=>{const{topic:r,message:s}=i;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const o=await this.core.crypto.decode(r,s);try{Nc(o)?(this.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):$c(o)&&(await this.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.core.history.delete(r,o.id))}catch(h){this.logger.error(h)}})}registerExpirerEvents(){this.core.expirer.on(Tr.expired,async i=>{const{topic:r}=bf(i.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Zs.expire,{topic:r}))})}}class NE extends jb{constructor(i,r){super(i,r),this.core=i,this.logger=r,this.records=new Map,this.events=new Wr.EventEmitter,this.name=cE,this.version=uE,this.cached=[],this.initialized=!1,this.storagePrefix=Si,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,o,h)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:o,chainId:h}),this.records.has(o.id))return;const d={id:o.id,topic:s,request:{method:o.method,params:o.params||null},chainId:h,expiry:jr(ne.THIRTY_DAYS)};this.records.set(d.id,d),this.events.emit(Br.created,d)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const o=await this.getRecord(s.id);typeof o.response>"u"&&(o.response=ui(s)?{error:s.error}:{result:s.result},this.records.set(o.id,o),this.events.emit(Br.updated,o))},this.get=async(s,o)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:o}),await this.getRecord(o)),this.delete=(s,o)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:o}),this.values.forEach(h=>{if(h.topic===s){if(typeof o<"u"&&h.id!==o)return;this.records.delete(h.id),this.events.emit(Br.deleted,h)}})},this.exists=async(s,o)=>(this.isInitialized(),this.records.has(o)?(await this.getRecord(o)).topic===s:!1),this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.logger=Ce.generateChildLogger(r,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const i=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const s={topic:r.topic,request:en(r.request.method,r.request.params,r.id),chainId:r.chainId};return i.push(s)}),i}async setJsonRpcRecords(i){await this.core.storage.setItem(this.storageKey,i)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(i){this.isInitialized();const r=this.records.get(i);if(!r){const{message:s}=X("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Br.sync)}async restore(){try{const i=await this.getJsonRpcRecords();if(typeof i>"u"||!i.length)return;if(this.records.size){const{message:r}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}}registerEventListeners(){this.events.on(Br.created,i=>{const r=Br.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:i}),this.persist()}),this.events.on(Br.updated,i=>{const r=Br.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:i}),this.persist()}),this.events.on(Br.deleted,i=>{const r=Br.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:i}),this.persist()}),this.core.heartbeat.on(_s.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(i=>{ne.toMiliseconds(i.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${i.id}`),this.delete(i.topic,i.id))})}catch(i){this.logger.warn(i)}}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class $E extends Kb{constructor(i,r){super(i,r),this.core=i,this.logger=r,this.expirations=new Map,this.events=new Wr.EventEmitter,this.name=hE,this.version=lE,this.cached=[],this.initialized=!1,this.storagePrefix=Si,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const o=this.formatTarget(s);return typeof this.getExpiration(o)<"u"}catch{return!1}},this.set=(s,o)=>{this.isInitialized();const h=this.formatTarget(s),d={target:h,expiry:o};this.expirations.set(h,d),this.checkExpiry(h,d),this.events.emit(Tr.created,{target:h,expiration:d})},this.get=s=>{this.isInitialized();const o=this.formatTarget(s);return this.getExpiration(o)},this.del=s=>{if(this.isInitialized(),this.has(s)){const o=this.formatTarget(s),h=this.getExpiration(o);this.expirations.delete(o),this.events.emit(Tr.deleted,{target:o,expiration:h})}},this.on=(s,o)=>{this.events.on(s,o)},this.once=(s,o)=>{this.events.once(s,o)},this.off=(s,o)=>{this.events.off(s,o)},this.removeListener=(s,o)=>{this.events.removeListener(s,o)},this.logger=Ce.generateChildLogger(r,this.name)}get context(){return Ce.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(i){if(typeof i=="string")return P1(i);if(typeof i=="number")return O1(i);const{message:r}=X("UNKNOWN_TYPE",`Target type: ${typeof i}`);throw new Error(r)}async setExpirations(i){await this.core.storage.setItem(this.storageKey,i)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Tr.sync)}async restore(){try{const i=await this.getExpirations();if(typeof i>"u"||!i.length)return;if(this.expirations.size){const{message:r}=X("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=i,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(i){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(i)}}getExpiration(i){const r=this.expirations.get(i);if(!r){const{message:s}=X("NO_MATCHING_KEY",`${this.name}: ${i}`);throw this.logger.error(s),new Error(s)}return r}checkExpiry(i,r){const{expiry:s}=r;ne.toMiliseconds(s)-Date.now()<=0&&this.expire(i,r)}expire(i,r){this.expirations.delete(i),this.events.emit(Tr.expired,{target:i,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((i,r)=>this.checkExpiry(r,i))}registerEventListeners(){this.core.heartbeat.on(_s.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Tr.created,i=>{const r=Tr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),this.persist()}),this.events.on(Tr.expired,i=>{const r=Tr.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),this.persist()}),this.events.on(Tr.deleted,i=>{const r=Tr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:i}),this.persist()})}isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}}}class FE extends Vb{constructor(i,r){super(i,r),this.projectId=i,this.logger=r,this.name=hc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async()=>{if(this.verifyDisabled||nn()||!on())return;const s=_o;this.verifyUrl!==s&&this.removeIframe(),this.verifyUrl=s;try{await this.createIframe()}catch(o){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(o)}if(!this.initialized){this.removeIframe(),this.verifyUrl=$l;try{await this.createIframe()}catch(o){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(o),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const o=s?.verifyUrl||_o;let h;try{h=await this.fetchAttestation(s.attestationId,o)}catch(d){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${o}`),this.logger.info(d),h=await this.fetchAttestation(s.attestationId,$l)}return h},this.fetchAttestation=async(s,o)=>{this.logger.info(`resolving attestation: ${s} from url: ${o}`);const h=this.startAbortTimer(ne.ONE_SECOND*2),d=await fetch(`${o}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(h),d.status===200?await d.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var o;try{if(!this.iframe)return;(o=this.iframe.contentWindow)==null||o.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const o=h=>{h.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",o),s())};await Promise.race([new Promise(h=>{if(document.getElementById(hc))return h();window.addEventListener("message",o);const d=document.createElement("iframe");d.id=hc,d.src=`${this.verifyUrl}/${this.projectId}`,d.style.display="none",document.body.append(d),this.iframe=d,s=h}),new Promise((h,d)=>setTimeout(()=>{window.removeEventListener("message",o),d("verify iframe load timeout")},ne.toMiliseconds(ne.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.logger=Ce.generateChildLogger(r,this.name),this.verifyUrl=_o,this.abortController=new AbortController,this.isDevEnv=jc()&&{}.IS_VITEST}get context(){return Ce.getLoggerContext(this.logger)}startAbortTimer(i){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),ne.toMiliseconds(i))}}var DE=Object.defineProperty,zl=Object.getOwnPropertySymbols,LE=Object.prototype.hasOwnProperty,qE=Object.prototype.propertyIsEnumerable,kl=(a,i,r)=>i in a?DE(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,Hl=(a,i)=>{for(var r in i||(i={}))LE.call(i,r)&&kl(a,r,i[r]);if(zl)for(var r of zl(i))qE.call(i,r)&&kl(a,r,i[r]);return a};class Hc extends qb{constructor(i){super(i),this.protocol=zf,this.version=j_,this.name=kc,this.events=new Wr.EventEmitter,this.initialized=!1,this.on=(s,o)=>this.events.on(s,o),this.once=(s,o)=>this.events.once(s,o),this.off=(s,o)=>this.events.off(s,o),this.removeListener=(s,o)=>this.events.removeListener(s,o),this.projectId=i?.projectId,this.relayUrl=i?.relayUrl||Hf,this.customStoragePrefix=i!=null&&i.customStoragePrefix?`:${i.customStoragePrefix}`:"";const r=typeof i?.logger<"u"&&typeof i?.logger!="string"?i.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:i?.logger||U_.logger}));this.logger=Ce.generateChildLogger(r,this.name),this.heartbeat=new _s.HeartBeat,this.crypto=new pE(this,this.logger,i?.keychain),this.history=new NE(this,this.logger),this.expirer=new $E(this,this.logger),this.storage=i!=null&&i.storage?i.storage:new Cb(Hl(Hl({},M_),i?.storageOptions)),this.relayer=new OE({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new RE(this,this.logger),this.verify=new FE(this.projectId||"",this.logger)}static async init(i){const r=new Hc(i);await r.initialize();const s=await r.crypto.getClientId();return await r.storage.setItem(rE,s),r}get context(){return Ce.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(i){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,i),this.logger.error(i.message),i}}}const jE=Hc,Kf="wc",Vf=2,Bf="client",Kc=`${Kf}@${Vf}:${Bf}:`,fc={name:Bf,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Kl="WALLETCONNECT_DEEPLINK_CHOICE",UE="proposal",Gf="Proposal expired",ME="session",yo=ne.SEVEN_DAYS,zE="engine",Ws={wc_sessionPropose:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ne.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ne.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ne.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ne.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:ne.THIRTY_SECONDS,prompt:!1,tag:1115}}},pc={min:ne.FIVE_MINUTES,max:ne.SEVEN_DAYS},ci={idle:"IDLE",active:"ACTIVE"},kE="request",HE=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var KE=Object.defineProperty,VE=Object.defineProperties,BE=Object.getOwnPropertyDescriptors,Vl=Object.getOwnPropertySymbols,GE=Object.prototype.hasOwnProperty,WE=Object.prototype.propertyIsEnumerable,Bl=(a,i,r)=>i in a?KE(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,lr=(a,i)=>{for(var r in i||(i={}))GE.call(i,r)&&Bl(a,r,i[r]);if(Vl)for(var r of Vl(i))WE.call(i,r)&&Bl(a,r,i[r]);return a},Js=(a,i)=>VE(a,BE(i));class JE extends Gb{constructor(i){super(i),this.name=zE,this.events=new Ac,this.initialized=!1,this.ignoredPayloadTypes=[Gi],this.requestQueue={state:ci.idle,queue:[]},this.sessionRequestQueue={state:ci.idle,queue:[]},this.requestQueueDelay=ne.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Ws)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},ne.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const s=Js(lr({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:o,requiredNamespaces:h,optionalNamespaces:d,sessionProperties:y,relays:m}=s;let S=o,C,j=!1;if(S&&(j=this.client.core.pairing.pairings.get(S).active),!S||!j){const{topic:N,uri:L}=await this.client.core.pairing.create();S=N,C=L}const B=await this.client.core.crypto.generateKeyPair(),W=lr({requiredNamespaces:h,optionalNamespaces:d,relays:m??[{protocol:kf}],proposer:{publicKey:B,metadata:this.client.metadata}},y&&{sessionProperties:y}),{reject:G,resolve:J,done:ce}=ys(ne.FIVE_MINUTES,Gf);if(this.events.once(Ft("session_connect"),async({error:N,session:L})=>{if(N)G(N);else if(L){L.self.publicKey=B;const D=Js(lr({},L),{requiredNamespaces:L.requiredNamespaces,optionalNamespaces:L.optionalNamespaces});await this.client.session.set(L.topic,D),await this.setExpiry(L.topic,L.expiry),S&&await this.client.core.pairing.updateMetadata({topic:S,metadata:L.peer.metadata}),J(D)}}),!S){const{message:N}=X("NO_MATCHING_KEY",`connect() pairing topic: ${S}`);throw new Error(N)}const ve=await this.sendRequest({topic:S,method:"wc_sessionPropose",params:W}),O=jr(ne.FIVE_MINUTES);return await this.setProposal(ve,lr({id:ve,expiry:O},W)),{uri:C,approval:ce}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:s,relayProtocol:o,namespaces:h,sessionProperties:d}=r,y=this.client.proposal.get(s);let{pairingTopic:m,proposer:S,requiredNamespaces:C,optionalNamespaces:j}=y;m=m||"",bs(C)||(C=k1(h,"approve()"));const B=await this.client.core.crypto.generateKeyPair(),W=S.publicKey,G=await this.client.core.crypto.generateSharedKey(B,W);m&&s&&(await this.client.core.pairing.updateMetadata({topic:m,metadata:S.metadata}),await this.sendResult({id:s,topic:m,result:{relay:{protocol:o??"irn"},responderPublicKey:B}}),await this.client.proposal.delete(s,It("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:m}));const J=lr({relay:{protocol:o??"irn"},namespaces:h,requiredNamespaces:C,optionalNamespaces:j,pairingTopic:m,controller:{publicKey:B,metadata:this.client.metadata},expiry:jr(yo)},d&&{sessionProperties:d});await this.client.core.relayer.subscribe(G),await this.sendRequest({topic:G,method:"wc_sessionSettle",params:J,throwOnFailedPublish:!0});const ce=Js(lr({},J),{topic:G,pairingTopic:m,acknowledged:!1,self:J.controller,peer:{publicKey:S.publicKey,metadata:S.metadata},controller:B});return await this.client.session.set(G,ce),await this.setExpiry(G,jr(yo)),{topic:G,acknowledged:()=>new Promise(ve=>setTimeout(()=>ve(this.client.session.get(G)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:s,reason:o}=r,{pairingTopic:h}=this.client.proposal.get(s);h&&(await this.sendError(s,h,o),await this.client.proposal.delete(s,It("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:s,namespaces:o}=r,h=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:o}}),{done:d,resolve:y,reject:m}=ys();return this.events.once(Ft("session_update",h),({error:S})=>{S?m(S):y()}),await this.client.session.update(s,{namespaces:o}),{acknowledged:d}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:s}=r,o=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:h,resolve:d,reject:y}=ys();return this.events.once(Ft("session_extend",o),({error:m})=>{m?y(m):d()}),await this.setExpiry(s,jr(yo)),{acknowledged:h}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:s,request:o,topic:h,expiry:d}=r,y=t1(),{done:m,resolve:S,reject:C}=ys(d,"Request expired. Please try again.");return this.events.once(Ft("session_request",y),({error:j,result:B})=>{j?C(j):S(B)}),await Promise.all([new Promise(async j=>{await this.sendRequest({clientRpcId:y,topic:h,method:"wc_sessionRequest",params:{request:o,chainId:s},expiry:d,throwOnFailedPublish:!0}).catch(B=>C(B)),this.client.events.emit("session_request_sent",{topic:h,request:o,chainId:s,id:y}),j()}),new Promise(async j=>{const B=await this.client.core.storage.getItem(Kl);C1({id:y,topic:h,wcDeepLink:B}),j()}),m()]).then(j=>j[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:s,response:o}=r,{id:h}=o;Ii(o)?await this.sendResult({id:h,topic:s,result:o.result,throwOnFailedPublish:!0}):ui(o)&&await this.sendError(h,s,o.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const o=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:h,resolve:d,reject:y}=ys();this.events.once(Ft("session_ping",o),({error:m})=>{m?y(m):d()}),await h()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:s,event:o,chainId:h}=r;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:o,chainId:h}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:It("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(s=>V1(s,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const s=this.client.core.pairing.pairings.get(r.pairingTopic),o=this.client.core.pairing.pairings.getAll().filter(h=>{var d,y;return((d=h.peerMetadata)==null?void 0:d.url)&&((y=h.peerMetadata)==null?void 0:y.url)===r.peer.metadata.url&&h.topic&&h.topic!==s.topic});if(o.length===0)return;this.client.logger.info(`Cleaning up ${o.length} duplicate pairing(s)`),await Promise.all(o.map(h=>this.client.core.pairing.disconnect({topic:h.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(r,s)=>{const{self:o}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,It("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(o.publicKey)&&await this.client.core.crypto.deleteKeyPair(o.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),s||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Kl).catch(h=>this.client.logger.warn(h))},this.deleteProposal=async(r,s)=>{await Promise.all([this.client.proposal.delete(r,It("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,s,o=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),o?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(h=>h.id!==r),o&&(this.sessionRequestQueue.state=ci.idle)},this.setExpiry=async(r,s)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:s}),this.client.core.expirer.set(r,s)},this.setProposal=async(r,s)=>{await this.client.proposal.set(r,s),this.client.core.expirer.set(r,s.expiry)},this.setPendingSessionRequest=async r=>{const s=Ws.wc_sessionRequest.req.ttl,{id:o,topic:h,params:d,verifyContext:y}=r;await this.client.pendingRequest.set(o,{id:o,topic:h,params:d,verifyContext:y}),s&&this.client.core.expirer.set(o,jr(s))},this.sendRequest=async r=>{const{topic:s,method:o,params:h,expiry:d,relayRpcId:y,clientRpcId:m,throwOnFailedPublish:S}=r,C=en(o,h,m);if(on()&&HE.includes(o)){const W=ms(JSON.stringify(C));this.client.core.verify.register({attestationId:W})}const j=await this.client.core.crypto.encode(s,C),B=Ws[o].req;return d&&(B.ttl=d),y&&(B.id=y),this.client.core.history.set(s,C),S?(B.internal=Js(lr({},B.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,j,B)):this.client.core.relayer.publish(s,j,B).catch(W=>this.client.logger.error(W)),C.id},this.sendResult=async r=>{const{id:s,topic:o,result:h,throwOnFailedPublish:d}=r,y=Fc(s,h),m=await this.client.core.crypto.encode(o,y),S=await this.client.core.history.get(o,s),C=Ws[S.request.method].res;d?(C.internal=Js(lr({},C.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(o,m,C)):this.client.core.relayer.publish(o,m,C).catch(j=>this.client.logger.error(j)),await this.client.core.history.resolve(y)},this.sendError=async(r,s,o)=>{const h=Rc(r,o),d=await this.client.core.crypto.encode(s,h),y=await this.client.core.history.get(s,r),m=Ws[y.request.method].res;this.client.core.relayer.publish(s,d,m),await this.client.core.history.resolve(h)},this.cleanup=async()=>{const r=[],s=[];this.client.session.getAll().forEach(o=>{xi(o.expiry)&&r.push(o.topic)}),this.client.proposal.getAll().forEach(o=>{xi(o.expiry)&&s.push(o.id)}),await Promise.all([...r.map(o=>this.deleteSession(o)),...s.map(o=>this.deleteProposal(o))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===ci.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ci.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=ci.idle},this.processRequest=r=>{const{topic:s,payload:o}=r,h=o.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeRequest(s,o);case"wc_sessionSettle":return this.onSessionSettleRequest(s,o);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,o);case"wc_sessionExtend":return this.onSessionExtendRequest(s,o);case"wc_sessionPing":return this.onSessionPingRequest(s,o);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,o);case"wc_sessionRequest":return this.onSessionRequest(s,o);case"wc_sessionEvent":return this.onSessionEventRequest(s,o);default:return this.client.logger.info(`Unsupported request method ${h}`)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:o}=r,h=(await this.client.core.history.get(s,o.id)).request.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeResponse(s,o);case"wc_sessionSettle":return this.onSessionSettleResponse(s,o);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,o);case"wc_sessionExtend":return this.onSessionExtendResponse(s,o);case"wc_sessionPing":return this.onSessionPingResponse(s,o);case"wc_sessionRequest":return this.onSessionRequestResponse(s,o);default:return this.client.logger.info(`Unsupported response method ${h}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:s}=r,{message:o}=X("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(o)},this.onSessionProposeRequest=async(r,s)=>{const{params:o,id:h}=s;try{this.isValidConnect(lr({},s.params));const d=jr(ne.FIVE_MINUTES),y=lr({id:h,pairingTopic:r,expiry:d},o);await this.setProposal(h,y);const m=ms(JSON.stringify(s)),S=await this.getVerifyContext(m,y.proposer.metadata);this.client.events.emit("session_proposal",{id:h,params:y,verifyContext:S})}catch(d){await this.sendError(h,r,d),this.client.logger.error(d)}},this.onSessionProposeResponse=async(r,s)=>{const{id:o}=s;if(Ii(s)){const{result:h}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:h});const d=this.client.proposal.get(o);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:d});const y=d.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:y});const m=h.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:m});const S=await this.client.core.crypto.generateSharedKey(y,m);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:S});const C=await this.client.core.relayer.subscribe(S);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:C}),await this.client.core.pairing.activate({topic:r})}else ui(s)&&(await this.client.proposal.delete(o,It("USER_DISCONNECTED")),this.events.emit(Ft("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(r,s)=>{const{id:o,params:h}=s;try{this.isValidSessionSettleRequest(h);const{relay:d,controller:y,expiry:m,namespaces:S,requiredNamespaces:C,optionalNamespaces:j,sessionProperties:B,pairingTopic:W}=s.params,G=lr({topic:r,relay:d,expiry:m,namespaces:S,acknowledged:!0,pairingTopic:W,requiredNamespaces:C,optionalNamespaces:j,controller:y.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:y.publicKey,metadata:y.metadata}},B&&{sessionProperties:B});await this.sendResult({id:s.id,topic:r,result:!0}),this.events.emit(Ft("session_connect"),{session:G}),this.cleanupDuplicatePairings(G)}catch(d){await this.sendError(o,r,d),this.client.logger.error(d)}},this.onSessionSettleResponse=async(r,s)=>{const{id:o}=s;Ii(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(Ft("session_approve",o),{})):ui(s)&&(await this.client.session.delete(r,It("USER_DISCONNECTED")),this.events.emit(Ft("session_approve",o),{error:s.error}))},this.onSessionUpdateRequest=async(r,s)=>{const{params:o,id:h}=s;try{const d=`${r}_session_update`,y=go.get(d);if(y&&this.isRequestOutOfSync(y,h)){this.client.logger.info(`Discarding out of sync request - ${h}`);return}this.isValidUpdate(lr({topic:r},o)),await this.client.session.update(r,{namespaces:o.namespaces}),await this.sendResult({id:h,topic:r,result:!0}),this.client.events.emit("session_update",{id:h,topic:r,params:o}),go.set(d,h)}catch(d){await this.sendError(h,r,d),this.client.logger.error(d)}},this.isRequestOutOfSync=(r,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,s)=>{const{id:o}=s;Ii(s)?this.events.emit(Ft("session_update",o),{}):ui(s)&&this.events.emit(Ft("session_update",o),{error:s.error})},this.onSessionExtendRequest=async(r,s)=>{const{id:o}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,jr(yo)),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_extend",{id:o,topic:r})}catch(h){await this.sendError(o,r,h),this.client.logger.error(h)}},this.onSessionExtendResponse=(r,s)=>{const{id:o}=s;Ii(s)?this.events.emit(Ft("session_extend",o),{}):ui(s)&&this.events.emit(Ft("session_extend",o),{error:s.error})},this.onSessionPingRequest=async(r,s)=>{const{id:o}=s;try{this.isValidPing({topic:r}),await this.sendResult({id:o,topic:r,result:!0}),this.client.events.emit("session_ping",{id:o,topic:r})}catch(h){await this.sendError(o,r,h),this.client.logger.error(h)}},this.onSessionPingResponse=(r,s)=>{const{id:o}=s;setTimeout(()=>{Ii(s)?this.events.emit(Ft("session_ping",o),{}):ui(s)&&this.events.emit(Ft("session_ping",o),{error:s.error})},500)},this.onSessionDeleteRequest=async(r,s)=>{const{id:o}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),await Promise.all([new Promise(h=>{this.client.core.relayer.once(Wt.publish,async()=>{h(await this.deleteSession(r))})}),this.sendResult({id:o,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:o,topic:r})}catch(h){this.client.logger.error(h)}},this.onSessionRequest=async(r,s)=>{const{id:o,params:h}=s;try{this.isValidRequest(lr({topic:r},h));const d=ms(JSON.stringify(en("wc_sessionRequest",h,o))),y=this.client.session.get(r),m=await this.getVerifyContext(d,y.peer.metadata),S={id:o,topic:r,params:h,verifyContext:m};await this.setPendingSessionRequest(S),this.addSessionRequestToSessionRequestQueue(S),this.processSessionRequestQueue()}catch(d){await this.sendError(o,r,d),this.client.logger.error(d)}},this.onSessionRequestResponse=(r,s)=>{const{id:o}=s;Ii(s)?this.events.emit(Ft("session_request",o),{result:s.result}):ui(s)&&this.events.emit(Ft("session_request",o),{error:s.error})},this.onSessionEventRequest=async(r,s)=>{const{id:o,params:h}=s;try{const d=`${r}_session_event_${h.event.name}`,y=go.get(d);if(y&&this.isRequestOutOfSync(y,o)){this.client.logger.info(`Discarding out of sync request - ${o}`);return}this.isValidEmit(lr({topic:r},h)),this.client.events.emit("session_event",{id:o,topic:r,params:h}),go.set(d,o)}catch(d){await this.sendError(o,r,d),this.client.logger.error(d)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ci.idle,this.processSessionRequestQueue()},ne.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===ci.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=ci.active,this.client.events.emit("session_request",r)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=r=>{if(r.active)return;const s=this.client.proposal.getAll().find(o=>o.pairingTopic===r.topic);s&&this.onSessionProposeRequest(r.topic,en("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer},s.id))},this.isValidConnect=async r=>{if(!fr(r)){const{message:m}=X("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(m)}const{pairingTopic:s,requiredNamespaces:o,optionalNamespaces:h,sessionProperties:d,relays:y}=r;if(rr(s)||await this.isValidPairingTopic(s),!ib(y,!0)){const{message:m}=X("MISSING_OR_INVALID",`connect() relays: ${y}`);throw new Error(m)}!rr(o)&&bs(o)!==0&&this.validateNamespaces(o,"requiredNamespaces"),!rr(h)&&bs(h)!==0&&this.validateNamespaces(h,"optionalNamespaces"),rr(d)||this.validateSessionProps(d,"sessionProperties")},this.validateNamespaces=(r,s)=>{const o=rb(r,"connect()",s);if(o)throw new Error(o.message)},this.isValidApprove=async r=>{if(!fr(r))throw new Error(X("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:s,namespaces:o,relayProtocol:h,sessionProperties:d}=r;await this.isValidProposalId(s);const y=this.client.proposal.get(s),m=wo(o,"approve()");if(m)throw new Error(m.message);const S=sl(y.requiredNamespaces,o,"approve()");if(S)throw new Error(S.message);if(!zt(h,!0)){const{message:C}=X("MISSING_OR_INVALID",`approve() relayProtocol: ${h}`);throw new Error(C)}rr(d)||this.validateSessionProps(d,"sessionProperties")},this.isValidReject=async r=>{if(!fr(r)){const{message:h}=X("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(h)}const{id:s,reason:o}=r;if(await this.isValidProposalId(s),!nb(o)){const{message:h}=X("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(o)}`);throw new Error(h)}},this.isValidSessionSettleRequest=r=>{if(!fr(r)){const{message:S}=X("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(S)}const{relay:s,controller:o,namespaces:h,expiry:d}=r;if(!_f(s)){const{message:S}=X("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(S)}const y=Q1(o,"onSessionSettleRequest()");if(y)throw new Error(y.message);const m=wo(h,"onSessionSettleRequest()");if(m)throw new Error(m.message);if(xi(d)){const{message:S}=X("EXPIRED","onSessionSettleRequest()");throw new Error(S)}},this.isValidUpdate=async r=>{if(!fr(r)){const{message:m}=X("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(m)}const{topic:s,namespaces:o}=r;await this.isValidSessionTopic(s);const h=this.client.session.get(s),d=wo(o,"update()");if(d)throw new Error(d.message);const y=sl(h.requiredNamespaces,o,"update()");if(y)throw new Error(y.message)},this.isValidExtend=async r=>{if(!fr(r)){const{message:o}=X("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidSessionTopic(s)},this.isValidRequest=async r=>{if(!fr(r)){const{message:m}=X("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(m)}const{topic:s,request:o,chainId:h,expiry:d}=r;await this.isValidSessionTopic(s);const{namespaces:y}=this.client.session.get(s);if(!il(y,h)){const{message:m}=X("MISSING_OR_INVALID",`request() chainId: ${h}`);throw new Error(m)}if(!ob(o)){const{message:m}=X("MISSING_OR_INVALID",`request() ${JSON.stringify(o)}`);throw new Error(m)}if(!ub(y,h,o.method)){const{message:m}=X("MISSING_OR_INVALID",`request() method: ${o.method}`);throw new Error(m)}if(d&&!pb(d,pc)){const{message:m}=X("MISSING_OR_INVALID",`request() expiry: ${d}. Expiry must be a number (in seconds) between ${pc.min} and ${pc.max}`);throw new Error(m)}},this.isValidRespond=async r=>{if(!fr(r)){const{message:h}=X("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(h)}const{topic:s,response:o}=r;if(await this.isValidSessionTopic(s),!ab(o)){const{message:h}=X("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(o)}`);throw new Error(h)}},this.isValidPing=async r=>{if(!fr(r)){const{message:o}=X("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async r=>{if(!fr(r)){const{message:y}=X("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(y)}const{topic:s,event:o,chainId:h}=r;await this.isValidSessionTopic(s);const{namespaces:d}=this.client.session.get(s);if(!il(d,h)){const{message:y}=X("MISSING_OR_INVALID",`emit() chainId: ${h}`);throw new Error(y)}if(!cb(o)){const{message:y}=X("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(y)}if(!hb(d,h,o.name)){const{message:y}=X("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(o)}`);throw new Error(y)}},this.isValidDisconnect=async r=>{if(!fr(r)){const{message:o}=X("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(r,s)=>{const o={verified:{verifyUrl:s.verifyUrl||_o,validation:"UNKNOWN",origin:s.url||""}};try{const h=await this.client.core.verify.resolve({attestationId:r,verifyUrl:s.verifyUrl});h&&(o.verified.origin=h.origin,o.verified.isScam=h.isScam,o.verified.validation=h.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(h){this.client.logger.info(h)}return this.client.logger.info(`Verify context: ${JSON.stringify(o)}`),o},this.validateSessionProps=(r,s)=>{Object.values(r).forEach(o=>{if(!zt(o,!1)){const{message:h}=X("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(o)}`);throw new Error(h)}})}}async isInitialized(){if(!this.initialized){const{message:i}=X("NOT_INITIALIZED",this.name);throw new Error(i)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Wt.message,async i=>{const{topic:r,message:s}=i;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const o=await this.client.core.crypto.decode(r,s);try{Nc(o)?(this.client.core.history.set(r,o),this.onRelayEventRequest({topic:r,payload:o})):$c(o)?(await this.client.core.history.resolve(o),await this.onRelayEventResponse({topic:r,payload:o}),this.client.core.history.delete(r,o.id)):this.onRelayEventUnknownPayload({topic:r,payload:o})}catch(h){this.client.logger.error(h)}})}registerExpirerEvents(){this.client.core.expirer.on(Tr.expired,async i=>{const{topic:r,id:s}=bf(i.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,X("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(Zs.create,i=>this.onPairingCreated(i))}isValidPairingTopic(i){if(!zt(i,!1)){const{message:r}=X("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(i)){const{message:r}=X("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(r)}if(xi(this.client.core.pairing.pairings.get(i).expiry)){const{message:r}=X("EXPIRED",`pairing topic: ${i}`);throw new Error(r)}}async isValidSessionTopic(i){if(!zt(i,!1)){const{message:r}=X("MISSING_OR_INVALID",`session topic should be a string: ${i}`);throw new Error(r)}if(!this.client.session.keys.includes(i)){const{message:r}=X("NO_MATCHING_KEY",`session topic doesn't exist: ${i}`);throw new Error(r)}if(xi(this.client.session.get(i).expiry)){await this.deleteSession(i);const{message:r}=X("EXPIRED",`session topic: ${i}`);throw new Error(r)}}async isValidSessionOrPairingTopic(i){if(this.client.session.keys.includes(i))await this.isValidSessionTopic(i);else if(this.client.core.pairing.pairings.keys.includes(i))this.isValidPairingTopic(i);else if(zt(i,!1)){const{message:r}=X("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${i}`);throw new Error(r)}else{const{message:r}=X("MISSING_OR_INVALID",`session or pairing topic should be a string: ${i}`);throw new Error(r)}}async isValidProposalId(i){if(!sb(i)){const{message:r}=X("MISSING_OR_INVALID",`proposal id should be a number: ${i}`);throw new Error(r)}if(!this.client.proposal.keys.includes(i)){const{message:r}=X("NO_MATCHING_KEY",`proposal id doesn't exist: ${i}`);throw new Error(r)}if(xi(this.client.proposal.get(i).expiry)){await this.deleteProposal(i);const{message:r}=X("EXPIRED",`proposal id: ${i}`);throw new Error(r)}}}class QE extends To{constructor(i,r){super(i,r,UE,Kc),this.core=i,this.logger=r}}class YE extends To{constructor(i,r){super(i,r,ME,Kc),this.core=i,this.logger=r}}class ZE extends To{constructor(i,r){super(i,r,kE,Kc,s=>s.id),this.core=i,this.logger=r}}let XE=class Wf extends Bb{constructor(i){super(i),this.protocol=Kf,this.version=Vf,this.name=fc.name,this.events=new Wr.EventEmitter,this.on=(s,o)=>this.events.on(s,o),this.once=(s,o)=>this.events.once(s,o),this.off=(s,o)=>this.events.off(s,o),this.removeListener=(s,o)=>this.events.removeListener(s,o),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(o){throw this.logger.error(o.message),o}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(o){throw this.logger.error(o.message),o}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(o){throw this.logger.error(o.message),o}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(o){throw this.logger.error(o.message),o}},this.update=async s=>{try{return await this.engine.update(s)}catch(o){throw this.logger.error(o.message),o}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(o){throw this.logger.error(o.message),o}},this.request=async s=>{try{return await this.engine.request(s)}catch(o){throw this.logger.error(o.message),o}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(o){throw this.logger.error(o.message),o}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(o){throw this.logger.error(o.message),o}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(o){throw this.logger.error(o.message),o}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(o){throw this.logger.error(o.message),o}},this.find=s=>{try{return this.engine.find(s)}catch(o){throw this.logger.error(o.message),o}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=i?.name||fc.name,this.metadata=i?.metadata||_1();const r=typeof i?.logger<"u"&&typeof i?.logger!="string"?i.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:i?.logger||fc.logger}));this.core=i?.core||new jE(i),this.logger=Ce.generateChildLogger(r,this.name),this.session=new YE(this.core,this.logger),this.proposal=new QE(this.core,this.logger),this.pendingRequest=new ZE(this.core,this.logger),this.engine=new JE(this)}static async init(i){const r=new Wf(i);return await r.initialize(),r}get context(){return Ce.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(i){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(i.message),i}}};const Gl="error",eI="wss://relay.walletconnect.com",tI="wc",rI="universal_provider",Wl=`${tI}@2:${rI}:`,iI="https://rpc.walletconnect.com/v1/",li={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Qs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Sc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(a,i){(function(){var r,s="4.17.21",o=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",d="Expected a function",y="Invalid `variable` option passed into `_.template`",m="__lodash_hash_undefined__",S=500,C="__lodash_placeholder__",j=1,B=2,W=4,G=1,J=2,ce=1,ve=2,O=4,N=8,L=16,D=32,_=64,$=128,z=256,ae=512,oe=30,Ee="...",Ae=800,et=16,T=1,k=2,Ue=3,Te=1/0,ee=9007199254740991,Q=17976931348623157e292,V=0/0,Y=4294967295,ut=Y-1,ke=Y>>>1,Ur=[["ary",$],["bind",ce],["bindKey",ve],["curry",N],["curryRight",L],["flip",ae],["partial",D],["partialRight",_],["rearg",z]],we="[object Arguments]",xt="[object Array]",F="[object AsyncFunction]",R="[object Boolean]",P="[object Date]",u="[object DOMException]",w="[object Error]",ie="[object Function]",fe="[object GeneratorFunction]",me="[object Map]",Re="[object Number]",$e="[object Null]",xe="[object Object]",St="[object Promise]",mt="[object Proxy]",nt="[object RegExp]",De="[object Set]",Je="[object String]",Qe="[object Symbol]",ot="[object Undefined]",Me="[object WeakMap]",Ye="[object WeakSet]",Ne="[object ArrayBuffer]",He="[object DataView]",ht="[object Float32Array]",qe="[object Float64Array]",Pt="[object Int8Array]",Dt="[object Int16Array]",kt="[object Int32Array]",Ht="[object Uint8Array]",jt="[object Uint8ClampedArray]",Jt="[object Uint16Array]",nr="[object Uint32Array]",Mr=/\b__p \+= '';/g,Qt=/\b(__p \+=) '' \+/g,Jr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,fi=/&(?:amp|lt|gt|quot|#39);/g,Ci=/[&<>"']/g,lt=RegExp(fi.source),tt=RegExp(Ci.source),ft=/<%-([\s\S]+?)%>/g,pt=/<%([\s\S]+?)%>/g,at=/<%=([\s\S]+?)%>/g,rt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ot=/^\w*$/,Ct=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,dt=/[\\^$.*+?()[\]{}|]/g,At=RegExp(dt.source),gt=/^\s+/,bt=/\s/,yt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,We=/\{\n\/\* \[wrapped with (.+)\] \*/,Tt=/,? & /,Rt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ro=/[()=,{}\[\]\/\s]/,No=/\\(\\)?/g,$o=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,_r=/\w*$/,Fo=/^[-+]0x[0-9a-f]+$/i,Do=/^0b[01]+$/i,Lo=/^\[object .+?Constructor\]$/,qo=/^0o[0-7]+$/i,jo=/^(?:0|[1-9]\d*)$/,Qr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Qi=/($^)/,Uo=/['\n\r\u2028\u2029\\]/g,Yi="\\ud800-\\udfff",Mo="\\u0300-\\u036f",zo="\\ufe20-\\ufe2f",Zi="\\u20d0-\\u20ff",hn=Mo+zo+Zi,ln="\\u2700-\\u27bf",Rr="a-z\\xdf-\\xf6\\xf8-\\xff",ko="\\xac\\xb1\\xd7\\xf7",Ho="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ko="\\u2000-\\u206f",Vo=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",fn="A-Z\\xc0-\\xd6\\xd8-\\xde",pn="\\ufe0e\\ufe0f",Ai=ko+Ho+Ko+Vo,Es="[']",Ti="["+Yi+"]",Is="["+Ai+"]",Ri="["+hn+"]",dn="\\d+",Bo="["+ln+"]",gn="["+Rr+"]",yn="[^"+Yi+Ai+dn+ln+Rr+fn+"]",Xi="\\ud83c[\\udffb-\\udfff]",Go="(?:"+Ri+"|"+Xi+")",vn="[^"+Yi+"]",es="(?:\\ud83c[\\udde6-\\uddff]){2}",pi="[\\ud800-\\udbff][\\udc00-\\udfff]",dr="["+fn+"]",mn="\\u200d",bn="(?:"+gn+"|"+yn+")",zr="(?:"+dr+"|"+yn+")",wn="(?:"+Es+"(?:d|ll|m|re|s|t|ve))?",_n="(?:"+Es+"(?:D|LL|M|RE|S|T|VE))?",En=Go+"?",In="["+pn+"]?",Wo="(?:"+mn+"(?:"+[vn,es,pi].join("|")+")"+In+En+")*",Yr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",xn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Sn=In+En+Wo,ts="(?:"+[Bo,es,pi].join("|")+")"+Sn,Jo="(?:"+[vn+Ri+"?",Ri,es,pi,Ti].join("|")+")",xs=RegExp(Es,"g"),Qo=RegExp(Ri,"g"),rs=RegExp(Xi+"(?="+Xi+")|"+Jo+Sn,"g"),Pn=RegExp([dr+"?"+gn+"+"+wn+"(?="+[Is,dr,"$"].join("|")+")",zr+"+"+_n+"(?="+[Is,dr+bn,"$"].join("|")+")",dr+"?"+bn+"+"+wn,dr+"+"+_n,xn,Yr,dn,ts].join("|"),"g"),On=RegExp("["+mn+Yi+hn+pn+"]"),Ni=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Cn=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Yo=-1,Ke={};Ke[ht]=Ke[qe]=Ke[Pt]=Ke[Dt]=Ke[kt]=Ke[Ht]=Ke[jt]=Ke[Jt]=Ke[nr]=!0,Ke[we]=Ke[xt]=Ke[Ne]=Ke[R]=Ke[He]=Ke[P]=Ke[w]=Ke[ie]=Ke[me]=Ke[Re]=Ke[xe]=Ke[nt]=Ke[De]=Ke[Je]=Ke[Me]=!1;var ze={};ze[we]=ze[xt]=ze[Ne]=ze[He]=ze[R]=ze[P]=ze[ht]=ze[qe]=ze[Pt]=ze[Dt]=ze[kt]=ze[me]=ze[Re]=ze[xe]=ze[nt]=ze[De]=ze[Je]=ze[Qe]=ze[Ht]=ze[jt]=ze[Jt]=ze[nr]=!0,ze[w]=ze[ie]=ze[Me]=!1;var g={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},E={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},H={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},te={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ve=parseFloat,de=parseInt,Ze=typeof Qs=="object"&&Qs&&Qs.Object===Object&&Qs,Nt=typeof self=="object"&&self&&self.Object===Object&&self,Pe=Ze||Nt||Function("return this")(),Be=i&&!i.nodeType&&i,wt=Be&&!0&&a&&!a.nodeType&&a,or=wt&&wt.exports===Be,$t=or&&Ze.process,Xe=function(){try{var I=wt&&wt.require&&wt.require("util").types;return I||$t&&$t.binding&&$t.binding("util")}catch{}}(),Yt=Xe&&Xe.isArrayBuffer,Nr=Xe&&Xe.isDate,Er=Xe&&Xe.isMap,kr=Xe&&Xe.isRegExp,Ss=Xe&&Xe.isSet,$i=Xe&&Xe.isTypedArray;function Ut(I,q,A){switch(A.length){case 0:return I.call(q);case 1:return I.call(q,A[0]);case 2:return I.call(q,A[0],A[1]);case 3:return I.call(q,A[0],A[1],A[2])}return I.apply(q,A)}function Yf(I,q,A,re){for(var pe=-1,Fe=I==null?0:I.length;++pe<Fe;){var Lt=I[pe];q(re,Lt,A(Lt),I)}return re}function Ir(I,q){for(var A=-1,re=I==null?0:I.length;++A<re&&q(I[A],A,I)!==!1;);return I}function Zf(I,q){for(var A=I==null?0:I.length;A--&&q(I[A],A,I)!==!1;);return I}function Gc(I,q){for(var A=-1,re=I==null?0:I.length;++A<re;)if(!q(I[A],A,I))return!1;return!0}function di(I,q){for(var A=-1,re=I==null?0:I.length,pe=0,Fe=[];++A<re;){var Lt=I[A];q(Lt,A,I)&&(Fe[pe++]=Lt)}return Fe}function An(I,q){var A=I==null?0:I.length;return!!A&&is(I,q,0)>-1}function Zo(I,q,A){for(var re=-1,pe=I==null?0:I.length;++re<pe;)if(A(q,I[re]))return!0;return!1}function it(I,q){for(var A=-1,re=I==null?0:I.length,pe=Array(re);++A<re;)pe[A]=q(I[A],A,I);return pe}function gi(I,q){for(var A=-1,re=q.length,pe=I.length;++A<re;)I[pe+A]=q[A];return I}function Xo(I,q,A,re){var pe=-1,Fe=I==null?0:I.length;for(re&&Fe&&(A=I[++pe]);++pe<Fe;)A=q(A,I[pe],pe,I);return A}function Xf(I,q,A,re){var pe=I==null?0:I.length;for(re&&pe&&(A=I[--pe]);pe--;)A=q(A,I[pe],pe,I);return A}function ea(I,q){for(var A=-1,re=I==null?0:I.length;++A<re;)if(q(I[A],A,I))return!0;return!1}var ep=ta("length");function tp(I){return I.split("")}function rp(I){return I.match(Rt)||[]}function Wc(I,q,A){var re;return A(I,function(pe,Fe,Lt){if(q(pe,Fe,Lt))return re=Fe,!1}),re}function Tn(I,q,A,re){for(var pe=I.length,Fe=A+(re?1:-1);re?Fe--:++Fe<pe;)if(q(I[Fe],Fe,I))return Fe;return-1}function is(I,q,A){return q===q?dp(I,q,A):Tn(I,Jc,A)}function ip(I,q,A,re){for(var pe=A-1,Fe=I.length;++pe<Fe;)if(re(I[pe],q))return pe;return-1}function Jc(I){return I!==I}function Qc(I,q){var A=I==null?0:I.length;return A?ia(I,q)/A:V}function ta(I){return function(q){return q==null?r:q[I]}}function ra(I){return function(q){return I==null?r:I[q]}}function Yc(I,q,A,re,pe){return pe(I,function(Fe,Lt,Ge){A=re?(re=!1,Fe):q(A,Fe,Lt,Ge)}),A}function sp(I,q){var A=I.length;for(I.sort(q);A--;)I[A]=I[A].value;return I}function ia(I,q){for(var A,re=-1,pe=I.length;++re<pe;){var Fe=q(I[re]);Fe!==r&&(A=A===r?Fe:A+Fe)}return A}function sa(I,q){for(var A=-1,re=Array(I);++A<I;)re[A]=q(A);return re}function np(I,q){return it(q,function(A){return[A,I[A]]})}function Zc(I){return I&&I.slice(0,ru(I)+1).replace(gt,"")}function gr(I){return function(q){return I(q)}}function na(I,q){return it(q,function(A){return I[A]})}function Ps(I,q){return I.has(q)}function Xc(I,q){for(var A=-1,re=I.length;++A<re&&is(q,I[A],0)>-1;);return A}function eu(I,q){for(var A=I.length;A--&&is(q,I[A],0)>-1;);return A}function op(I,q){for(var A=I.length,re=0;A--;)I[A]===q&&++re;return re}var ap=ra(g),cp=ra(E);function up(I){return"\\"+te[I]}function hp(I,q){return I==null?r:I[q]}function ss(I){return On.test(I)}function lp(I){return Ni.test(I)}function fp(I){for(var q,A=[];!(q=I.next()).done;)A.push(q.value);return A}function oa(I){var q=-1,A=Array(I.size);return I.forEach(function(re,pe){A[++q]=[pe,re]}),A}function tu(I,q){return function(A){return I(q(A))}}function yi(I,q){for(var A=-1,re=I.length,pe=0,Fe=[];++A<re;){var Lt=I[A];(Lt===q||Lt===C)&&(I[A]=C,Fe[pe++]=A)}return Fe}function Rn(I){var q=-1,A=Array(I.size);return I.forEach(function(re){A[++q]=re}),A}function pp(I){var q=-1,A=Array(I.size);return I.forEach(function(re){A[++q]=[re,re]}),A}function dp(I,q,A){for(var re=A-1,pe=I.length;++re<pe;)if(I[re]===q)return re;return-1}function gp(I,q,A){for(var re=A+1;re--;)if(I[re]===q)return re;return re}function ns(I){return ss(I)?vp(I):ep(I)}function $r(I){return ss(I)?mp(I):tp(I)}function ru(I){for(var q=I.length;q--&&bt.test(I.charAt(q)););return q}var yp=ra(H);function vp(I){for(var q=rs.lastIndex=0;rs.test(I);)++q;return q}function mp(I){return I.match(rs)||[]}function bp(I){return I.match(Pn)||[]}var wp=function I(q){q=q==null?Pe:os.defaults(Pe.Object(),q,os.pick(Pe,Cn));var A=q.Array,re=q.Date,pe=q.Error,Fe=q.Function,Lt=q.Math,Ge=q.Object,aa=q.RegExp,_p=q.String,xr=q.TypeError,Nn=A.prototype,Ep=Fe.prototype,as=Ge.prototype,$n=q["__core-js_shared__"],Fn=Ep.toString,je=as.hasOwnProperty,Ip=0,iu=function(){var e=/[^.]+$/.exec($n&&$n.keys&&$n.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Dn=as.toString,xp=Fn.call(Ge),Sp=Pe._,Pp=aa("^"+Fn.call(je).replace(dt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ln=or?q.Buffer:r,vi=q.Symbol,qn=q.Uint8Array,su=Ln?Ln.allocUnsafe:r,jn=tu(Ge.getPrototypeOf,Ge),nu=Ge.create,ou=as.propertyIsEnumerable,Un=Nn.splice,au=vi?vi.isConcatSpreadable:r,Os=vi?vi.iterator:r,Fi=vi?vi.toStringTag:r,Mn=function(){try{var e=Ui(Ge,"defineProperty");return e({},"",{}),e}catch{}}(),Op=q.clearTimeout!==Pe.clearTimeout&&q.clearTimeout,Cp=re&&re.now!==Pe.Date.now&&re.now,Ap=q.setTimeout!==Pe.setTimeout&&q.setTimeout,zn=Lt.ceil,kn=Lt.floor,ca=Ge.getOwnPropertySymbols,Tp=Ln?Ln.isBuffer:r,cu=q.isFinite,Rp=Nn.join,Np=tu(Ge.keys,Ge),qt=Lt.max,Bt=Lt.min,$p=re.now,Fp=q.parseInt,uu=Lt.random,Dp=Nn.reverse,ua=Ui(q,"DataView"),Cs=Ui(q,"Map"),ha=Ui(q,"Promise"),cs=Ui(q,"Set"),As=Ui(q,"WeakMap"),Ts=Ui(Ge,"create"),Hn=As&&new As,us={},Lp=Mi(ua),qp=Mi(Cs),jp=Mi(ha),Up=Mi(cs),Mp=Mi(As),Kn=vi?vi.prototype:r,Rs=Kn?Kn.valueOf:r,hu=Kn?Kn.toString:r;function f(e){if(vt(e)&&!ge(e)&&!(e instanceof Se)){if(e instanceof Sr)return e;if(je.call(e,"__wrapped__"))return lh(e)}return new Sr(e)}var hs=function(){function e(){}return function(t){if(!ct(t))return{};if(nu)return nu(t);e.prototype=t;var n=new e;return e.prototype=r,n}}();function Vn(){}function Sr(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=r}f.templateSettings={escape:ft,evaluate:pt,interpolate:at,variable:"",imports:{_:f}},f.prototype=Vn.prototype,f.prototype.constructor=f,Sr.prototype=hs(Vn.prototype),Sr.prototype.constructor=Sr;function Se(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Y,this.__views__=[]}function zp(){var e=new Se(this.__wrapped__);return e.__actions__=ar(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ar(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ar(this.__views__),e}function kp(){if(this.__filtered__){var e=new Se(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Hp(){var e=this.__wrapped__.value(),t=this.__dir__,n=ge(e),c=t<0,l=n?e.length:0,p=tg(0,l,this.__views__),v=p.start,b=p.end,x=b-v,U=c?b:v-1,M=this.__iteratees__,K=M.length,Z=0,se=Bt(x,this.__takeCount__);if(!n||!c&&l==x&&se==x)return Fu(e,this.__actions__);var he=[];e:for(;x--&&Z<se;){U+=t;for(var be=-1,le=e[U];++be<K;){var Ie=M[be],Oe=Ie.iteratee,mr=Ie.type,er=Oe(le);if(mr==k)le=er;else if(!er){if(mr==T)continue e;break e}}he[Z++]=le}return he}Se.prototype=hs(Vn.prototype),Se.prototype.constructor=Se;function Di(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var c=e[t];this.set(c[0],c[1])}}function Kp(){this.__data__=Ts?Ts(null):{},this.size=0}function Vp(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Bp(e){var t=this.__data__;if(Ts){var n=t[e];return n===m?r:n}return je.call(t,e)?t[e]:r}function Gp(e){var t=this.__data__;return Ts?t[e]!==r:je.call(t,e)}function Wp(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Ts&&t===r?m:t,this}Di.prototype.clear=Kp,Di.prototype.delete=Vp,Di.prototype.get=Bp,Di.prototype.has=Gp,Di.prototype.set=Wp;function Zr(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var c=e[t];this.set(c[0],c[1])}}function Jp(){this.__data__=[],this.size=0}function Qp(e){var t=this.__data__,n=Bn(t,e);if(n<0)return!1;var c=t.length-1;return n==c?t.pop():Un.call(t,n,1),--this.size,!0}function Yp(e){var t=this.__data__,n=Bn(t,e);return n<0?r:t[n][1]}function Zp(e){return Bn(this.__data__,e)>-1}function Xp(e,t){var n=this.__data__,c=Bn(n,e);return c<0?(++this.size,n.push([e,t])):n[c][1]=t,this}Zr.prototype.clear=Jp,Zr.prototype.delete=Qp,Zr.prototype.get=Yp,Zr.prototype.has=Zp,Zr.prototype.set=Xp;function Xr(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var c=e[t];this.set(c[0],c[1])}}function ed(){this.size=0,this.__data__={hash:new Di,map:new(Cs||Zr),string:new Di}}function td(e){var t=so(this,e).delete(e);return this.size-=t?1:0,t}function rd(e){return so(this,e).get(e)}function id(e){return so(this,e).has(e)}function sd(e,t){var n=so(this,e),c=n.size;return n.set(e,t),this.size+=n.size==c?0:1,this}Xr.prototype.clear=ed,Xr.prototype.delete=td,Xr.prototype.get=rd,Xr.prototype.has=id,Xr.prototype.set=sd;function Li(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new Xr;++t<n;)this.add(e[t])}function nd(e){return this.__data__.set(e,m),this}function od(e){return this.__data__.has(e)}Li.prototype.add=Li.prototype.push=nd,Li.prototype.has=od;function Fr(e){var t=this.__data__=new Zr(e);this.size=t.size}function ad(){this.__data__=new Zr,this.size=0}function cd(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function ud(e){return this.__data__.get(e)}function hd(e){return this.__data__.has(e)}function ld(e,t){var n=this.__data__;if(n instanceof Zr){var c=n.__data__;if(!Cs||c.length<o-1)return c.push([e,t]),this.size=++n.size,this;n=this.__data__=new Xr(c)}return n.set(e,t),this.size=n.size,this}Fr.prototype.clear=ad,Fr.prototype.delete=cd,Fr.prototype.get=ud,Fr.prototype.has=hd,Fr.prototype.set=ld;function lu(e,t){var n=ge(e),c=!n&&zi(e),l=!n&&!c&&Ei(e),p=!n&&!c&&!l&&ds(e),v=n||c||l||p,b=v?sa(e.length,_p):[],x=b.length;for(var U in e)(t||je.call(e,U))&&!(v&&(U=="length"||l&&(U=="offset"||U=="parent")||p&&(U=="buffer"||U=="byteLength"||U=="byteOffset")||ii(U,x)))&&b.push(U);return b}function fu(e){var t=e.length;return t?e[_a(0,t-1)]:r}function fd(e,t){return no(ar(e),qi(t,0,e.length))}function pd(e){return no(ar(e))}function la(e,t,n){(n!==r&&!Dr(e[t],n)||n===r&&!(t in e))&&ei(e,t,n)}function Ns(e,t,n){var c=e[t];(!(je.call(e,t)&&Dr(c,n))||n===r&&!(t in e))&&ei(e,t,n)}function Bn(e,t){for(var n=e.length;n--;)if(Dr(e[n][0],t))return n;return-1}function dd(e,t,n,c){return mi(e,function(l,p,v){t(c,l,n(l),v)}),c}function pu(e,t){return e&&Kr(t,Mt(t),e)}function gd(e,t){return e&&Kr(t,ur(t),e)}function ei(e,t,n){t=="__proto__"&&Mn?Mn(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function fa(e,t){for(var n=-1,c=t.length,l=A(c),p=e==null;++n<c;)l[n]=p?r:Ba(e,t[n]);return l}function qi(e,t,n){return e===e&&(n!==r&&(e=e<=n?e:n),t!==r&&(e=e>=t?e:t)),e}function Pr(e,t,n,c,l,p){var v,b=t&j,x=t&B,U=t&W;if(n&&(v=l?n(e,c,l,p):n(e)),v!==r)return v;if(!ct(e))return e;var M=ge(e);if(M){if(v=ig(e),!b)return ar(e,v)}else{var K=Gt(e),Z=K==ie||K==fe;if(Ei(e))return qu(e,b);if(K==xe||K==we||Z&&!l){if(v=x||Z?{}:rh(e),!b)return x?Bd(e,gd(v,e)):Vd(e,pu(v,e))}else{if(!ze[K])return l?e:{};v=sg(e,K,b)}}p||(p=new Fr);var se=p.get(e);if(se)return se;p.set(e,v),Rh(e)?e.forEach(function(le){v.add(Pr(le,t,n,le,e,p))}):Ah(e)&&e.forEach(function(le,Ie){v.set(Ie,Pr(le,t,n,Ie,e,p))});var he=U?x?Na:Ra:x?ur:Mt,be=M?r:he(e);return Ir(be||e,function(le,Ie){be&&(Ie=le,le=e[Ie]),Ns(v,Ie,Pr(le,t,n,Ie,e,p))}),v}function yd(e){var t=Mt(e);return function(n){return du(n,e,t)}}function du(e,t,n){var c=n.length;if(e==null)return!c;for(e=Ge(e);c--;){var l=n[c],p=t[l],v=e[l];if(v===r&&!(l in e)||!p(v))return!1}return!0}function gu(e,t,n){if(typeof e!="function")throw new xr(d);return Us(function(){e.apply(r,n)},t)}function $s(e,t,n,c){var l=-1,p=An,v=!0,b=e.length,x=[],U=t.length;if(!b)return x;n&&(t=it(t,gr(n))),c?(p=Zo,v=!1):t.length>=o&&(p=Ps,v=!1,t=new Li(t));e:for(;++l<b;){var M=e[l],K=n==null?M:n(M);if(M=c||M!==0?M:0,v&&K===K){for(var Z=U;Z--;)if(t[Z]===K)continue e;x.push(M)}else p(t,K,c)||x.push(M)}return x}var mi=ku(Hr),yu=ku(da,!0);function vd(e,t){var n=!0;return mi(e,function(c,l,p){return n=!!t(c,l,p),n}),n}function Gn(e,t,n){for(var c=-1,l=e.length;++c<l;){var p=e[c],v=t(p);if(v!=null&&(b===r?v===v&&!vr(v):n(v,b)))var b=v,x=p}return x}function md(e,t,n,c){var l=e.length;for(n=ye(n),n<0&&(n=-n>l?0:l+n),c=c===r||c>l?l:ye(c),c<0&&(c+=l),c=n>c?0:$h(c);n<c;)e[n++]=t;return e}function vu(e,t){var n=[];return mi(e,function(c,l,p){t(c,l,p)&&n.push(c)}),n}function Kt(e,t,n,c,l){var p=-1,v=e.length;for(n||(n=og),l||(l=[]);++p<v;){var b=e[p];t>0&&n(b)?t>1?Kt(b,t-1,n,c,l):gi(l,b):c||(l[l.length]=b)}return l}var pa=Hu(),mu=Hu(!0);function Hr(e,t){return e&&pa(e,t,Mt)}function da(e,t){return e&&mu(e,t,Mt)}function Wn(e,t){return di(t,function(n){return si(e[n])})}function ji(e,t){t=wi(t,e);for(var n=0,c=t.length;e!=null&&n<c;)e=e[Vr(t[n++])];return n&&n==c?e:r}function bu(e,t,n){var c=t(e);return ge(e)?c:gi(c,n(e))}function Zt(e){return e==null?e===r?ot:$e:Fi&&Fi in Ge(e)?eg(e):pg(e)}function ga(e,t){return e>t}function bd(e,t){return e!=null&&je.call(e,t)}function wd(e,t){return e!=null&&t in Ge(e)}function _d(e,t,n){return e>=Bt(t,n)&&e<qt(t,n)}function ya(e,t,n){for(var c=n?Zo:An,l=e[0].length,p=e.length,v=p,b=A(p),x=1/0,U=[];v--;){var M=e[v];v&&t&&(M=it(M,gr(t))),x=Bt(M.length,x),b[v]=!n&&(t||l>=120&&M.length>=120)?new Li(v&&M):r}M=e[0];var K=-1,Z=b[0];e:for(;++K<l&&U.length<x;){var se=M[K],he=t?t(se):se;if(se=n||se!==0?se:0,!(Z?Ps(Z,he):c(U,he,n))){for(v=p;--v;){var be=b[v];if(!(be?Ps(be,he):c(e[v],he,n)))continue e}Z&&Z.push(he),U.push(se)}}return U}function Ed(e,t,n,c){return Hr(e,function(l,p,v){t(c,n(l),p,v)}),c}function Fs(e,t,n){t=wi(t,e),e=oh(e,t);var c=e==null?e:e[Vr(Cr(t))];return c==null?r:Ut(c,e,n)}function wu(e){return vt(e)&&Zt(e)==we}function Id(e){return vt(e)&&Zt(e)==Ne}function xd(e){return vt(e)&&Zt(e)==P}function Ds(e,t,n,c,l){return e===t?!0:e==null||t==null||!vt(e)&&!vt(t)?e!==e&&t!==t:Sd(e,t,n,c,Ds,l)}function Sd(e,t,n,c,l,p){var v=ge(e),b=ge(t),x=v?xt:Gt(e),U=b?xt:Gt(t);x=x==we?xe:x,U=U==we?xe:U;var M=x==xe,K=U==xe,Z=x==U;if(Z&&Ei(e)){if(!Ei(t))return!1;v=!0,M=!1}if(Z&&!M)return p||(p=new Fr),v||ds(e)?Xu(e,t,n,c,l,p):Zd(e,t,x,n,c,l,p);if(!(n&G)){var se=M&&je.call(e,"__wrapped__"),he=K&&je.call(t,"__wrapped__");if(se||he){var be=se?e.value():e,le=he?t.value():t;return p||(p=new Fr),l(be,le,n,c,p)}}return Z?(p||(p=new Fr),Xd(e,t,n,c,l,p)):!1}function Pd(e){return vt(e)&&Gt(e)==me}function va(e,t,n,c){var l=n.length,p=l,v=!c;if(e==null)return!p;for(e=Ge(e);l--;){var b=n[l];if(v&&b[2]?b[1]!==e[b[0]]:!(b[0]in e))return!1}for(;++l<p;){b=n[l];var x=b[0],U=e[x],M=b[1];if(v&&b[2]){if(U===r&&!(x in e))return!1}else{var K=new Fr;if(c)var Z=c(U,M,x,e,t,K);if(!(Z===r?Ds(M,U,G|J,c,K):Z))return!1}}return!0}function _u(e){if(!ct(e)||cg(e))return!1;var t=si(e)?Pp:Lo;return t.test(Mi(e))}function Od(e){return vt(e)&&Zt(e)==nt}function Cd(e){return vt(e)&&Gt(e)==De}function Ad(e){return vt(e)&&lo(e.length)&&!!Ke[Zt(e)]}function Eu(e){return typeof e=="function"?e:e==null?hr:typeof e=="object"?ge(e)?Su(e[0],e[1]):xu(e):Kh(e)}function ma(e){if(!js(e))return Np(e);var t=[];for(var n in Ge(e))je.call(e,n)&&n!="constructor"&&t.push(n);return t}function Td(e){if(!ct(e))return fg(e);var t=js(e),n=[];for(var c in e)c=="constructor"&&(t||!je.call(e,c))||n.push(c);return n}function ba(e,t){return e<t}function Iu(e,t){var n=-1,c=cr(e)?A(e.length):[];return mi(e,function(l,p,v){c[++n]=t(l,p,v)}),c}function xu(e){var t=Fa(e);return t.length==1&&t[0][2]?sh(t[0][0],t[0][1]):function(n){return n===e||va(n,e,t)}}function Su(e,t){return La(e)&&ih(t)?sh(Vr(e),t):function(n){var c=Ba(n,e);return c===r&&c===t?Ga(n,e):Ds(t,c,G|J)}}function Jn(e,t,n,c,l){e!==t&&pa(t,function(p,v){if(l||(l=new Fr),ct(p))Rd(e,t,v,n,Jn,c,l);else{var b=c?c(ja(e,v),p,v+"",e,t,l):r;b===r&&(b=p),la(e,v,b)}},ur)}function Rd(e,t,n,c,l,p,v){var b=ja(e,n),x=ja(t,n),U=v.get(x);if(U){la(e,n,U);return}var M=p?p(b,x,n+"",e,t,v):r,K=M===r;if(K){var Z=ge(x),se=!Z&&Ei(x),he=!Z&&!se&&ds(x);M=x,Z||se||he?ge(b)?M=b:_t(b)?M=ar(b):se?(K=!1,M=qu(x,!0)):he?(K=!1,M=ju(x,!0)):M=[]:Ms(x)||zi(x)?(M=b,zi(b)?M=Fh(b):(!ct(b)||si(b))&&(M=rh(x))):K=!1}K&&(v.set(x,M),l(M,x,c,p,v),v.delete(x)),la(e,n,M)}function Pu(e,t){var n=e.length;if(n)return t+=t<0?n:0,ii(t,n)?e[t]:r}function Ou(e,t,n){t.length?t=it(t,function(p){return ge(p)?function(v){return ji(v,p.length===1?p[0]:p)}:p}):t=[hr];var c=-1;t=it(t,gr(ue()));var l=Iu(e,function(p,v,b){var x=it(t,function(U){return U(p)});return{criteria:x,index:++c,value:p}});return sp(l,function(p,v){return Kd(p,v,n)})}function Nd(e,t){return Cu(e,t,function(n,c){return Ga(e,c)})}function Cu(e,t,n){for(var c=-1,l=t.length,p={};++c<l;){var v=t[c],b=ji(e,v);n(b,v)&&Ls(p,wi(v,e),b)}return p}function $d(e){return function(t){return ji(t,e)}}function wa(e,t,n,c){var l=c?ip:is,p=-1,v=t.length,b=e;for(e===t&&(t=ar(t)),n&&(b=it(e,gr(n)));++p<v;)for(var x=0,U=t[p],M=n?n(U):U;(x=l(b,M,x,c))>-1;)b!==e&&Un.call(b,x,1),Un.call(e,x,1);return e}function Au(e,t){for(var n=e?t.length:0,c=n-1;n--;){var l=t[n];if(n==c||l!==p){var p=l;ii(l)?Un.call(e,l,1):xa(e,l)}}return e}function _a(e,t){return e+kn(uu()*(t-e+1))}function Fd(e,t,n,c){for(var l=-1,p=qt(zn((t-e)/(n||1)),0),v=A(p);p--;)v[c?p:++l]=e,e+=n;return v}function Ea(e,t){var n="";if(!e||t<1||t>ee)return n;do t%2&&(n+=e),t=kn(t/2),t&&(e+=e);while(t);return n}function _e(e,t){return Ua(nh(e,t,hr),e+"")}function Dd(e){return fu(gs(e))}function Ld(e,t){var n=gs(e);return no(n,qi(t,0,n.length))}function Ls(e,t,n,c){if(!ct(e))return e;t=wi(t,e);for(var l=-1,p=t.length,v=p-1,b=e;b!=null&&++l<p;){var x=Vr(t[l]),U=n;if(x==="__proto__"||x==="constructor"||x==="prototype")return e;if(l!=v){var M=b[x];U=c?c(M,x,b):r,U===r&&(U=ct(M)?M:ii(t[l+1])?[]:{})}Ns(b,x,U),b=b[x]}return e}var Tu=Hn?function(e,t){return Hn.set(e,t),e}:hr,qd=Mn?function(e,t){return Mn(e,"toString",{configurable:!0,enumerable:!1,value:Ja(t),writable:!0})}:hr;function jd(e){return no(gs(e))}function Or(e,t,n){var c=-1,l=e.length;t<0&&(t=-t>l?0:l+t),n=n>l?l:n,n<0&&(n+=l),l=t>n?0:n-t>>>0,t>>>=0;for(var p=A(l);++c<l;)p[c]=e[c+t];return p}function Ud(e,t){var n;return mi(e,function(c,l,p){return n=t(c,l,p),!n}),!!n}function Qn(e,t,n){var c=0,l=e==null?c:e.length;if(typeof t=="number"&&t===t&&l<=ke){for(;c<l;){var p=c+l>>>1,v=e[p];v!==null&&!vr(v)&&(n?v<=t:v<t)?c=p+1:l=p}return l}return Ia(e,t,hr,n)}function Ia(e,t,n,c){var l=0,p=e==null?0:e.length;if(p===0)return 0;t=n(t);for(var v=t!==t,b=t===null,x=vr(t),U=t===r;l<p;){var M=kn((l+p)/2),K=n(e[M]),Z=K!==r,se=K===null,he=K===K,be=vr(K);if(v)var le=c||he;else U?le=he&&(c||Z):b?le=he&&Z&&(c||!se):x?le=he&&Z&&!se&&(c||!be):se||be?le=!1:le=c?K<=t:K<t;le?l=M+1:p=M}return Bt(p,ut)}function Ru(e,t){for(var n=-1,c=e.length,l=0,p=[];++n<c;){var v=e[n],b=t?t(v):v;if(!n||!Dr(b,x)){var x=b;p[l++]=v===0?0:v}}return p}function Nu(e){return typeof e=="number"?e:vr(e)?V:+e}function yr(e){if(typeof e=="string")return e;if(ge(e))return it(e,yr)+"";if(vr(e))return hu?hu.call(e):"";var t=e+"";return t=="0"&&1/e==-Te?"-0":t}function bi(e,t,n){var c=-1,l=An,p=e.length,v=!0,b=[],x=b;if(n)v=!1,l=Zo;else if(p>=o){var U=t?null:Qd(e);if(U)return Rn(U);v=!1,l=Ps,x=new Li}else x=t?[]:b;e:for(;++c<p;){var M=e[c],K=t?t(M):M;if(M=n||M!==0?M:0,v&&K===K){for(var Z=x.length;Z--;)if(x[Z]===K)continue e;t&&x.push(K),b.push(M)}else l(x,K,n)||(x!==b&&x.push(K),b.push(M))}return b}function xa(e,t){return t=wi(t,e),e=oh(e,t),e==null||delete e[Vr(Cr(t))]}function $u(e,t,n,c){return Ls(e,t,n(ji(e,t)),c)}function Yn(e,t,n,c){for(var l=e.length,p=c?l:-1;(c?p--:++p<l)&&t(e[p],p,e););return n?Or(e,c?0:p,c?p+1:l):Or(e,c?p+1:0,c?l:p)}function Fu(e,t){var n=e;return n instanceof Se&&(n=n.value()),Xo(t,function(c,l){return l.func.apply(l.thisArg,gi([c],l.args))},n)}function Sa(e,t,n){var c=e.length;if(c<2)return c?bi(e[0]):[];for(var l=-1,p=A(c);++l<c;)for(var v=e[l],b=-1;++b<c;)b!=l&&(p[l]=$s(p[l]||v,e[b],t,n));return bi(Kt(p,1),t,n)}function Du(e,t,n){for(var c=-1,l=e.length,p=t.length,v={};++c<l;){var b=c<p?t[c]:r;n(v,e[c],b)}return v}function Pa(e){return _t(e)?e:[]}function Oa(e){return typeof e=="function"?e:hr}function wi(e,t){return ge(e)?e:La(e,t)?[e]:hh(Le(e))}var Md=_e;function _i(e,t,n){var c=e.length;return n=n===r?c:n,!t&&n>=c?e:Or(e,t,n)}var Lu=Op||function(e){return Pe.clearTimeout(e)};function qu(e,t){if(t)return e.slice();var n=e.length,c=su?su(n):new e.constructor(n);return e.copy(c),c}function Ca(e){var t=new e.constructor(e.byteLength);return new qn(t).set(new qn(e)),t}function zd(e,t){var n=t?Ca(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function kd(e){var t=new e.constructor(e.source,_r.exec(e));return t.lastIndex=e.lastIndex,t}function Hd(e){return Rs?Ge(Rs.call(e)):{}}function ju(e,t){var n=t?Ca(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Uu(e,t){if(e!==t){var n=e!==r,c=e===null,l=e===e,p=vr(e),v=t!==r,b=t===null,x=t===t,U=vr(t);if(!b&&!U&&!p&&e>t||p&&v&&x&&!b&&!U||c&&v&&x||!n&&x||!l)return 1;if(!c&&!p&&!U&&e<t||U&&n&&l&&!c&&!p||b&&n&&l||!v&&l||!x)return-1}return 0}function Kd(e,t,n){for(var c=-1,l=e.criteria,p=t.criteria,v=l.length,b=n.length;++c<v;){var x=Uu(l[c],p[c]);if(x){if(c>=b)return x;var U=n[c];return x*(U=="desc"?-1:1)}}return e.index-t.index}function Mu(e,t,n,c){for(var l=-1,p=e.length,v=n.length,b=-1,x=t.length,U=qt(p-v,0),M=A(x+U),K=!c;++b<x;)M[b]=t[b];for(;++l<v;)(K||l<p)&&(M[n[l]]=e[l]);for(;U--;)M[b++]=e[l++];return M}function zu(e,t,n,c){for(var l=-1,p=e.length,v=-1,b=n.length,x=-1,U=t.length,M=qt(p-b,0),K=A(M+U),Z=!c;++l<M;)K[l]=e[l];for(var se=l;++x<U;)K[se+x]=t[x];for(;++v<b;)(Z||l<p)&&(K[se+n[v]]=e[l++]);return K}function ar(e,t){var n=-1,c=e.length;for(t||(t=A(c));++n<c;)t[n]=e[n];return t}function Kr(e,t,n,c){var l=!n;n||(n={});for(var p=-1,v=t.length;++p<v;){var b=t[p],x=c?c(n[b],e[b],b,n,e):r;x===r&&(x=e[b]),l?ei(n,b,x):Ns(n,b,x)}return n}function Vd(e,t){return Kr(e,Da(e),t)}function Bd(e,t){return Kr(e,eh(e),t)}function Zn(e,t){return function(n,c){var l=ge(n)?Yf:dd,p=t?t():{};return l(n,e,ue(c,2),p)}}function ls(e){return _e(function(t,n){var c=-1,l=n.length,p=l>1?n[l-1]:r,v=l>2?n[2]:r;for(p=e.length>3&&typeof p=="function"?(l--,p):r,v&&Xt(n[0],n[1],v)&&(p=l<3?r:p,l=1),t=Ge(t);++c<l;){var b=n[c];b&&e(t,b,c,p)}return t})}function ku(e,t){return function(n,c){if(n==null)return n;if(!cr(n))return e(n,c);for(var l=n.length,p=t?l:-1,v=Ge(n);(t?p--:++p<l)&&c(v[p],p,v)!==!1;);return n}}function Hu(e){return function(t,n,c){for(var l=-1,p=Ge(t),v=c(t),b=v.length;b--;){var x=v[e?b:++l];if(n(p[x],x,p)===!1)break}return t}}function Gd(e,t,n){var c=t&ce,l=qs(e);function p(){var v=this&&this!==Pe&&this instanceof p?l:e;return v.apply(c?n:this,arguments)}return p}function Ku(e){return function(t){t=Le(t);var n=ss(t)?$r(t):r,c=n?n[0]:t.charAt(0),l=n?_i(n,1).join(""):t.slice(1);return c[e]()+l}}function fs(e){return function(t){return Xo(kh(zh(t).replace(xs,"")),e,"")}}function qs(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=hs(e.prototype),c=e.apply(n,t);return ct(c)?c:n}}function Wd(e,t,n){var c=qs(e);function l(){for(var p=arguments.length,v=A(p),b=p,x=ps(l);b--;)v[b]=arguments[b];var U=p<3&&v[0]!==x&&v[p-1]!==x?[]:yi(v,x);if(p-=U.length,p<n)return Ju(e,t,Xn,l.placeholder,r,v,U,r,r,n-p);var M=this&&this!==Pe&&this instanceof l?c:e;return Ut(M,this,v)}return l}function Vu(e){return function(t,n,c){var l=Ge(t);if(!cr(t)){var p=ue(n,3);t=Mt(t),n=function(b){return p(l[b],b,l)}}var v=e(t,n,c);return v>-1?l[p?t[v]:v]:r}}function Bu(e){return ri(function(t){var n=t.length,c=n,l=Sr.prototype.thru;for(e&&t.reverse();c--;){var p=t[c];if(typeof p!="function")throw new xr(d);if(l&&!v&&io(p)=="wrapper")var v=new Sr([],!0)}for(c=v?c:n;++c<n;){p=t[c];var b=io(p),x=b=="wrapper"?$a(p):r;x&&qa(x[0])&&x[1]==($|N|D|z)&&!x[4].length&&x[9]==1?v=v[io(x[0])].apply(v,x[3]):v=p.length==1&&qa(p)?v[b]():v.thru(p)}return function(){var U=arguments,M=U[0];if(v&&U.length==1&&ge(M))return v.plant(M).value();for(var K=0,Z=n?t[K].apply(this,U):M;++K<n;)Z=t[K].call(this,Z);return Z}})}function Xn(e,t,n,c,l,p,v,b,x,U){var M=t&$,K=t&ce,Z=t&ve,se=t&(N|L),he=t&ae,be=Z?r:qs(e);function le(){for(var Ie=arguments.length,Oe=A(Ie),mr=Ie;mr--;)Oe[mr]=arguments[mr];if(se)var er=ps(le),br=op(Oe,er);if(c&&(Oe=Mu(Oe,c,l,se)),p&&(Oe=zu(Oe,p,v,se)),Ie-=br,se&&Ie<U){var Et=yi(Oe,er);return Ju(e,t,Xn,le.placeholder,n,Oe,Et,b,x,U-Ie)}var Lr=K?n:this,oi=Z?Lr[e]:e;return Ie=Oe.length,b?Oe=dg(Oe,b):he&&Ie>1&&Oe.reverse(),M&&x<Ie&&(Oe.length=x),this&&this!==Pe&&this instanceof le&&(oi=be||qs(oi)),oi.apply(Lr,Oe)}return le}function Gu(e,t){return function(n,c){return Ed(n,e,t(c),{})}}function eo(e,t){return function(n,c){var l;if(n===r&&c===r)return t;if(n!==r&&(l=n),c!==r){if(l===r)return c;typeof n=="string"||typeof c=="string"?(n=yr(n),c=yr(c)):(n=Nu(n),c=Nu(c)),l=e(n,c)}return l}}function Aa(e){return ri(function(t){return t=it(t,gr(ue())),_e(function(n){var c=this;return e(t,function(l){return Ut(l,c,n)})})})}function to(e,t){t=t===r?" ":yr(t);var n=t.length;if(n<2)return n?Ea(t,e):t;var c=Ea(t,zn(e/ns(t)));return ss(t)?_i($r(c),0,e).join(""):c.slice(0,e)}function Jd(e,t,n,c){var l=t&ce,p=qs(e);function v(){for(var b=-1,x=arguments.length,U=-1,M=c.length,K=A(M+x),Z=this&&this!==Pe&&this instanceof v?p:e;++U<M;)K[U]=c[U];for(;x--;)K[U++]=arguments[++b];return Ut(Z,l?n:this,K)}return v}function Wu(e){return function(t,n,c){return c&&typeof c!="number"&&Xt(t,n,c)&&(n=c=r),t=ni(t),n===r?(n=t,t=0):n=ni(n),c=c===r?t<n?1:-1:ni(c),Fd(t,n,c,e)}}function ro(e){return function(t,n){return typeof t=="string"&&typeof n=="string"||(t=Ar(t),n=Ar(n)),e(t,n)}}function Ju(e,t,n,c,l,p,v,b,x,U){var M=t&N,K=M?v:r,Z=M?r:v,se=M?p:r,he=M?r:p;t|=M?D:_,t&=~(M?_:D),t&O||(t&=~(ce|ve));var be=[e,t,l,se,K,he,Z,b,x,U],le=n.apply(r,be);return qa(e)&&ah(le,be),le.placeholder=c,ch(le,e,t)}function Ta(e){var t=Lt[e];return function(n,c){if(n=Ar(n),c=c==null?0:Bt(ye(c),292),c&&cu(n)){var l=(Le(n)+"e").split("e"),p=t(l[0]+"e"+(+l[1]+c));return l=(Le(p)+"e").split("e"),+(l[0]+"e"+(+l[1]-c))}return t(n)}}var Qd=cs&&1/Rn(new cs([,-0]))[1]==Te?function(e){return new cs(e)}:Za;function Qu(e){return function(t){var n=Gt(t);return n==me?oa(t):n==De?pp(t):np(t,e(t))}}function ti(e,t,n,c,l,p,v,b){var x=t&ve;if(!x&&typeof e!="function")throw new xr(d);var U=c?c.length:0;if(U||(t&=~(D|_),c=l=r),v=v===r?v:qt(ye(v),0),b=b===r?b:ye(b),U-=l?l.length:0,t&_){var M=c,K=l;c=l=r}var Z=x?r:$a(e),se=[e,t,n,c,l,M,K,p,v,b];if(Z&&lg(se,Z),e=se[0],t=se[1],n=se[2],c=se[3],l=se[4],b=se[9]=se[9]===r?x?0:e.length:qt(se[9]-U,0),!b&&t&(N|L)&&(t&=~(N|L)),!t||t==ce)var he=Gd(e,t,n);else t==N||t==L?he=Wd(e,t,b):(t==D||t==(ce|D))&&!l.length?he=Jd(e,t,n,c):he=Xn.apply(r,se);var be=Z?Tu:ah;return ch(be(he,se),e,t)}function Yu(e,t,n,c){return e===r||Dr(e,as[n])&&!je.call(c,n)?t:e}function Zu(e,t,n,c,l,p){return ct(e)&&ct(t)&&(p.set(t,e),Jn(e,t,r,Zu,p),p.delete(t)),e}function Yd(e){return Ms(e)?r:e}function Xu(e,t,n,c,l,p){var v=n&G,b=e.length,x=t.length;if(b!=x&&!(v&&x>b))return!1;var U=p.get(e),M=p.get(t);if(U&&M)return U==t&&M==e;var K=-1,Z=!0,se=n&J?new Li:r;for(p.set(e,t),p.set(t,e);++K<b;){var he=e[K],be=t[K];if(c)var le=v?c(be,he,K,t,e,p):c(he,be,K,e,t,p);if(le!==r){if(le)continue;Z=!1;break}if(se){if(!ea(t,function(Ie,Oe){if(!Ps(se,Oe)&&(he===Ie||l(he,Ie,n,c,p)))return se.push(Oe)})){Z=!1;break}}else if(!(he===be||l(he,be,n,c,p))){Z=!1;break}}return p.delete(e),p.delete(t),Z}function Zd(e,t,n,c,l,p,v){switch(n){case He:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Ne:return!(e.byteLength!=t.byteLength||!p(new qn(e),new qn(t)));case R:case P:case Re:return Dr(+e,+t);case w:return e.name==t.name&&e.message==t.message;case nt:case Je:return e==t+"";case me:var b=oa;case De:var x=c&G;if(b||(b=Rn),e.size!=t.size&&!x)return!1;var U=v.get(e);if(U)return U==t;c|=J,v.set(e,t);var M=Xu(b(e),b(t),c,l,p,v);return v.delete(e),M;case Qe:if(Rs)return Rs.call(e)==Rs.call(t)}return!1}function Xd(e,t,n,c,l,p){var v=n&G,b=Ra(e),x=b.length,U=Ra(t),M=U.length;if(x!=M&&!v)return!1;for(var K=x;K--;){var Z=b[K];if(!(v?Z in t:je.call(t,Z)))return!1}var se=p.get(e),he=p.get(t);if(se&&he)return se==t&&he==e;var be=!0;p.set(e,t),p.set(t,e);for(var le=v;++K<x;){Z=b[K];var Ie=e[Z],Oe=t[Z];if(c)var mr=v?c(Oe,Ie,Z,t,e,p):c(Ie,Oe,Z,e,t,p);if(!(mr===r?Ie===Oe||l(Ie,Oe,n,c,p):mr)){be=!1;break}le||(le=Z=="constructor")}if(be&&!le){var er=e.constructor,br=t.constructor;er!=br&&"constructor"in e&&"constructor"in t&&!(typeof er=="function"&&er instanceof er&&typeof br=="function"&&br instanceof br)&&(be=!1)}return p.delete(e),p.delete(t),be}function ri(e){return Ua(nh(e,r,dh),e+"")}function Ra(e){return bu(e,Mt,Da)}function Na(e){return bu(e,ur,eh)}var $a=Hn?function(e){return Hn.get(e)}:Za;function io(e){for(var t=e.name+"",n=us[t],c=je.call(us,t)?n.length:0;c--;){var l=n[c],p=l.func;if(p==null||p==e)return l.name}return t}function ps(e){var t=je.call(f,"placeholder")?f:e;return t.placeholder}function ue(){var e=f.iteratee||Qa;return e=e===Qa?Eu:e,arguments.length?e(arguments[0],arguments[1]):e}function so(e,t){var n=e.__data__;return ag(t)?n[typeof t=="string"?"string":"hash"]:n.map}function Fa(e){for(var t=Mt(e),n=t.length;n--;){var c=t[n],l=e[c];t[n]=[c,l,ih(l)]}return t}function Ui(e,t){var n=hp(e,t);return _u(n)?n:r}function eg(e){var t=je.call(e,Fi),n=e[Fi];try{e[Fi]=r;var c=!0}catch{}var l=Dn.call(e);return c&&(t?e[Fi]=n:delete e[Fi]),l}var Da=ca?function(e){return e==null?[]:(e=Ge(e),di(ca(e),function(t){return ou.call(e,t)}))}:Xa,eh=ca?function(e){for(var t=[];e;)gi(t,Da(e)),e=jn(e);return t}:Xa,Gt=Zt;(ua&&Gt(new ua(new ArrayBuffer(1)))!=He||Cs&&Gt(new Cs)!=me||ha&&Gt(ha.resolve())!=St||cs&&Gt(new cs)!=De||As&&Gt(new As)!=Me)&&(Gt=function(e){var t=Zt(e),n=t==xe?e.constructor:r,c=n?Mi(n):"";if(c)switch(c){case Lp:return He;case qp:return me;case jp:return St;case Up:return De;case Mp:return Me}return t});function tg(e,t,n){for(var c=-1,l=n.length;++c<l;){var p=n[c],v=p.size;switch(p.type){case"drop":e+=v;break;case"dropRight":t-=v;break;case"take":t=Bt(t,e+v);break;case"takeRight":e=qt(e,t-v);break}}return{start:e,end:t}}function rg(e){var t=e.match(We);return t?t[1].split(Tt):[]}function th(e,t,n){t=wi(t,e);for(var c=-1,l=t.length,p=!1;++c<l;){var v=Vr(t[c]);if(!(p=e!=null&&n(e,v)))break;e=e[v]}return p||++c!=l?p:(l=e==null?0:e.length,!!l&&lo(l)&&ii(v,l)&&(ge(e)||zi(e)))}function ig(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&je.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function rh(e){return typeof e.constructor=="function"&&!js(e)?hs(jn(e)):{}}function sg(e,t,n){var c=e.constructor;switch(t){case Ne:return Ca(e);case R:case P:return new c(+e);case He:return zd(e,n);case ht:case qe:case Pt:case Dt:case kt:case Ht:case jt:case Jt:case nr:return ju(e,n);case me:return new c;case Re:case Je:return new c(e);case nt:return kd(e);case De:return new c;case Qe:return Hd(e)}}function ng(e,t){var n=t.length;if(!n)return e;var c=n-1;return t[c]=(n>1?"& ":"")+t[c],t=t.join(n>2?", ":" "),e.replace(yt,`{
/* [wrapped with `+t+`] */
`)}function og(e){return ge(e)||zi(e)||!!(au&&e&&e[au])}function ii(e,t){var n=typeof e;return t=t??ee,!!t&&(n=="number"||n!="symbol"&&jo.test(e))&&e>-1&&e%1==0&&e<t}function Xt(e,t,n){if(!ct(n))return!1;var c=typeof t;return(c=="number"?cr(n)&&ii(t,n.length):c=="string"&&t in n)?Dr(n[t],e):!1}function La(e,t){if(ge(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||vr(e)?!0:Ot.test(e)||!rt.test(e)||t!=null&&e in Ge(t)}function ag(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function qa(e){var t=io(e),n=f[t];if(typeof n!="function"||!(t in Se.prototype))return!1;if(e===n)return!0;var c=$a(n);return!!c&&e===c[0]}function cg(e){return!!iu&&iu in e}var ug=$n?si:ec;function js(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||as;return e===n}function ih(e){return e===e&&!ct(e)}function sh(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==r||e in Ge(n))}}function hg(e){var t=uo(e,function(c){return n.size===S&&n.clear(),c}),n=t.cache;return t}function lg(e,t){var n=e[1],c=t[1],l=n|c,p=l<(ce|ve|$),v=c==$&&n==N||c==$&&n==z&&e[7].length<=t[8]||c==($|z)&&t[7].length<=t[8]&&n==N;if(!(p||v))return e;c&ce&&(e[2]=t[2],l|=n&ce?0:O);var b=t[3];if(b){var x=e[3];e[3]=x?Mu(x,b,t[4]):b,e[4]=x?yi(e[3],C):t[4]}return b=t[5],b&&(x=e[5],e[5]=x?zu(x,b,t[6]):b,e[6]=x?yi(e[5],C):t[6]),b=t[7],b&&(e[7]=b),c&$&&(e[8]=e[8]==null?t[8]:Bt(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=l,e}function fg(e){var t=[];if(e!=null)for(var n in Ge(e))t.push(n);return t}function pg(e){return Dn.call(e)}function nh(e,t,n){return t=qt(t===r?e.length-1:t,0),function(){for(var c=arguments,l=-1,p=qt(c.length-t,0),v=A(p);++l<p;)v[l]=c[t+l];l=-1;for(var b=A(t+1);++l<t;)b[l]=c[l];return b[t]=n(v),Ut(e,this,b)}}function oh(e,t){return t.length<2?e:ji(e,Or(t,0,-1))}function dg(e,t){for(var n=e.length,c=Bt(t.length,n),l=ar(e);c--;){var p=t[c];e[c]=ii(p,n)?l[p]:r}return e}function ja(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var ah=uh(Tu),Us=Ap||function(e,t){return Pe.setTimeout(e,t)},Ua=uh(qd);function ch(e,t,n){var c=t+"";return Ua(e,ng(c,gg(rg(c),n)))}function uh(e){var t=0,n=0;return function(){var c=$p(),l=et-(c-n);if(n=c,l>0){if(++t>=Ae)return arguments[0]}else t=0;return e.apply(r,arguments)}}function no(e,t){var n=-1,c=e.length,l=c-1;for(t=t===r?c:t;++n<t;){var p=_a(n,l),v=e[p];e[p]=e[n],e[n]=v}return e.length=t,e}var hh=hg(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Ct,function(n,c,l,p){t.push(l?p.replace(No,"$1"):c||n)}),t});function Vr(e){if(typeof e=="string"||vr(e))return e;var t=e+"";return t=="0"&&1/e==-Te?"-0":t}function Mi(e){if(e!=null){try{return Fn.call(e)}catch{}try{return e+""}catch{}}return""}function gg(e,t){return Ir(Ur,function(n){var c="_."+n[0];t&n[1]&&!An(e,c)&&e.push(c)}),e.sort()}function lh(e){if(e instanceof Se)return e.clone();var t=new Sr(e.__wrapped__,e.__chain__);return t.__actions__=ar(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function yg(e,t,n){(n?Xt(e,t,n):t===r)?t=1:t=qt(ye(t),0);var c=e==null?0:e.length;if(!c||t<1)return[];for(var l=0,p=0,v=A(zn(c/t));l<c;)v[p++]=Or(e,l,l+=t);return v}function vg(e){for(var t=-1,n=e==null?0:e.length,c=0,l=[];++t<n;){var p=e[t];p&&(l[c++]=p)}return l}function mg(){var e=arguments.length;if(!e)return[];for(var t=A(e-1),n=arguments[0],c=e;c--;)t[c-1]=arguments[c];return gi(ge(n)?ar(n):[n],Kt(t,1))}var bg=_e(function(e,t){return _t(e)?$s(e,Kt(t,1,_t,!0)):[]}),wg=_e(function(e,t){var n=Cr(t);return _t(n)&&(n=r),_t(e)?$s(e,Kt(t,1,_t,!0),ue(n,2)):[]}),_g=_e(function(e,t){var n=Cr(t);return _t(n)&&(n=r),_t(e)?$s(e,Kt(t,1,_t,!0),r,n):[]});function Eg(e,t,n){var c=e==null?0:e.length;return c?(t=n||t===r?1:ye(t),Or(e,t<0?0:t,c)):[]}function Ig(e,t,n){var c=e==null?0:e.length;return c?(t=n||t===r?1:ye(t),t=c-t,Or(e,0,t<0?0:t)):[]}function xg(e,t){return e&&e.length?Yn(e,ue(t,3),!0,!0):[]}function Sg(e,t){return e&&e.length?Yn(e,ue(t,3),!0):[]}function Pg(e,t,n,c){var l=e==null?0:e.length;return l?(n&&typeof n!="number"&&Xt(e,t,n)&&(n=0,c=l),md(e,t,n,c)):[]}function fh(e,t,n){var c=e==null?0:e.length;if(!c)return-1;var l=n==null?0:ye(n);return l<0&&(l=qt(c+l,0)),Tn(e,ue(t,3),l)}function ph(e,t,n){var c=e==null?0:e.length;if(!c)return-1;var l=c-1;return n!==r&&(l=ye(n),l=n<0?qt(c+l,0):Bt(l,c-1)),Tn(e,ue(t,3),l,!0)}function dh(e){var t=e==null?0:e.length;return t?Kt(e,1):[]}function Og(e){var t=e==null?0:e.length;return t?Kt(e,Te):[]}function Cg(e,t){var n=e==null?0:e.length;return n?(t=t===r?1:ye(t),Kt(e,t)):[]}function Ag(e){for(var t=-1,n=e==null?0:e.length,c={};++t<n;){var l=e[t];c[l[0]]=l[1]}return c}function gh(e){return e&&e.length?e[0]:r}function Tg(e,t,n){var c=e==null?0:e.length;if(!c)return-1;var l=n==null?0:ye(n);return l<0&&(l=qt(c+l,0)),is(e,t,l)}function Rg(e){var t=e==null?0:e.length;return t?Or(e,0,-1):[]}var Ng=_e(function(e){var t=it(e,Pa);return t.length&&t[0]===e[0]?ya(t):[]}),$g=_e(function(e){var t=Cr(e),n=it(e,Pa);return t===Cr(n)?t=r:n.pop(),n.length&&n[0]===e[0]?ya(n,ue(t,2)):[]}),Fg=_e(function(e){var t=Cr(e),n=it(e,Pa);return t=typeof t=="function"?t:r,t&&n.pop(),n.length&&n[0]===e[0]?ya(n,r,t):[]});function Dg(e,t){return e==null?"":Rp.call(e,t)}function Cr(e){var t=e==null?0:e.length;return t?e[t-1]:r}function Lg(e,t,n){var c=e==null?0:e.length;if(!c)return-1;var l=c;return n!==r&&(l=ye(n),l=l<0?qt(c+l,0):Bt(l,c-1)),t===t?gp(e,t,l):Tn(e,Jc,l,!0)}function qg(e,t){return e&&e.length?Pu(e,ye(t)):r}var jg=_e(yh);function yh(e,t){return e&&e.length&&t&&t.length?wa(e,t):e}function Ug(e,t,n){return e&&e.length&&t&&t.length?wa(e,t,ue(n,2)):e}function Mg(e,t,n){return e&&e.length&&t&&t.length?wa(e,t,r,n):e}var zg=ri(function(e,t){var n=e==null?0:e.length,c=fa(e,t);return Au(e,it(t,function(l){return ii(l,n)?+l:l}).sort(Uu)),c});function kg(e,t){var n=[];if(!(e&&e.length))return n;var c=-1,l=[],p=e.length;for(t=ue(t,3);++c<p;){var v=e[c];t(v,c,e)&&(n.push(v),l.push(c))}return Au(e,l),n}function Ma(e){return e==null?e:Dp.call(e)}function Hg(e,t,n){var c=e==null?0:e.length;return c?(n&&typeof n!="number"&&Xt(e,t,n)?(t=0,n=c):(t=t==null?0:ye(t),n=n===r?c:ye(n)),Or(e,t,n)):[]}function Kg(e,t){return Qn(e,t)}function Vg(e,t,n){return Ia(e,t,ue(n,2))}function Bg(e,t){var n=e==null?0:e.length;if(n){var c=Qn(e,t);if(c<n&&Dr(e[c],t))return c}return-1}function Gg(e,t){return Qn(e,t,!0)}function Wg(e,t,n){return Ia(e,t,ue(n,2),!0)}function Jg(e,t){var n=e==null?0:e.length;if(n){var c=Qn(e,t,!0)-1;if(Dr(e[c],t))return c}return-1}function Qg(e){return e&&e.length?Ru(e):[]}function Yg(e,t){return e&&e.length?Ru(e,ue(t,2)):[]}function Zg(e){var t=e==null?0:e.length;return t?Or(e,1,t):[]}function Xg(e,t,n){return e&&e.length?(t=n||t===r?1:ye(t),Or(e,0,t<0?0:t)):[]}function ey(e,t,n){var c=e==null?0:e.length;return c?(t=n||t===r?1:ye(t),t=c-t,Or(e,t<0?0:t,c)):[]}function ty(e,t){return e&&e.length?Yn(e,ue(t,3),!1,!0):[]}function ry(e,t){return e&&e.length?Yn(e,ue(t,3)):[]}var iy=_e(function(e){return bi(Kt(e,1,_t,!0))}),sy=_e(function(e){var t=Cr(e);return _t(t)&&(t=r),bi(Kt(e,1,_t,!0),ue(t,2))}),ny=_e(function(e){var t=Cr(e);return t=typeof t=="function"?t:r,bi(Kt(e,1,_t,!0),r,t)});function oy(e){return e&&e.length?bi(e):[]}function ay(e,t){return e&&e.length?bi(e,ue(t,2)):[]}function cy(e,t){return t=typeof t=="function"?t:r,e&&e.length?bi(e,r,t):[]}function za(e){if(!(e&&e.length))return[];var t=0;return e=di(e,function(n){if(_t(n))return t=qt(n.length,t),!0}),sa(t,function(n){return it(e,ta(n))})}function vh(e,t){if(!(e&&e.length))return[];var n=za(e);return t==null?n:it(n,function(c){return Ut(t,r,c)})}var uy=_e(function(e,t){return _t(e)?$s(e,t):[]}),hy=_e(function(e){return Sa(di(e,_t))}),ly=_e(function(e){var t=Cr(e);return _t(t)&&(t=r),Sa(di(e,_t),ue(t,2))}),fy=_e(function(e){var t=Cr(e);return t=typeof t=="function"?t:r,Sa(di(e,_t),r,t)}),py=_e(za);function dy(e,t){return Du(e||[],t||[],Ns)}function gy(e,t){return Du(e||[],t||[],Ls)}var yy=_e(function(e){var t=e.length,n=t>1?e[t-1]:r;return n=typeof n=="function"?(e.pop(),n):r,vh(e,n)});function mh(e){var t=f(e);return t.__chain__=!0,t}function vy(e,t){return t(e),e}function oo(e,t){return t(e)}var my=ri(function(e){var t=e.length,n=t?e[0]:0,c=this.__wrapped__,l=function(p){return fa(p,e)};return t>1||this.__actions__.length||!(c instanceof Se)||!ii(n)?this.thru(l):(c=c.slice(n,+n+(t?1:0)),c.__actions__.push({func:oo,args:[l],thisArg:r}),new Sr(c,this.__chain__).thru(function(p){return t&&!p.length&&p.push(r),p}))});function by(){return mh(this)}function wy(){return new Sr(this.value(),this.__chain__)}function _y(){this.__values__===r&&(this.__values__=Nh(this.value()));var e=this.__index__>=this.__values__.length,t=e?r:this.__values__[this.__index__++];return{done:e,value:t}}function Ey(){return this}function Iy(e){for(var t,n=this;n instanceof Vn;){var c=lh(n);c.__index__=0,c.__values__=r,t?l.__wrapped__=c:t=c;var l=c;n=n.__wrapped__}return l.__wrapped__=e,t}function xy(){var e=this.__wrapped__;if(e instanceof Se){var t=e;return this.__actions__.length&&(t=new Se(this)),t=t.reverse(),t.__actions__.push({func:oo,args:[Ma],thisArg:r}),new Sr(t,this.__chain__)}return this.thru(Ma)}function Sy(){return Fu(this.__wrapped__,this.__actions__)}var Py=Zn(function(e,t,n){je.call(e,n)?++e[n]:ei(e,n,1)});function Oy(e,t,n){var c=ge(e)?Gc:vd;return n&&Xt(e,t,n)&&(t=r),c(e,ue(t,3))}function Cy(e,t){var n=ge(e)?di:vu;return n(e,ue(t,3))}var Ay=Vu(fh),Ty=Vu(ph);function Ry(e,t){return Kt(ao(e,t),1)}function Ny(e,t){return Kt(ao(e,t),Te)}function $y(e,t,n){return n=n===r?1:ye(n),Kt(ao(e,t),n)}function bh(e,t){var n=ge(e)?Ir:mi;return n(e,ue(t,3))}function wh(e,t){var n=ge(e)?Zf:yu;return n(e,ue(t,3))}var Fy=Zn(function(e,t,n){je.call(e,n)?e[n].push(t):ei(e,n,[t])});function Dy(e,t,n,c){e=cr(e)?e:gs(e),n=n&&!c?ye(n):0;var l=e.length;return n<0&&(n=qt(l+n,0)),fo(e)?n<=l&&e.indexOf(t,n)>-1:!!l&&is(e,t,n)>-1}var Ly=_e(function(e,t,n){var c=-1,l=typeof t=="function",p=cr(e)?A(e.length):[];return mi(e,function(v){p[++c]=l?Ut(t,v,n):Fs(v,t,n)}),p}),qy=Zn(function(e,t,n){ei(e,n,t)});function ao(e,t){var n=ge(e)?it:Iu;return n(e,ue(t,3))}function jy(e,t,n,c){return e==null?[]:(ge(t)||(t=t==null?[]:[t]),n=c?r:n,ge(n)||(n=n==null?[]:[n]),Ou(e,t,n))}var Uy=Zn(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});function My(e,t,n){var c=ge(e)?Xo:Yc,l=arguments.length<3;return c(e,ue(t,4),n,l,mi)}function zy(e,t,n){var c=ge(e)?Xf:Yc,l=arguments.length<3;return c(e,ue(t,4),n,l,yu)}function ky(e,t){var n=ge(e)?di:vu;return n(e,ho(ue(t,3)))}function Hy(e){var t=ge(e)?fu:Dd;return t(e)}function Ky(e,t,n){(n?Xt(e,t,n):t===r)?t=1:t=ye(t);var c=ge(e)?fd:Ld;return c(e,t)}function Vy(e){var t=ge(e)?pd:jd;return t(e)}function By(e){if(e==null)return 0;if(cr(e))return fo(e)?ns(e):e.length;var t=Gt(e);return t==me||t==De?e.size:ma(e).length}function Gy(e,t,n){var c=ge(e)?ea:Ud;return n&&Xt(e,t,n)&&(t=r),c(e,ue(t,3))}var Wy=_e(function(e,t){if(e==null)return[];var n=t.length;return n>1&&Xt(e,t[0],t[1])?t=[]:n>2&&Xt(t[0],t[1],t[2])&&(t=[t[0]]),Ou(e,Kt(t,1),[])}),co=Cp||function(){return Pe.Date.now()};function Jy(e,t){if(typeof t!="function")throw new xr(d);return e=ye(e),function(){if(--e<1)return t.apply(this,arguments)}}function _h(e,t,n){return t=n?r:t,t=e&&t==null?e.length:t,ti(e,$,r,r,r,r,t)}function Eh(e,t){var n;if(typeof t!="function")throw new xr(d);return e=ye(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=r),n}}var ka=_e(function(e,t,n){var c=ce;if(n.length){var l=yi(n,ps(ka));c|=D}return ti(e,c,t,n,l)}),Ih=_e(function(e,t,n){var c=ce|ve;if(n.length){var l=yi(n,ps(Ih));c|=D}return ti(t,c,e,n,l)});function xh(e,t,n){t=n?r:t;var c=ti(e,N,r,r,r,r,r,t);return c.placeholder=xh.placeholder,c}function Sh(e,t,n){t=n?r:t;var c=ti(e,L,r,r,r,r,r,t);return c.placeholder=Sh.placeholder,c}function Ph(e,t,n){var c,l,p,v,b,x,U=0,M=!1,K=!1,Z=!0;if(typeof e!="function")throw new xr(d);t=Ar(t)||0,ct(n)&&(M=!!n.leading,K="maxWait"in n,p=K?qt(Ar(n.maxWait)||0,t):p,Z="trailing"in n?!!n.trailing:Z);function se(Et){var Lr=c,oi=l;return c=l=r,U=Et,v=e.apply(oi,Lr),v}function he(Et){return U=Et,b=Us(Ie,t),M?se(Et):v}function be(Et){var Lr=Et-x,oi=Et-U,Vh=t-Lr;return K?Bt(Vh,p-oi):Vh}function le(Et){var Lr=Et-x,oi=Et-U;return x===r||Lr>=t||Lr<0||K&&oi>=p}function Ie(){var Et=co();if(le(Et))return Oe(Et);b=Us(Ie,be(Et))}function Oe(Et){return b=r,Z&&c?se(Et):(c=l=r,v)}function mr(){b!==r&&Lu(b),U=0,c=x=l=b=r}function er(){return b===r?v:Oe(co())}function br(){var Et=co(),Lr=le(Et);if(c=arguments,l=this,x=Et,Lr){if(b===r)return he(x);if(K)return Lu(b),b=Us(Ie,t),se(x)}return b===r&&(b=Us(Ie,t)),v}return br.cancel=mr,br.flush=er,br}var Qy=_e(function(e,t){return gu(e,1,t)}),Yy=_e(function(e,t,n){return gu(e,Ar(t)||0,n)});function Zy(e){return ti(e,ae)}function uo(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new xr(d);var n=function(){var c=arguments,l=t?t.apply(this,c):c[0],p=n.cache;if(p.has(l))return p.get(l);var v=e.apply(this,c);return n.cache=p.set(l,v)||p,v};return n.cache=new(uo.Cache||Xr),n}uo.Cache=Xr;function ho(e){if(typeof e!="function")throw new xr(d);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function Xy(e){return Eh(2,e)}var e0=Md(function(e,t){t=t.length==1&&ge(t[0])?it(t[0],gr(ue())):it(Kt(t,1),gr(ue()));var n=t.length;return _e(function(c){for(var l=-1,p=Bt(c.length,n);++l<p;)c[l]=t[l].call(this,c[l]);return Ut(e,this,c)})}),Ha=_e(function(e,t){var n=yi(t,ps(Ha));return ti(e,D,r,t,n)}),Oh=_e(function(e,t){var n=yi(t,ps(Oh));return ti(e,_,r,t,n)}),t0=ri(function(e,t){return ti(e,z,r,r,r,t)});function r0(e,t){if(typeof e!="function")throw new xr(d);return t=t===r?t:ye(t),_e(e,t)}function i0(e,t){if(typeof e!="function")throw new xr(d);return t=t==null?0:qt(ye(t),0),_e(function(n){var c=n[t],l=_i(n,0,t);return c&&gi(l,c),Ut(e,this,l)})}function s0(e,t,n){var c=!0,l=!0;if(typeof e!="function")throw new xr(d);return ct(n)&&(c="leading"in n?!!n.leading:c,l="trailing"in n?!!n.trailing:l),Ph(e,t,{leading:c,maxWait:t,trailing:l})}function n0(e){return _h(e,1)}function o0(e,t){return Ha(Oa(t),e)}function a0(){if(!arguments.length)return[];var e=arguments[0];return ge(e)?e:[e]}function c0(e){return Pr(e,W)}function u0(e,t){return t=typeof t=="function"?t:r,Pr(e,W,t)}function h0(e){return Pr(e,j|W)}function l0(e,t){return t=typeof t=="function"?t:r,Pr(e,j|W,t)}function f0(e,t){return t==null||du(e,t,Mt(t))}function Dr(e,t){return e===t||e!==e&&t!==t}var p0=ro(ga),d0=ro(function(e,t){return e>=t}),zi=wu(function(){return arguments}())?wu:function(e){return vt(e)&&je.call(e,"callee")&&!ou.call(e,"callee")},ge=A.isArray,g0=Yt?gr(Yt):Id;function cr(e){return e!=null&&lo(e.length)&&!si(e)}function _t(e){return vt(e)&&cr(e)}function y0(e){return e===!0||e===!1||vt(e)&&Zt(e)==R}var Ei=Tp||ec,v0=Nr?gr(Nr):xd;function m0(e){return vt(e)&&e.nodeType===1&&!Ms(e)}function b0(e){if(e==null)return!0;if(cr(e)&&(ge(e)||typeof e=="string"||typeof e.splice=="function"||Ei(e)||ds(e)||zi(e)))return!e.length;var t=Gt(e);if(t==me||t==De)return!e.size;if(js(e))return!ma(e).length;for(var n in e)if(je.call(e,n))return!1;return!0}function w0(e,t){return Ds(e,t)}function _0(e,t,n){n=typeof n=="function"?n:r;var c=n?n(e,t):r;return c===r?Ds(e,t,r,n):!!c}function Ka(e){if(!vt(e))return!1;var t=Zt(e);return t==w||t==u||typeof e.message=="string"&&typeof e.name=="string"&&!Ms(e)}function E0(e){return typeof e=="number"&&cu(e)}function si(e){if(!ct(e))return!1;var t=Zt(e);return t==ie||t==fe||t==F||t==mt}function Ch(e){return typeof e=="number"&&e==ye(e)}function lo(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=ee}function ct(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function vt(e){return e!=null&&typeof e=="object"}var Ah=Er?gr(Er):Pd;function I0(e,t){return e===t||va(e,t,Fa(t))}function x0(e,t,n){return n=typeof n=="function"?n:r,va(e,t,Fa(t),n)}function S0(e){return Th(e)&&e!=+e}function P0(e){if(ug(e))throw new pe(h);return _u(e)}function O0(e){return e===null}function C0(e){return e==null}function Th(e){return typeof e=="number"||vt(e)&&Zt(e)==Re}function Ms(e){if(!vt(e)||Zt(e)!=xe)return!1;var t=jn(e);if(t===null)return!0;var n=je.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&Fn.call(n)==xp}var Va=kr?gr(kr):Od;function A0(e){return Ch(e)&&e>=-ee&&e<=ee}var Rh=Ss?gr(Ss):Cd;function fo(e){return typeof e=="string"||!ge(e)&&vt(e)&&Zt(e)==Je}function vr(e){return typeof e=="symbol"||vt(e)&&Zt(e)==Qe}var ds=$i?gr($i):Ad;function T0(e){return e===r}function R0(e){return vt(e)&&Gt(e)==Me}function N0(e){return vt(e)&&Zt(e)==Ye}var $0=ro(ba),F0=ro(function(e,t){return e<=t});function Nh(e){if(!e)return[];if(cr(e))return fo(e)?$r(e):ar(e);if(Os&&e[Os])return fp(e[Os]());var t=Gt(e),n=t==me?oa:t==De?Rn:gs;return n(e)}function ni(e){if(!e)return e===0?e:0;if(e=Ar(e),e===Te||e===-Te){var t=e<0?-1:1;return t*Q}return e===e?e:0}function ye(e){var t=ni(e),n=t%1;return t===t?n?t-n:t:0}function $h(e){return e?qi(ye(e),0,Y):0}function Ar(e){if(typeof e=="number")return e;if(vr(e))return V;if(ct(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ct(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Zc(e);var n=Do.test(e);return n||qo.test(e)?de(e.slice(2),n?2:8):Fo.test(e)?V:+e}function Fh(e){return Kr(e,ur(e))}function D0(e){return e?qi(ye(e),-ee,ee):e===0?e:0}function Le(e){return e==null?"":yr(e)}var L0=ls(function(e,t){if(js(t)||cr(t)){Kr(t,Mt(t),e);return}for(var n in t)je.call(t,n)&&Ns(e,n,t[n])}),Dh=ls(function(e,t){Kr(t,ur(t),e)}),po=ls(function(e,t,n,c){Kr(t,ur(t),e,c)}),q0=ls(function(e,t,n,c){Kr(t,Mt(t),e,c)}),j0=ri(fa);function U0(e,t){var n=hs(e);return t==null?n:pu(n,t)}var M0=_e(function(e,t){e=Ge(e);var n=-1,c=t.length,l=c>2?t[2]:r;for(l&&Xt(t[0],t[1],l)&&(c=1);++n<c;)for(var p=t[n],v=ur(p),b=-1,x=v.length;++b<x;){var U=v[b],M=e[U];(M===r||Dr(M,as[U])&&!je.call(e,U))&&(e[U]=p[U])}return e}),z0=_e(function(e){return e.push(r,Zu),Ut(Lh,r,e)});function k0(e,t){return Wc(e,ue(t,3),Hr)}function H0(e,t){return Wc(e,ue(t,3),da)}function K0(e,t){return e==null?e:pa(e,ue(t,3),ur)}function V0(e,t){return e==null?e:mu(e,ue(t,3),ur)}function B0(e,t){return e&&Hr(e,ue(t,3))}function G0(e,t){return e&&da(e,ue(t,3))}function W0(e){return e==null?[]:Wn(e,Mt(e))}function J0(e){return e==null?[]:Wn(e,ur(e))}function Ba(e,t,n){var c=e==null?r:ji(e,t);return c===r?n:c}function Q0(e,t){return e!=null&&th(e,t,bd)}function Ga(e,t){return e!=null&&th(e,t,wd)}var Y0=Gu(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Dn.call(t)),e[t]=n},Ja(hr)),Z0=Gu(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=Dn.call(t)),je.call(e,t)?e[t].push(n):e[t]=[n]},ue),X0=_e(Fs);function Mt(e){return cr(e)?lu(e):ma(e)}function ur(e){return cr(e)?lu(e,!0):Td(e)}function ev(e,t){var n={};return t=ue(t,3),Hr(e,function(c,l,p){ei(n,t(c,l,p),c)}),n}function tv(e,t){var n={};return t=ue(t,3),Hr(e,function(c,l,p){ei(n,l,t(c,l,p))}),n}var rv=ls(function(e,t,n){Jn(e,t,n)}),Lh=ls(function(e,t,n,c){Jn(e,t,n,c)}),iv=ri(function(e,t){var n={};if(e==null)return n;var c=!1;t=it(t,function(p){return p=wi(p,e),c||(c=p.length>1),p}),Kr(e,Na(e),n),c&&(n=Pr(n,j|B|W,Yd));for(var l=t.length;l--;)xa(n,t[l]);return n});function sv(e,t){return qh(e,ho(ue(t)))}var nv=ri(function(e,t){return e==null?{}:Nd(e,t)});function qh(e,t){if(e==null)return{};var n=it(Na(e),function(c){return[c]});return t=ue(t),Cu(e,n,function(c,l){return t(c,l[0])})}function ov(e,t,n){t=wi(t,e);var c=-1,l=t.length;for(l||(l=1,e=r);++c<l;){var p=e==null?r:e[Vr(t[c])];p===r&&(c=l,p=n),e=si(p)?p.call(e):p}return e}function av(e,t,n){return e==null?e:Ls(e,t,n)}function cv(e,t,n,c){return c=typeof c=="function"?c:r,e==null?e:Ls(e,t,n,c)}var jh=Qu(Mt),Uh=Qu(ur);function uv(e,t,n){var c=ge(e),l=c||Ei(e)||ds(e);if(t=ue(t,4),n==null){var p=e&&e.constructor;l?n=c?new p:[]:ct(e)?n=si(p)?hs(jn(e)):{}:n={}}return(l?Ir:Hr)(e,function(v,b,x){return t(n,v,b,x)}),n}function hv(e,t){return e==null?!0:xa(e,t)}function lv(e,t,n){return e==null?e:$u(e,t,Oa(n))}function fv(e,t,n,c){return c=typeof c=="function"?c:r,e==null?e:$u(e,t,Oa(n),c)}function gs(e){return e==null?[]:na(e,Mt(e))}function pv(e){return e==null?[]:na(e,ur(e))}function dv(e,t,n){return n===r&&(n=t,t=r),n!==r&&(n=Ar(n),n=n===n?n:0),t!==r&&(t=Ar(t),t=t===t?t:0),qi(Ar(e),t,n)}function gv(e,t,n){return t=ni(t),n===r?(n=t,t=0):n=ni(n),e=Ar(e),_d(e,t,n)}function yv(e,t,n){if(n&&typeof n!="boolean"&&Xt(e,t,n)&&(t=n=r),n===r&&(typeof t=="boolean"?(n=t,t=r):typeof e=="boolean"&&(n=e,e=r)),e===r&&t===r?(e=0,t=1):(e=ni(e),t===r?(t=e,e=0):t=ni(t)),e>t){var c=e;e=t,t=c}if(n||e%1||t%1){var l=uu();return Bt(e+l*(t-e+Ve("1e-"+((l+"").length-1))),t)}return _a(e,t)}var vv=fs(function(e,t,n){return t=t.toLowerCase(),e+(n?Mh(t):t)});function Mh(e){return Wa(Le(e).toLowerCase())}function zh(e){return e=Le(e),e&&e.replace(Qr,ap).replace(Qo,"")}function mv(e,t,n){e=Le(e),t=yr(t);var c=e.length;n=n===r?c:qi(ye(n),0,c);var l=n;return n-=t.length,n>=0&&e.slice(n,l)==t}function bv(e){return e=Le(e),e&&tt.test(e)?e.replace(Ci,cp):e}function wv(e){return e=Le(e),e&&At.test(e)?e.replace(dt,"\\$&"):e}var _v=fs(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),Ev=fs(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),Iv=Ku("toLowerCase");function xv(e,t,n){e=Le(e),t=ye(t);var c=t?ns(e):0;if(!t||c>=t)return e;var l=(t-c)/2;return to(kn(l),n)+e+to(zn(l),n)}function Sv(e,t,n){e=Le(e),t=ye(t);var c=t?ns(e):0;return t&&c<t?e+to(t-c,n):e}function Pv(e,t,n){e=Le(e),t=ye(t);var c=t?ns(e):0;return t&&c<t?to(t-c,n)+e:e}function Ov(e,t,n){return n||t==null?t=0:t&&(t=+t),Fp(Le(e).replace(gt,""),t||0)}function Cv(e,t,n){return(n?Xt(e,t,n):t===r)?t=1:t=ye(t),Ea(Le(e),t)}function Av(){var e=arguments,t=Le(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var Tv=fs(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});function Rv(e,t,n){return n&&typeof n!="number"&&Xt(e,t,n)&&(t=n=r),n=n===r?Y:n>>>0,n?(e=Le(e),e&&(typeof t=="string"||t!=null&&!Va(t))&&(t=yr(t),!t&&ss(e))?_i($r(e),0,n):e.split(t,n)):[]}var Nv=fs(function(e,t,n){return e+(n?" ":"")+Wa(t)});function $v(e,t,n){return e=Le(e),n=n==null?0:qi(ye(n),0,e.length),t=yr(t),e.slice(n,n+t.length)==t}function Fv(e,t,n){var c=f.templateSettings;n&&Xt(e,t,n)&&(t=r),e=Le(e),t=po({},t,c,Yu);var l=po({},t.imports,c.imports,Yu),p=Mt(l),v=na(l,p),b,x,U=0,M=t.interpolate||Qi,K="__p += '",Z=aa((t.escape||Qi).source+"|"+M.source+"|"+(M===at?$o:Qi).source+"|"+(t.evaluate||Qi).source+"|$","g"),se="//# sourceURL="+(je.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Yo+"]")+`
`;e.replace(Z,function(le,Ie,Oe,mr,er,br){return Oe||(Oe=mr),K+=e.slice(U,br).replace(Uo,up),Ie&&(b=!0,K+=`' +
__e(`+Ie+`) +
'`),er&&(x=!0,K+=`';
`+er+`;
__p += '`),Oe&&(K+=`' +
((__t = (`+Oe+`)) == null ? '' : __t) +
'`),U=br+le.length,le}),K+=`';
`;var he=je.call(t,"variable")&&t.variable;if(!he)K=`with (obj) {
`+K+`
}
`;else if(Ro.test(he))throw new pe(y);K=(x?K.replace(Mr,""):K).replace(Qt,"$1").replace(Jr,"$1;"),K="function("+(he||"obj")+`) {
`+(he?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(b?", __e = _.escape":"")+(x?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+K+`return __p
}`;var be=Hh(function(){return Fe(p,se+"return "+K).apply(r,v)});if(be.source=K,Ka(be))throw be;return be}function Dv(e){return Le(e).toLowerCase()}function Lv(e){return Le(e).toUpperCase()}function qv(e,t,n){if(e=Le(e),e&&(n||t===r))return Zc(e);if(!e||!(t=yr(t)))return e;var c=$r(e),l=$r(t),p=Xc(c,l),v=eu(c,l)+1;return _i(c,p,v).join("")}function jv(e,t,n){if(e=Le(e),e&&(n||t===r))return e.slice(0,ru(e)+1);if(!e||!(t=yr(t)))return e;var c=$r(e),l=eu(c,$r(t))+1;return _i(c,0,l).join("")}function Uv(e,t,n){if(e=Le(e),e&&(n||t===r))return e.replace(gt,"");if(!e||!(t=yr(t)))return e;var c=$r(e),l=Xc(c,$r(t));return _i(c,l).join("")}function Mv(e,t){var n=oe,c=Ee;if(ct(t)){var l="separator"in t?t.separator:l;n="length"in t?ye(t.length):n,c="omission"in t?yr(t.omission):c}e=Le(e);var p=e.length;if(ss(e)){var v=$r(e);p=v.length}if(n>=p)return e;var b=n-ns(c);if(b<1)return c;var x=v?_i(v,0,b).join(""):e.slice(0,b);if(l===r)return x+c;if(v&&(b+=x.length-b),Va(l)){if(e.slice(b).search(l)){var U,M=x;for(l.global||(l=aa(l.source,Le(_r.exec(l))+"g")),l.lastIndex=0;U=l.exec(M);)var K=U.index;x=x.slice(0,K===r?b:K)}}else if(e.indexOf(yr(l),b)!=b){var Z=x.lastIndexOf(l);Z>-1&&(x=x.slice(0,Z))}return x+c}function zv(e){return e=Le(e),e&&lt.test(e)?e.replace(fi,yp):e}var kv=fs(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),Wa=Ku("toUpperCase");function kh(e,t,n){return e=Le(e),t=n?r:t,t===r?lp(e)?bp(e):rp(e):e.match(t)||[]}var Hh=_e(function(e,t){try{return Ut(e,r,t)}catch(n){return Ka(n)?n:new pe(n)}}),Hv=ri(function(e,t){return Ir(t,function(n){n=Vr(n),ei(e,n,ka(e[n],e))}),e});function Kv(e){var t=e==null?0:e.length,n=ue();return e=t?it(e,function(c){if(typeof c[1]!="function")throw new xr(d);return[n(c[0]),c[1]]}):[],_e(function(c){for(var l=-1;++l<t;){var p=e[l];if(Ut(p[0],this,c))return Ut(p[1],this,c)}})}function Vv(e){return yd(Pr(e,j))}function Ja(e){return function(){return e}}function Bv(e,t){return e==null||e!==e?t:e}var Gv=Bu(),Wv=Bu(!0);function hr(e){return e}function Qa(e){return Eu(typeof e=="function"?e:Pr(e,j))}function Jv(e){return xu(Pr(e,j))}function Qv(e,t){return Su(e,Pr(t,j))}var Yv=_e(function(e,t){return function(n){return Fs(n,e,t)}}),Zv=_e(function(e,t){return function(n){return Fs(e,n,t)}});function Ya(e,t,n){var c=Mt(t),l=Wn(t,c);n==null&&!(ct(t)&&(l.length||!c.length))&&(n=t,t=e,e=this,l=Wn(t,Mt(t)));var p=!(ct(n)&&"chain"in n)||!!n.chain,v=si(e);return Ir(l,function(b){var x=t[b];e[b]=x,v&&(e.prototype[b]=function(){var U=this.__chain__;if(p||U){var M=e(this.__wrapped__),K=M.__actions__=ar(this.__actions__);return K.push({func:x,args:arguments,thisArg:e}),M.__chain__=U,M}return x.apply(e,gi([this.value()],arguments))})}),e}function Xv(){return Pe._===this&&(Pe._=Sp),this}function Za(){}function em(e){return e=ye(e),_e(function(t){return Pu(t,e)})}var tm=Aa(it),rm=Aa(Gc),im=Aa(ea);function Kh(e){return La(e)?ta(Vr(e)):$d(e)}function sm(e){return function(t){return e==null?r:ji(e,t)}}var nm=Wu(),om=Wu(!0);function Xa(){return[]}function ec(){return!1}function am(){return{}}function cm(){return""}function um(){return!0}function hm(e,t){if(e=ye(e),e<1||e>ee)return[];var n=Y,c=Bt(e,Y);t=ue(t),e-=Y;for(var l=sa(c,t);++n<e;)t(n);return l}function lm(e){return ge(e)?it(e,Vr):vr(e)?[e]:ar(hh(Le(e)))}function fm(e){var t=++Ip;return Le(e)+t}var pm=eo(function(e,t){return e+t},0),dm=Ta("ceil"),gm=eo(function(e,t){return e/t},1),ym=Ta("floor");function vm(e){return e&&e.length?Gn(e,hr,ga):r}function mm(e,t){return e&&e.length?Gn(e,ue(t,2),ga):r}function bm(e){return Qc(e,hr)}function wm(e,t){return Qc(e,ue(t,2))}function _m(e){return e&&e.length?Gn(e,hr,ba):r}function Em(e,t){return e&&e.length?Gn(e,ue(t,2),ba):r}var Im=eo(function(e,t){return e*t},1),xm=Ta("round"),Sm=eo(function(e,t){return e-t},0);function Pm(e){return e&&e.length?ia(e,hr):0}function Om(e,t){return e&&e.length?ia(e,ue(t,2)):0}return f.after=Jy,f.ary=_h,f.assign=L0,f.assignIn=Dh,f.assignInWith=po,f.assignWith=q0,f.at=j0,f.before=Eh,f.bind=ka,f.bindAll=Hv,f.bindKey=Ih,f.castArray=a0,f.chain=mh,f.chunk=yg,f.compact=vg,f.concat=mg,f.cond=Kv,f.conforms=Vv,f.constant=Ja,f.countBy=Py,f.create=U0,f.curry=xh,f.curryRight=Sh,f.debounce=Ph,f.defaults=M0,f.defaultsDeep=z0,f.defer=Qy,f.delay=Yy,f.difference=bg,f.differenceBy=wg,f.differenceWith=_g,f.drop=Eg,f.dropRight=Ig,f.dropRightWhile=xg,f.dropWhile=Sg,f.fill=Pg,f.filter=Cy,f.flatMap=Ry,f.flatMapDeep=Ny,f.flatMapDepth=$y,f.flatten=dh,f.flattenDeep=Og,f.flattenDepth=Cg,f.flip=Zy,f.flow=Gv,f.flowRight=Wv,f.fromPairs=Ag,f.functions=W0,f.functionsIn=J0,f.groupBy=Fy,f.initial=Rg,f.intersection=Ng,f.intersectionBy=$g,f.intersectionWith=Fg,f.invert=Y0,f.invertBy=Z0,f.invokeMap=Ly,f.iteratee=Qa,f.keyBy=qy,f.keys=Mt,f.keysIn=ur,f.map=ao,f.mapKeys=ev,f.mapValues=tv,f.matches=Jv,f.matchesProperty=Qv,f.memoize=uo,f.merge=rv,f.mergeWith=Lh,f.method=Yv,f.methodOf=Zv,f.mixin=Ya,f.negate=ho,f.nthArg=em,f.omit=iv,f.omitBy=sv,f.once=Xy,f.orderBy=jy,f.over=tm,f.overArgs=e0,f.overEvery=rm,f.overSome=im,f.partial=Ha,f.partialRight=Oh,f.partition=Uy,f.pick=nv,f.pickBy=qh,f.property=Kh,f.propertyOf=sm,f.pull=jg,f.pullAll=yh,f.pullAllBy=Ug,f.pullAllWith=Mg,f.pullAt=zg,f.range=nm,f.rangeRight=om,f.rearg=t0,f.reject=ky,f.remove=kg,f.rest=r0,f.reverse=Ma,f.sampleSize=Ky,f.set=av,f.setWith=cv,f.shuffle=Vy,f.slice=Hg,f.sortBy=Wy,f.sortedUniq=Qg,f.sortedUniqBy=Yg,f.split=Rv,f.spread=i0,f.tail=Zg,f.take=Xg,f.takeRight=ey,f.takeRightWhile=ty,f.takeWhile=ry,f.tap=vy,f.throttle=s0,f.thru=oo,f.toArray=Nh,f.toPairs=jh,f.toPairsIn=Uh,f.toPath=lm,f.toPlainObject=Fh,f.transform=uv,f.unary=n0,f.union=iy,f.unionBy=sy,f.unionWith=ny,f.uniq=oy,f.uniqBy=ay,f.uniqWith=cy,f.unset=hv,f.unzip=za,f.unzipWith=vh,f.update=lv,f.updateWith=fv,f.values=gs,f.valuesIn=pv,f.without=uy,f.words=kh,f.wrap=o0,f.xor=hy,f.xorBy=ly,f.xorWith=fy,f.zip=py,f.zipObject=dy,f.zipObjectDeep=gy,f.zipWith=yy,f.entries=jh,f.entriesIn=Uh,f.extend=Dh,f.extendWith=po,Ya(f,f),f.add=pm,f.attempt=Hh,f.camelCase=vv,f.capitalize=Mh,f.ceil=dm,f.clamp=dv,f.clone=c0,f.cloneDeep=h0,f.cloneDeepWith=l0,f.cloneWith=u0,f.conformsTo=f0,f.deburr=zh,f.defaultTo=Bv,f.divide=gm,f.endsWith=mv,f.eq=Dr,f.escape=bv,f.escapeRegExp=wv,f.every=Oy,f.find=Ay,f.findIndex=fh,f.findKey=k0,f.findLast=Ty,f.findLastIndex=ph,f.findLastKey=H0,f.floor=ym,f.forEach=bh,f.forEachRight=wh,f.forIn=K0,f.forInRight=V0,f.forOwn=B0,f.forOwnRight=G0,f.get=Ba,f.gt=p0,f.gte=d0,f.has=Q0,f.hasIn=Ga,f.head=gh,f.identity=hr,f.includes=Dy,f.indexOf=Tg,f.inRange=gv,f.invoke=X0,f.isArguments=zi,f.isArray=ge,f.isArrayBuffer=g0,f.isArrayLike=cr,f.isArrayLikeObject=_t,f.isBoolean=y0,f.isBuffer=Ei,f.isDate=v0,f.isElement=m0,f.isEmpty=b0,f.isEqual=w0,f.isEqualWith=_0,f.isError=Ka,f.isFinite=E0,f.isFunction=si,f.isInteger=Ch,f.isLength=lo,f.isMap=Ah,f.isMatch=I0,f.isMatchWith=x0,f.isNaN=S0,f.isNative=P0,f.isNil=C0,f.isNull=O0,f.isNumber=Th,f.isObject=ct,f.isObjectLike=vt,f.isPlainObject=Ms,f.isRegExp=Va,f.isSafeInteger=A0,f.isSet=Rh,f.isString=fo,f.isSymbol=vr,f.isTypedArray=ds,f.isUndefined=T0,f.isWeakMap=R0,f.isWeakSet=N0,f.join=Dg,f.kebabCase=_v,f.last=Cr,f.lastIndexOf=Lg,f.lowerCase=Ev,f.lowerFirst=Iv,f.lt=$0,f.lte=F0,f.max=vm,f.maxBy=mm,f.mean=bm,f.meanBy=wm,f.min=_m,f.minBy=Em,f.stubArray=Xa,f.stubFalse=ec,f.stubObject=am,f.stubString=cm,f.stubTrue=um,f.multiply=Im,f.nth=qg,f.noConflict=Xv,f.noop=Za,f.now=co,f.pad=xv,f.padEnd=Sv,f.padStart=Pv,f.parseInt=Ov,f.random=yv,f.reduce=My,f.reduceRight=zy,f.repeat=Cv,f.replace=Av,f.result=ov,f.round=xm,f.runInContext=I,f.sample=Hy,f.size=By,f.snakeCase=Tv,f.some=Gy,f.sortedIndex=Kg,f.sortedIndexBy=Vg,f.sortedIndexOf=Bg,f.sortedLastIndex=Gg,f.sortedLastIndexBy=Wg,f.sortedLastIndexOf=Jg,f.startCase=Nv,f.startsWith=$v,f.subtract=Sm,f.sum=Pm,f.sumBy=Om,f.template=Fv,f.times=hm,f.toFinite=ni,f.toInteger=ye,f.toLength=$h,f.toLower=Dv,f.toNumber=Ar,f.toSafeInteger=D0,f.toString=Le,f.toUpper=Lv,f.trim=qv,f.trimEnd=jv,f.trimStart=Uv,f.truncate=Mv,f.unescape=zv,f.uniqueId=fm,f.upperCase=kv,f.upperFirst=Wa,f.each=bh,f.eachRight=wh,f.first=gh,Ya(f,function(){var e={};return Hr(f,function(t,n){je.call(f.prototype,n)||(e[n]=t)}),e}(),{chain:!1}),f.VERSION=s,Ir(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){f[e].placeholder=f}),Ir(["drop","take"],function(e,t){Se.prototype[e]=function(n){n=n===r?1:qt(ye(n),0);var c=this.__filtered__&&!t?new Se(this):this.clone();return c.__filtered__?c.__takeCount__=Bt(n,c.__takeCount__):c.__views__.push({size:Bt(n,Y),type:e+(c.__dir__<0?"Right":"")}),c},Se.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),Ir(["filter","map","takeWhile"],function(e,t){var n=t+1,c=n==T||n==Ue;Se.prototype[e]=function(l){var p=this.clone();return p.__iteratees__.push({iteratee:ue(l,3),type:n}),p.__filtered__=p.__filtered__||c,p}}),Ir(["head","last"],function(e,t){var n="take"+(t?"Right":"");Se.prototype[e]=function(){return this[n](1).value()[0]}}),Ir(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");Se.prototype[e]=function(){return this.__filtered__?new Se(this):this[n](1)}}),Se.prototype.compact=function(){return this.filter(hr)},Se.prototype.find=function(e){return this.filter(e).head()},Se.prototype.findLast=function(e){return this.reverse().find(e)},Se.prototype.invokeMap=_e(function(e,t){return typeof e=="function"?new Se(this):this.map(function(n){return Fs(n,e,t)})}),Se.prototype.reject=function(e){return this.filter(ho(ue(e)))},Se.prototype.slice=function(e,t){e=ye(e);var n=this;return n.__filtered__&&(e>0||t<0)?new Se(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==r&&(t=ye(t),n=t<0?n.dropRight(-t):n.take(t-e)),n)},Se.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Se.prototype.toArray=function(){return this.take(Y)},Hr(Se.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),c=/^(?:head|last)$/.test(t),l=f[c?"take"+(t=="last"?"Right":""):t],p=c||/^find/.test(t);l&&(f.prototype[t]=function(){var v=this.__wrapped__,b=c?[1]:arguments,x=v instanceof Se,U=b[0],M=x||ge(v),K=function(Ie){var Oe=l.apply(f,gi([Ie],b));return c&&Z?Oe[0]:Oe};M&&n&&typeof U=="function"&&U.length!=1&&(x=M=!1);var Z=this.__chain__,se=!!this.__actions__.length,he=p&&!Z,be=x&&!se;if(!p&&M){v=be?v:new Se(this);var le=e.apply(v,b);return le.__actions__.push({func:oo,args:[K],thisArg:r}),new Sr(le,Z)}return he&&be?e.apply(this,b):(le=this.thru(K),he?c?le.value()[0]:le.value():le)})}),Ir(["pop","push","shift","sort","splice","unshift"],function(e){var t=Nn[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);f.prototype[e]=function(){var l=arguments;if(c&&!this.__chain__){var p=this.value();return t.apply(ge(p)?p:[],l)}return this[n](function(v){return t.apply(ge(v)?v:[],l)})}}),Hr(Se.prototype,function(e,t){var n=f[t];if(n){var c=n.name+"";je.call(us,c)||(us[c]=[]),us[c].push({name:t,func:n})}}),us[Xn(r,ve).name]=[{name:"wrapper",func:r}],Se.prototype.clone=zp,Se.prototype.reverse=kp,Se.prototype.value=Hp,f.prototype.at=my,f.prototype.chain=by,f.prototype.commit=wy,f.prototype.next=_y,f.prototype.plant=Iy,f.prototype.reverse=xy,f.prototype.toJSON=f.prototype.valueOf=f.prototype.value=Sy,f.prototype.first=f.prototype.head,Os&&(f.prototype[Os]=Ey),f},os=wp();wt?((wt.exports=os)._=os,Be._=os):Pe._=os}).call(Qs)})(Sc,Sc.exports);var sI=Object.defineProperty,nI=Object.defineProperties,oI=Object.getOwnPropertyDescriptors,Jl=Object.getOwnPropertySymbols,aI=Object.prototype.hasOwnProperty,cI=Object.prototype.propertyIsEnumerable,Ql=(a,i,r)=>i in a?sI(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,vo=(a,i)=>{for(var r in i||(i={}))aI.call(i,r)&&Ql(a,r,i[r]);if(Jl)for(var r of Jl(i))cI.call(i,r)&&Ql(a,r,i[r]);return a},uI=(a,i)=>nI(a,oI(i));function Pi(a,i,r){var s;const o=s1(a);return((s=i.rpcMap)==null?void 0:s[o.reference])||`${iI}?chainId=${o.namespace}:${o.reference}&projectId=${r}`}function Ji(a){return a.includes(":")?a.split(":")[1]:a}function Jf(a){return a.map(i=>`${i.split(":")[0]}:${i.split(":")[1]}`)}function hI(a,i){const r=Object.keys(i.namespaces).filter(o=>o.includes(a));if(!r.length)return[];const s=[];return r.forEach(o=>{const h=i.namespaces[o].accounts;s.push(...h)}),s}function lI(a={},i={}){const r=Yl(a),s=Yl(i);return Sc.exports.merge(r,s)}function Yl(a){var i,r,s,o;const h={};if(!bs(a))return h;for(const[d,y]of Object.entries(a)){const m=Uc(d)?[d]:y.chains,S=y.methods||[],C=y.events||[],j=y.rpcMap||{},B=Ys(d);h[B]=uI(vo(vo({},h[B]),y),{chains:rc(m,(i=h[B])==null?void 0:i.chains),methods:rc(S,(r=h[B])==null?void 0:r.methods),events:rc(C,(s=h[B])==null?void 0:s.events),rpcMap:vo(vo({},j),(o=h[B])==null?void 0:o.rpcMap)})}return h}function fI(a){return a.includes(":")?a.split(":")[2]:a}function pI(a){const i={};for(const[r,s]of Object.entries(a)){const o=s.methods||[],h=s.events||[],d=s.accounts||[],y=Uc(r)?[r]:s.chains?s.chains:Jf(s.accounts);i[r]={chains:y,methods:o,events:h,accounts:d}}return i}function dc(a){return typeof a=="number"?a:a.includes("0x")?parseInt(a,16):a.includes(":")?Number(a.split(":")[1]):Number(a)}const Qf={},st=a=>Qf[a],gc=(a,i)=>{Qf[a]=i};class dI{constructor(i){this.name="polkadot",this.namespace=i.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){this.httpProviders[i]||this.setHttpProvider(i,r),this.chainId=i,this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}getAccounts(){const i=this.namespace.accounts;return i?i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var s;const o=Ji(r);i[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const s=this.createHttpProvider(i,r);s&&(this.httpProviders[i]=s)}createHttpProvider(i,r){const s=r||Pi(i,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${i}`);return new hi(new Oi(s,st("disableProviderPing")))}}class gI{constructor(i){this.name="eip155",this.namespace=i.namespace,this.events=st("events"),this.client=st("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(i){switch(i.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(i);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(i.request.method)?await this.client.request(i):this.getHttpProvider().request(i.request)}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}setDefaultChain(i,r){this.httpProviders[i]||this.setHttpProvider(parseInt(i),r),this.chainId=parseInt(i),this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}createHttpProvider(i,r){const s=r||Pi(`${this.name}:${i}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${i}`);return new hi(new Oi(s,st("disableProviderPing")))}setHttpProvider(i,r){const s=this.createHttpProvider(i,r);s&&(this.httpProviders[i]=s)}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var s;const o=parseInt(Ji(r));i[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),i}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const i=this.chainId,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}async handleSwitchChain(i){var r,s;let o=i.request.params?(r=i.request.params[0])==null?void 0:r.chainId:"0x0";o=o.startsWith("0x")?o:`0x${o}`;const h=parseInt(o,16);if(this.isChainApproved(h))this.setDefaultChain(`${h}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:i.topic,request:{method:i.request.method,params:[{chainId:o}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${h}`);else throw new Error(`Failed to switch to chain 'eip155:${h}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(i){return this.namespace.chains.includes(`${this.name}:${i}`)}}class yI{constructor(i){this.name="solana",this.namespace=i.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){this.httpProviders[i]||this.setHttpProvider(i,r),this.chainId=i,this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var s;const o=Ji(r);i[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const s=this.createHttpProvider(i,r);s&&(this.httpProviders[i]=s)}createHttpProvider(i,r){const s=r||Pi(i,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${i}`);return new hi(new Oi(s,st("disableProviderPing")))}}class vI{constructor(i){this.name="cosmos",this.namespace=i.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){this.httpProviders[i]||this.setHttpProvider(i,r),this.chainId=i,this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var s;const o=Ji(r);i[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const s=this.createHttpProvider(i,r);s&&(this.httpProviders[i]=s)}createHttpProvider(i,r){const s=r||Pi(i,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${i}`);return new hi(new Oi(s,st("disableProviderPing")))}}class mI{constructor(i){this.name="cip34",this.namespace=i.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){this.httpProviders[i]||this.setHttpProvider(i,r),this.chainId=i,this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{const s=this.getCardanoRPCUrl(r),o=Ji(r);i[o]=this.createHttpProvider(o,s)}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}getCardanoRPCUrl(i){const r=this.namespace.rpcMap;if(r)return r[i]}setHttpProvider(i,r){const s=this.createHttpProvider(i,r);s&&(this.httpProviders[i]=s)}createHttpProvider(i,r){const s=r||this.getCardanoRPCUrl(i);if(!s)throw new Error(`No RPC url provided for chainId: ${i}`);return new hi(new Oi(s,st("disableProviderPing")))}}class bI{constructor(i){this.name="elrond",this.namespace=i.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){this.httpProviders[i]||this.setHttpProvider(i,r),this.chainId=i,this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var s;const o=Ji(r);i[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const s=this.createHttpProvider(i,r);s&&(this.httpProviders[i]=s)}createHttpProvider(i,r){const s=r||Pi(i,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${i}`);return new hi(new Oi(s,st("disableProviderPing")))}}class wI{constructor(i){this.name="multiversx",this.namespace=i.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){this.httpProviders[i]||this.setHttpProvider(i,r),this.chainId=i,this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${i}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}getAccounts(){const i=this.namespace.accounts;return i?[...new Set(i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var s;const o=Ji(r);i[o]=this.createHttpProvider(o,(s=this.namespace.rpcMap)==null?void 0:s[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const s=this.createHttpProvider(i,r);s&&(this.httpProviders[i]=s)}createHttpProvider(i,r){const s=r||Pi(i,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${i}`);return new hi(new Oi(s,st("disableProviderPing")))}}class _I{constructor(i){this.name="near",this.namespace=i.namespace,this.events=st("events"),this.client=st("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(i){this.namespace=Object.assign(this.namespace,i)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const i=this.namespace.chains[0];if(!i)throw new Error("ChainId not found");return i.split(":")[1]}request(i){return this.namespace.methods.includes(i.request.method)?this.client.request(i):this.getHttpProvider().request(i.request)}setDefaultChain(i,r){if(this.chainId=i,!this.httpProviders[i]){const s=r||Pi(`${this.name}:${i}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${i}`);this.setHttpProvider(i,s)}this.events.emit(li.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const i=this.namespace.accounts;return i?i.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const i={};return this.namespace.chains.forEach(r=>{var s;i[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),i}getHttpProvider(){const i=`${this.name}:${this.chainId}`,r=this.httpProviders[i];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${i} not found`);return r}setHttpProvider(i,r){const s=this.createHttpProvider(i,r);s&&(this.httpProviders[i]=s)}createHttpProvider(i,r){const s=r||Pi(i,this.namespace);return typeof s>"u"?void 0:new hi(new Oi(s,st("disableProviderPing")))}}var EI=Object.defineProperty,II=Object.defineProperties,xI=Object.getOwnPropertyDescriptors,Zl=Object.getOwnPropertySymbols,SI=Object.prototype.hasOwnProperty,PI=Object.prototype.propertyIsEnumerable,Xl=(a,i,r)=>i in a?EI(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,mo=(a,i)=>{for(var r in i||(i={}))SI.call(i,r)&&Xl(a,r,i[r]);if(Zl)for(var r of Zl(i))PI.call(i,r)&&Xl(a,r,i[r]);return a},yc=(a,i)=>II(a,xI(i));class Vc{constructor(i){this.events=new Ac,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=i,this.logger=typeof i?.logger<"u"&&typeof i?.logger!="string"?i.logger:Ce.pino(Ce.getDefaultLoggerOptions({level:i?.logger||Gl})),this.disableProviderPing=i?.disableProviderPing||!1}static async init(i){const r=new Vc(i);return await r.initialize(),r}async request(i,r){const[s,o]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:mo({},i),chainId:`${s}:${o}`,topic:this.session.topic})}sendAsync(i,r,s){this.request(i,s).then(o=>r(null,o)).catch(o=>r(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var i;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(i=this.session)==null?void 0:i.topic,reason:It("USER_DISCONNECTED")}),await this.cleanup()}async connect(i){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(i),await this.cleanupPendingPairings(),!i.skipPairing)return await this.pair(i.pairingTopic)}on(i,r){this.events.on(i,r)}once(i,r){this.events.once(i,r)}removeListener(i,r){this.events.removeListener(i,r)}off(i,r){this.events.off(i,r)}get isWalletConnect(){return!0}async pair(i){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:o}=await this.client.connect({pairingTopic:i,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await o().then(h=>{this.session=h,this.namespaces||(this.namespaces=pI(h.namespaces),this.persist("namespaces",this.namespaces))}).catch(h=>{if(h.message!==Gf)throw h;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(i,r){try{if(!this.session)return;const[s,o]=this.validateChain(i);this.getProvider(s).setDefaultChain(o,r)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(i={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(Gr(r)){for(const s of r)i.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const i=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[i]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await XE.init({logger:this.providerOpts.logger||Gl,relayUrl:this.providerOpts.relayUrl||eI,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const i=[...new Set(Object.keys(this.session.namespaces).map(r=>Ys(r)))];gc("client",this.client),gc("events",this.events),gc("disableProviderPing",this.disableProviderPing),i.forEach(r=>{if(!this.session)return;const s=hI(r,this.session),o=Jf(s),h=lI(this.namespaces,this.optionalNamespaces),d=yc(mo({},h[r]),{accounts:s,chains:o});switch(r){case"eip155":this.rpcProviders[r]=new gI({namespace:d});break;case"solana":this.rpcProviders[r]=new yI({namespace:d});break;case"cosmos":this.rpcProviders[r]=new vI({namespace:d});break;case"polkadot":this.rpcProviders[r]=new dI({namespace:d});break;case"cip34":this.rpcProviders[r]=new mI({namespace:d});break;case"elrond":this.rpcProviders[r]=new bI({namespace:d});break;case"multiversx":this.rpcProviders[r]=new wI({namespace:d});break;case"near":this.rpcProviders[r]=new _I({namespace:d});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",i=>{this.events.emit("session_ping",i)}),this.client.on("session_event",i=>{const{params:r}=i,{event:s}=r;if(s.name==="accountsChanged"){const o=s.data;o&&Gr(o)&&this.events.emit("accountsChanged",o.map(fI))}else if(s.name==="chainChanged"){const o=r.chainId,h=r.event.data,d=Ys(o),y=dc(o)!==dc(h)?`${d}:${dc(h)}`:o;this.onChainChanged(y)}else this.events.emit(s.name,s.data);this.events.emit("session_event",i)}),this.client.on("session_update",({topic:i,params:r})=>{var s;const{namespaces:o}=r,h=(s=this.client)==null?void 0:s.session.get(i);this.session=yc(mo({},h),{namespaces:o}),this.onSessionUpdate(),this.events.emit("session_update",{topic:i,params:r})}),this.client.on("session_delete",async i=>{await this.cleanup(),this.events.emit("session_delete",i),this.events.emit("disconnect",yc(mo({},It("USER_DISCONNECTED")),{data:i.topic}))}),this.on(li.DEFAULT_CHAIN_CHANGED,i=>{this.onChainChanged(i,!0)})}getProvider(i){if(!this.rpcProviders[i])throw new Error(`Provider not found: ${i}`);return this.rpcProviders[i]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(i=>{var r;this.getProvider(i).updateNamespace((r=this.session)==null?void 0:r.namespaces[i])})}setNamespaces(i){const{namespaces:r,optionalNamespaces:s,sessionProperties:o}=i;r&&Object.keys(r).length&&(this.namespaces=r),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=o,this.persist("namespaces",r),this.persist("optionalNamespaces",s)}validateChain(i){const[r,s]=i?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,s];if(r&&!Object.keys(this.namespaces||{}).map(d=>Ys(d)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&s)return[r,s];const o=Ys(Object.keys(this.namespaces)[0]),h=this.rpcProviders[o].getDefaultChain();return[o,h]}async requestAccounts(){const[i]=this.validateChain();return await this.getProvider(i).requestAccounts()}onChainChanged(i,r=!1){var s;if(!this.namespaces)return;const[o,h]=this.validateChain(i);r||this.getProvider(o).setDefaultChain(h),((s=this.namespaces[o])!=null?s:this.namespaces[`${o}:${h}`]).defaultChain=h,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",h)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(i,r){this.client.core.storage.setItem(`${Wl}/${i}`,r)}async getFromStore(i){return await this.client.core.storage.getItem(`${Wl}/${i}`)}}const OI=Vc,CI="wc",AI="ethereum_provider",TI=`${CI}@2:${AI}:`,RI="https://rpc.walletconnect.com/v1/",Pc=["eth_sendTransaction","personal_sign"],NI=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Oc=["chainChanged","accountsChanged"],$I=["chainChanged","accountsChanged","message","disconnect","connect"];var FI=Object.defineProperty,DI=Object.defineProperties,LI=Object.getOwnPropertyDescriptors,ef=Object.getOwnPropertySymbols,qI=Object.prototype.hasOwnProperty,jI=Object.prototype.propertyIsEnumerable,tf=(a,i,r)=>i in a?FI(a,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[i]=r,Xs=(a,i)=>{for(var r in i||(i={}))qI.call(i,r)&&tf(a,r,i[r]);if(ef)for(var r of ef(i))jI.call(i,r)&&tf(a,r,i[r]);return a},rf=(a,i)=>DI(a,LI(i));function Po(a){return Number(a[0].split(":")[1])}function vc(a){return`0x${a.toString(16)}`}function UI(a){const{chains:i,optionalChains:r,methods:s,optionalMethods:o,events:h,optionalEvents:d,rpcMap:y}=a;if(!Gr(i))throw new Error("Invalid chains");const m={chains:i,methods:s||Pc,events:h||Oc,rpcMap:Xs({},i.length?{[Po(i)]:y[Po(i)]}:{})},S=h?.filter(W=>!Oc.includes(W)),C=s?.filter(W=>!Pc.includes(W));if(!r&&!d&&!o&&!(S!=null&&S.length)&&!(C!=null&&C.length))return{required:i.length?m:void 0};const j=S?.length&&C?.length||!r,B={chains:[...new Set(j?m.chains.concat(r||[]):r)],methods:[...new Set(m.methods.concat(o!=null&&o.length?o:NI))],events:[...new Set(m.events.concat(d!=null&&d.length?d:$I))],rpcMap:y};return{required:i.length?m:void 0,optional:r.length?B:void 0}}class Bc{constructor(){this.events=new Wr.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=TI,this.on=(i,r)=>(this.events.on(i,r),this),this.once=(i,r)=>(this.events.once(i,r),this),this.removeListener=(i,r)=>(this.events.removeListener(i,r),this),this.off=(i,r)=>(this.events.off(i,r),this),this.parseAccount=i=>this.isCompatibleChainId(i)?this.parseAccountId(i).address:i,this.signer={},this.rpc={}}static async init(i){const r=new Bc;return await r.initialize(i),r}async request(i){return await this.signer.request(i,this.formatChainId(this.chainId))}sendAsync(i,r){this.signer.sendAsync(i,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(i){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(i);const{required:r,optional:s}=UI(this.rpc);try{const o=await new Promise(async(d,y)=>{var m;this.rpc.showQrModal&&((m=this.modal)==null||m.subscribeModal(S=>{!S.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),y(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(rf(Xs({namespaces:Xs({},r&&{[this.namespace]:r})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:i?.pairingTopic})).then(S=>{d(S)}).catch(S=>{y(new Error(S.message))})});if(!o)return;const h=n1(o.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:h),this.setAccounts(h),this.events.emit("connect",{chainId:vc(this.chainId)})}catch(o){throw this.signer.logger.error(o),o}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",i=>{const{params:r}=i,{event:s}=r;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",i)}),this.signer.on("chainChanged",i=>{const r=parseInt(i);this.chainId=r,this.events.emit("chainChanged",vc(this.chainId)),this.persist()}),this.signer.on("session_update",i=>{this.events.emit("session_update",i)}),this.signer.on("session_delete",i=>{this.reset(),this.events.emit("session_delete",i),this.events.emit("disconnect",rf(Xs({},It("USER_DISCONNECTED")),{data:i.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",i=>{var r,s;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(s=this.modal)==null||s.openModal({uri:i})),this.events.emit("display_uri",i)})}switchEthereumChain(i){this.request({method:"wallet_switchEthereumChain",params:[{chainId:i.toString(16)}]})}isCompatibleChainId(i){return typeof i=="string"?i.startsWith(`${this.namespace}:`):!1}formatChainId(i){return`${this.namespace}:${i}`}parseChainId(i){return Number(i.split(":")[1])}setChainIds(i){const r=i.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",vc(this.chainId)),this.persist())}setChainId(i){if(this.isCompatibleChainId(i)){const r=this.parseChainId(i);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(i){const[r,s,o]=i.split(":");return{chainId:`${r}:${s}`,address:o}}setAccounts(i){this.accounts=i.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(i){var r,s;const o=(r=i?.chains)!=null?r:[],h=(s=i?.optionalChains)!=null?s:[],d=o.concat(h);if(!d.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const y=o.length?i?.methods||Pc:[],m=o.length?i?.events||Oc:[],S=i?.optionalMethods||[],C=i?.optionalEvents||[],j=i?.rpcMap||this.buildRpcMap(d,i.projectId),B=i?.qrModalOptions||void 0;return{chains:o?.map(W=>this.formatChainId(W)),optionalChains:h.map(W=>this.formatChainId(W)),methods:y,events:m,optionalMethods:S,optionalEvents:C,rpcMap:j,showQrModal:!!(i!=null&&i.showQrModal),qrModalOptions:B,projectId:i.projectId,metadata:i.metadata}}buildRpcMap(i,r){const s={};return i.forEach(o=>{s[o]=this.getRpcUrl(o,r)}),s}async initialize(i){if(this.rpc=this.getRpcConfig(i),this.chainId=this.rpc.chains.length?Po(this.rpc.chains):Po(this.rpc.optionalChains),this.signer=await OI.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:i.disableProviderPing,relayUrl:i.relayUrl,storageOptions:i.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:s}=await Jm(()=>import("./index-f1d533ff.js").then(o=>o.i),["assets/index-f1d533ff.js","assets/index-657e2633.js","assets/index-b1786e94.css"]);r=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Xs({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(i){if(!i)return;const{chains:r,optionalChains:s,rpcMap:o}=i;r&&Gr(r)&&(this.rpc.chains=r.map(h=>this.formatChainId(h)),r.forEach(h=>{this.rpc.rpcMap[h]=o?.[h]||this.getRpcUrl(h)})),s&&Gr(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s?.map(h=>this.formatChainId(h)),s.forEach(h=>{this.rpc.rpcMap[h]=o?.[h]||this.getRpcUrl(h)}))}getRpcUrl(i,r){var s;return((s=this.rpc.rpcMap)==null?void 0:s[i])||`${RI}?chainId=eip155:${i}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const i=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${i}`]?this.session.namespaces[`${this.namespace}:${i}`]:this.session.namespaces[this.namespace];this.setChainIds(i?[this.formatChainId(i)]:r?.accounts),this.setAccounts(r?.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(i){return typeof i=="string"||i instanceof String?[this.parseAccount(i)]:i.map(r=>this.parseAccount(r))}}const QI=Bc;export{QI as EthereumProvider,$I as OPTIONAL_EVENTS,NI as OPTIONAL_METHODS,Oc as REQUIRED_EVENTS,Pc as REQUIRED_METHODS,Bc as default};
